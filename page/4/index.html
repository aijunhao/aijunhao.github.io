<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hello, I&#39;m Junhao Ai.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hello, I&#39;m Junhao Ai.">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hello, I&#39;m Junhao Ai.">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hello, I&#39;m Junhao Ai.">
  
    <link rel="alternate" href="/atom.xml" title="Hello, I&#39;m Junhao Ai." type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hello, I&#39;m Junhao Ai.</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/12/hello-world/" class="article-date">
  <time datetime="2018-09-12T10:32:20.946Z" itemprop="datePublished">2018-09-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/12/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/12/hello-world/" data-id="cjt2oa241000qz0uteyyf5ggm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/">blog</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-《第一行代码_Android》第2章_探究活动" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/12/《第一行代码_Android》第2章_探究活动/" class="article-date">
  <time datetime="2018-09-12T10:10:26.000Z" itemprop="datePublished">2018-09-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/12/《第一行代码_Android》第2章_探究活动/">《第一行代码 Android》第2章 探究活动</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#第2章-先从看得到的入手探究活动">第2章 先从看得到的入手——探究活动</a><ul>
<li><a href="#活动activity">活动(Activity)</a></li>
<li><a href="#活动的创建">活动的创建</a></li>
<li><a href="#在活动中使用menu菜单">在活动中使用Menu菜单</a></li>
<li><a href="#使用intent在活动之间穿梭">使用Intent在活动之间穿梭</a><ul>
<li><a href="#1-显示intent">1. 显示Intent</a></li>
<li><a href="#2-隐式intent">2. 隐式Intent</a></li>
<li><a href="#intent向下一个活动传递数据">Intent向下一个活动传递数据</a></li>
<li><a href="#intent向上一个活动返回数据">Intent向上一个活动返回数据</a></li>
</ul>
</li>
<li><a href="#活动的生命周期">活动的生命周期</a><ul>
<li><a href="#活动状态">活动状态</a></li>
<li><a href="#活动的生存期">活动的生存期</a></li>
<li><a href="#生命周期">生命周期</a></li>
<li><a href="#活动临时数据保存">活动临时数据保存</a></li>
</ul>
</li>
<li><a href="#活动的启动模式">活动的启动模式</a><ul>
<li><a href="#standard">standard</a></li>
<li><a href="#singletop">singleTop</a></li>
<li><a href="#singletask">singleTask</a></li>
<li><a href="#singleinstance">singleInstance</a></li>
</ul>
</li>
<li><a href="#如何让界面对应活动">如何让界面对应活动</a></li>
<li><a href="#随时随地退出程序">随时随地退出程序</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<hr>
<p>此博客使用教材为《第一行代码 Android》第2版。</p>
<h2 id="第2章-先从看得到的入手——探究活动"><a href="#第2章-先从看得到的入手——探究活动" class="headerlink" title="第2章 先从看得到的入手——探究活动"></a>第2章 先从看得到的入手——探究活动</h2><p>android四大组件之一——Activity</p>
<hr>
<h3 id="活动-Activity"><a href="#活动-Activity" class="headerlink" title="活动(Activity)"></a>活动(Activity)</h3><p>活动(Activity)是最容易吸引用户的地方，它是一种够可以包含用户界面的组件，主要用于和用户进行交互。</p>
<h3 id="活动的创建"><a href="#活动的创建" class="headerlink" title="活动的创建"></a>活动的创建</h3><p>活动创建有两种，一种是纯手动创建，一种是Activity自动创建。</p>
<ol>
<li>纯手动创建：<br>纯手动创建活动有三步：新建layout布局文件、新建java类并加载布局、在AndroidManifest中注册生效。<br><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/1.PNG" alt=""></li>
</ol>
<ul>
<li><p>第一步 新建layout资源文件：在app/res目录下的layout文件夹右击-&gt;New-&gt;Layout resource file-&gt;输入文件名并选择合适的布局方式。<br><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/3.PNG" alt=""></p>
</li>
<li><p>第二步 新建java类：app/java目录下的com.me.androidfirstlinecode包(每个人可能不同)右击-&gt;New-&gt;Java Class-&gt;输入包名并继承需要的Activity父类，并重写onCreate方法，并使用setContentView方法加载布局文件。<br><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/2.PNG" alt=""></p>
</li>
<li><p>第三步 在AndroidManifest中注册：所有活动只有注册后才能生效，注册声明要放在\&lt;application>标签内。其中第19行是我们新的activity的注册。这里“.test”是“com.me.androidfirstlinecode.test”的缩写，由于在最外层的\&lt;manifest>标签中已经通过package属性制定了程序的包名是“com.me.androidfirstlinecode”(第3行)，因此在注册活动时这一部分可以省略了。12行到18行是另一个名为MainActivity的活动的注册。13到17行是设置该活动为主活动，就是软件运行时的第一个活动，主活动只能有一个。<br><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/4.PNG" alt=""></p>
</li>
</ul>
<ol start="2">
<li>Activity自动创建：<br>自动创建就是直接创建一个activity，系统将自动完成纯手动创建的三个步奏。</li>
</ol>
<p>app/java目录下的com.me.androidfirstlinecode包(每个人可能不同)右击-&gt;New-&gt;Activity-&gt;Empty Activity。</p>
<p>两种方式创建actiivty，效果完全相同，使用自动创建的方法省时省力并且不容易出错。</p>
<hr>
<h3 id="在活动中使用Menu菜单"><a href="#在活动中使用Menu菜单" class="headerlink" title="在活动中使用Menu菜单"></a>在活动中使用Menu菜单</h3><p>手机屏幕空间非常有限，使用Menu菜单将节省大量的空间。</p>
<p>在res目录下新建一个menu文件夹，右击目录-&gt;New-&gt;Directory，文件夹名为menu，在这个文件夹下再新建一个名叫 main 的Menu resource file。</p>
<p>在main.xml中创建两个菜单项代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/add_item"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"Add"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/remove_item"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"Remove"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>回到Activity中来使用Ctrl+O快捷键重写onCreateOptionsMenu方法来给当前活动创建菜单:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">    getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Ctrl+鼠标左键打开inflate()方法的源码，可以看到inflate()方法接受两个参数，第一个参数用来只等我们通过哪一个资源文件来创建菜单，第二个参数指定我们的菜单项将添加到一个Menu对象中，就是onCreateOptionMenu()方法中传入的menu参数。</p>
<p><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/5.PNG" alt=""></p>
<p>onCreateOptionMenu()方法返回值为true，表示允许创建的菜单显示出来，返回false就不显示。</p>
<p>重写onOptionsItemSelected()方法，，给定义的菜单定义响应事件，通过Toast弹出消息进行测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (item.getItemId())&#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.add_item:</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">"You clicked Add"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.remove_item:</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">"You clicked Remove"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/6.PNG" alt=""></p>
<p><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/7.PNG" alt=""></p>
<hr>
<h3 id="使用Intent在活动之间穿梭"><a href="#使用Intent在活动之间穿梭" class="headerlink" title="使用Intent在活动之间穿梭"></a>使用Intent在活动之间穿梭</h3><p>真正的程序不止一个活动，往往由多个活动组成，活动之间的跳转和数据传输是必不可少的。</p>
<p>Intent是Android程序中各组件之间进行交互的一种重要方式，它不仅可以指明当前组件想要执行的动作，还可以在不同组件之间传递数据。Intent一般可用于启动活动，启动服务以及发送广播等场景。</p>
<p>Intent分为两种，显示Intent和隐式Intent。</p>
<h4 id="1-显示Intent"><a href="#1-显示Intent" class="headerlink" title="1. 显示Intent"></a>1. 显示Intent</h4><p>Intent有多个构造函数，其中一个如下图所示，接收两个参数，第一个参数Context要求提供一个启动活动的上下文，第二个参数Class指的是要启动的目标活动。</p>
<p><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/8.PNG" alt=""></p>
<p>新建一个Activity，将主活动设置为新的Activity，并添加一个button按钮，同时给按钮设置点击监听，并在监听中使用Intent将活动跳转到MainActivity中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Button button = findViewById(R.id.button);</span><br><span class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(SecondActivity.<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="2-隐式Intent"><a href="#2-隐式Intent" class="headerlink" title="2. 隐式Intent"></a>2. 隐式Intent</h4><p>相比显示Intent，隐式Intent含蓄了许多，它并不明确指出我们要启动哪一个活动，而是指定了一系列更为抽象的action和category等信息，然后交给系统去分析这个Intent，并帮我们找出适合的活动去启动。这个合适的获取简单来说就是可以响应我们这个隐式Intent的活动。</p>
<p>例如，在AndroidManifest中设置MainActivity的action和category：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.example.activitytest.ACTION_START"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".SecondActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>除此之外，还可以在\&lt;intent-filter>中配置\&lt;data>把标签，用于更精确指定当前活动能响应什么类型的数据(过滤器)。</p>
<ul>
<li>android:scheme。用于指定数据的协议部分，如http、rtsp(直播)。</li>
<li>android:host。用于指定数据的主机名部分，如网址中的“<a href="http://www.baidu.com”域名或者“120.79.254.54”主机地址。" target="_blank" rel="noopener">www.baidu.com”域名或者“120.79.254.54”主机地址。</a></li>
<li>android:port。用于指定数据的端口部分，如主机名后的8080端口。</li>
<li>android:path。用于指定主机名和端口之后的部分，如网址之后的文件地址。</li>
<li>android:mimeType。用于指定可以处理的数据类型，可以使用通配符，如video/*、video/mp4。</li>
</ul>
<p>只有\&lt;data>标签中指定的内容和Intent中携带的Data(setData方法接收Uri对象)完全一致时，当前活动才能够响应该Intent。</p>
<p>然后在SecondeActivity的按钮监听事件中隐式调用Intent访问MainActivity：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Button button = findViewById(R.id.button);</span><br><span class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.example.activitytest.ACTION_START"</span>);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这样的效果和显示Intent完全相同。注意，这里的action名可以自定义，只要自己的对应就行，但由于使用action字符串使得程序之间交互更加容易，为了防止程序之间相互影响，一般命名方式是包名+action名。</p>
<p>每个Intent只能指定一个action和多个category。每个activity可以有多个action和category。</p>
<p>隐式Intent更多用法：</p>
<ol>
<li>调用网页<br>在SecondActivity中调用网页：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Button btnBrowser = findViewById(R.id.btn_browser);</span><br><span class="line">btnBrowser.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">        intent.setData(Uri.parse(<span class="string">"http://www.baidu.com"</span>));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这样，点击按钮，就会调用系统的浏览器。</p>
<p>此外，还有结合\&lt;data>标签让系统调用我们的activity。新建一个ThirdActivity，设置AndroidManifest文件该activiyt的\&lt;intent-filter>标签内容为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".ThirdActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">tools:ignore</span>=<span class="string">"AppLinkUrlError"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"http"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这样运行程序，点击SecondActivity中的按钮，系统会跳出选项，让用户选择是使用系统浏览器还是我们自定义的ThirdActivity。<br><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/1.jpg" alt=""></p>
<p>其他隐式Intent调用案例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显式调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">button = findViewById(R.id.button);</span><br><span class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="string">"com.example.activitytest.ACTION_START"</span>);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 浏览器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">btnBrowser = findViewById(R.id.btn_browser);</span><br><span class="line">btnBrowser.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">        intent.setData(Uri.parse(<span class="string">"http://www.aijunhao.com.cn"</span>));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 邮件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">btnEmail = findViewById(R.id.btn_email);</span><br><span class="line">btnEmail.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_SENDTO);</span><br><span class="line">        intent.setData(Uri.parse(<span class="string">"mailto:1172949809@qq.com"</span>));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 电话</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">btnDail = findViewById(R.id.btn_dail);</span><br><span class="line">btnDail.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_DIAL);</span><br><span class="line">        intent.setData(Uri.parse(<span class="string">"tel:10086"</span>));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 地图定位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">btnMap = findViewById(R.id.btn_map);</span><br><span class="line">btnMap.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">        intent.setData(Uri.parse(<span class="string">"geo:00.000000, -00.000000"</span>));</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="Intent向下一个活动传递数据"><a href="#Intent向下一个活动传递数据" class="headerlink" title="Intent向下一个活动传递数据"></a>Intent向下一个活动传递数据</h4><ol>
<li>Int、String等数据传递。</li>
</ol>
<p>案例：从SecondActivity将传递到ThirdActivity中。</p>
<p>SecondActivity发送数据：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 普通数据传递</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        btnSendMessage = findViewById(R.id.btn_send_message);</span><br><span class="line">        btnSendMessage.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(SecondActivity.<span class="keyword">this</span>, ThirdActivity.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 方法一</span></span><br><span class="line">                String data = <span class="string">"Hello ThirdActivity"</span>;</span><br><span class="line">                <span class="keyword">int</span> number = <span class="number">100</span>;</span><br><span class="line">                intent.putExtra(<span class="string">"data"</span>, data);</span><br><span class="line">                intent.putExtra(<span class="string">"number"</span>, number);</span><br><span class="line"></span><br><span class="line"><span class="comment">//                // 方法二</span></span><br><span class="line"><span class="comment">//                Bundle bundle = new Bundle();</span></span><br><span class="line"><span class="comment">//                bundle.putString("data", "Hello ThirdActivity");</span></span><br><span class="line"><span class="comment">//                bundle.putInt("number", 100);</span></span><br><span class="line"><span class="comment">//                intent.putExtras(bundle);</span></span><br><span class="line"></span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<p>ThirdActivity接收数据：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> TextView tvDataShow;</span><br><span class="line">    <span class="keyword">private</span> TextView tvNumberShow;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_third);</span><br><span class="line"></span><br><span class="line">        tvDataShow = findViewById(R.id.tv_data_show);</span><br><span class="line">        tvNumberShow = findViewById(R.id.tv_number_show);</span><br><span class="line"></span><br><span class="line">        Intent intent = getIntent();</span><br><span class="line">        <span class="comment">// 方法一</span></span><br><span class="line">        String data = intent.getStringExtra(<span class="string">"data"</span>);</span><br><span class="line">        <span class="keyword">int</span> number = intent.getIntExtra(<span class="string">"number"</span>,<span class="number">0</span>);    <span class="comment">// 查看源码会发现这里有默认值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        // 方法二</span></span><br><span class="line"><span class="comment">//        Bundle bundle = intent.getExtras();</span></span><br><span class="line"><span class="comment">//        String data = bundle.getString("data");</span></span><br><span class="line"><span class="comment">//        int number = bundle.getInt("number");</span></span><br><span class="line"></span><br><span class="line">        tvDataShow.setText(<span class="string">"String值:"</span> + data);</span><br><span class="line">        tvNumberShow.setText(<span class="string">"Int值:"</span> + number);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/2.jpg" alt=""></p>
<ol start="2">
<li>对象传递，序列化。<br>Parcleable和Serializable两种序列化方式的比较：</li>
</ol>
<ul>
<li>在使用内存的时候，Parcelable比Serializable性能高，所以推荐使用Parcelable。</li>
<li>Serializable在序列化的时候会产生大量的临时变量，从而引起频繁的GC。</li>
<li>Parcelable不能使用在要将数据存储在磁盘上的情况，因为Parcelable不能很好的保证数据的持续性。在外界有变化的情况下。尽管Serializable效率低点，但此时还是建议使用Serializable。</li>
</ul>
<p>案例：Serializable序列化。</p>
<p>先将类继承Serializable:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：AiJunhao</span></span><br><span class="line"><span class="comment"> * 日期：2018/9/17 15:47</span></span><br><span class="line"><span class="comment"> * 描述：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestClass</span><span class="params">(String data, <span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>SecondActivity发送数据：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">btnSendMessage = findViewById(R.id.btn_send_message);</span><br><span class="line">btnSendMessage.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(SecondActivity.<span class="keyword">this</span>, ThirdActivity.class);</span><br><span class="line"></span><br><span class="line">        TestClass str = <span class="keyword">new</span> TestClass(<span class="string">"hello world!"</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">        bundle.putSerializable(<span class="string">"str"</span>, str);</span><br><span class="line">        intent.putExtras(bundle);</span><br><span class="line"></span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ThirdActivity接收数据：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TextView tvDataShow;</span><br><span class="line"><span class="keyword">private</span> TextView tvNumberShow;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_third);</span><br><span class="line"></span><br><span class="line">    tvDataShow = findViewById(R.id.tv_data_show);</span><br><span class="line">    tvNumberShow = findViewById(R.id.tv_number_show);</span><br><span class="line"></span><br><span class="line">    Intent intent = getIntent();</span><br><span class="line"></span><br><span class="line">    TestClass str = (TestClass) getIntent().getSerializableExtra(<span class="string">"str"</span>);</span><br><span class="line"></span><br><span class="line">    tvDataShow.setText(<span class="string">"String值:"</span> + data);</span><br><span class="line">    tvNumberShow.setText(<span class="string">"Int值:"</span> + number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Intent向上一个活动返回数据"><a href="#Intent向上一个活动返回数据" class="headerlink" title="Intent向上一个活动返回数据"></a>Intent向上一个活动返回数据</h4><p>startActivityForResult()方法</p>
<hr>
<h3 id="活动的生命周期"><a href="#活动的生命周期" class="headerlink" title="活动的生命周期"></a>活动的生命周期</h3><p>Android中的活动是可以层叠的。我们没启动一个新的活动，就会覆盖在原活动之上，然后点击Back键会销毁最上面的活动，下面的一个活动就会重新显示出来。</p>
<p>Android是使用任务(Task)来管理活动的，一个任务就是一组存放在栈里的活动的集合，这个栈称为返回栈(Back Stack)。在默认情况下，每当启动一个新的活动，它会在返回栈中入栈，并处于栈顶的位置。当按下Back键或调用finish()方法去销毁一个活动时，处于栈顶的活动会出栈，这时前一个入栈的活动救护重新出于栈顶的位置。系统总是会显示处于栈顶的活动给用户。</p>
<h4 id="活动状态"><a href="#活动状态" class="headerlink" title="活动状态"></a>活动状态</h4><p>每个活动在器生命周期中最多可能会有4中状态。</p>
<ol>
<li><p>运行状态。当一个活动处于活动栈的栈顶位置，这个活动就处于运行状态。系统一般不会回收这样的活动。</p>
</li>
<li><p>暂停状态。当一个活动不再处于栈顶位置，但任然可视，活动就处于暂停状态。如对话框形式的活动只会占据屏幕中间的区域，周围显示的就是上一个活动，这个活动就处于暂停状态。只有在内存极低的情况下，系统才会回收这样的活动。</p>
</li>
<li><p>停止状态。当一个活动不再处于栈顶位置，并且完全不可见的时候，就处于停止状态。这种状态不稳定，系统会给这种活动保留相应的状态和成员变量，但是如果其他地方需要使用内存，这样的活动有可能被回收。</p>
</li>
<li><p>销毁状态。当活动从返回栈中移除后就变成销毁状态。系统会回收这样的活动保证手机内存充足。</p>
</li>
</ol>
<h4 id="活动的生存期"><a href="#活动的生存期" class="headerlink" title="活动的生存期"></a>活动的生存期</h4><p><img src="/2018/09/12/《第一行代码_Android》第2章_探究活动/生存期.jpg" alt=""></p>
<ul>
<li><p>onCreate()。每个活动中我们都重写了这个方法,它会在活动第一次被创建的时候调用。你应该在这个方法中完成活动的初始化操作,比如说加载布局、绑定事件等。</p>
</li>
<li><p>onStart()。这个方法在活动由不可见变为可见的时候调用。</p>
</li>
<li><p>onResume()。这个方法在活动准备好和用户进行交互的时候调用。此时的活动一定位于返回栈的栈顶,并且处于运行状态。</p>
</li>
<li><p>onPause()。这个方法在系统准备去启动或者恢复另一个活动的时候调用。我们通常会在这个方法中将一些消耗 CPU 的资源释放掉,以及保存一些关键数据,但这个方法的执行速度一定要快,不然会影响到新的栈顶活动的使用。</p>
</li>
<li><p>onStop()。这个方法在活动完全不可见的时候调用。它和 onPause()方法的主要区别在于,如果启动的新活动是一个对话框式的活动,那么 onPause()方法会得到执行,而 onStop() 方法并不会执行。</p>
</li>
<li><p>onDestroy()。这个方法在活动被销毁之前调用,之后活动的状态将变为销毁状态。</p>
</li>
<li><p>onRestart()。这个方法在活动由停止状态变为运行状态之前调用,也就是活动被重新启动了。</p>
</li>
</ul>
<p>以上七个方法中除了 onRestart()方法,其他都是两两相对的,从而又可以将活动分为三<br>种生存期。</p>
<ol>
<li><p>完整生存期。活动在 onCreate()方法和 onDestroy()方法之间所经历的，就是完整生存期。一般情况下，一个活动会在 onCreate()方法中完成各种初始化操作，而在 onDestroy()方法中完成释放内存的操作。</p>
</li>
<li><p>可见生存期。活动在 onStart()方法和 onStop()方法之间所经历的，就是可见生存期。在可见生存期内，活动对于用户总是可见的，即便有可能无法和用户进行交互。我们可以通过这两个方法，合理地管理那些对用户可见的资源。比如在 onStart()方法中对资源进行加载，而在 onStop()方法中对资源进行释放，从而保证处于停止状态的活动不会占用过多内存。</p>
</li>
<li><p>前台生存期。活动在 onResume()方法和 onPause()方法之间所经历的，就是前台生存期。在前台生存期内，活动总是处于运行状态的，此时的活动是可以和用户进行相互的，我们平时看到和接触最多的也这个状态下的活动。</p>
</li>
</ol>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><ol>
<li><p>创建Activity的时候执行的方法：<br>onCreate() –&gt; onStart() –&gt; onResume()</p>
</li>
<li><p>销毁Activity的时候执行的方法：<br>onPause() –&gt; onStop() –&gt; onDestroy()</p>
</li>
</ol>
<p>A页面跳转到B页面，点击返回，这个过程的生命周期：</p>
<ol>
<li><p>B页面完全覆盖A页面的情况，两个activity替换<br> a. A跳转B页面的生命周期方法执行顺序：<br> onPause(A) –&gt; onCreate(B) –&gt; onStart(B) –&gt; onResume(B) –&gt; onStop(A)</p>
<p> b. B页面点击后返回的生命周期方法执行顺序：<br> onPause(B) –&gt; onRestart(A) –&gt; onStart(A) –&gt; onResume(A) –&gt; onStop(B) –&gt; onDestroy(B)</p>
</li>
<li><p>B页面不完全覆盖A页面的情况，对话框形式弹出activity<br> a. A跳转B页面的生命周期方法执行顺序：<br> onPause(A) –&gt; onCreate(B) –&gt; onStart(B) –&gt; onResume(B)</p>
<p> b. B页面点击后返回的生命周期方法执行顺序：<br> onPause(B) –&gt; onResume(A) –&gt; onStop(B) –&gt; onDestroy(B)</p>
</li>
</ol>
<p>可以在程序中测试，在AndroidManifest中注册设置活动theme为Dialog即可将活动设置为弹出框形式。</p>
<h4 id="活动临时数据保存"><a href="#活动临时数据保存" class="headerlink" title="活动临时数据保存"></a>活动临时数据保存</h4><p>当活动进入到停止状态，被系统回收后重新启动该活动，将不再执行onRestar()方法，而是onCreate()方法，这时如果临时数据不被保存将全被清空。</p>
<p>Acvtivity提供了一个onSavaInstanceState()回调方法,这个方法会保证一定在活动被回收之前调用,因此我们可以通过这个方法来解决活动被回收时临时数据得不到保存的问题.</p>
<p>onSavaInstanceState()方法会携带一个Bundle类型的参数用来保存临时数据。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onSaveInstanceState(outState);</span><br><span class="line">    outState.putString(<span class="string">"data_string"</span>, <span class="string">"hello world"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当再次启动活动时在onCreate()方法中解析这个Bundle对象就能实现数据恢复。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    Log.d(TAG, <span class="string">"onCreate"</span>);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    <span class="keyword">if</span> (savedInstanceState != <span class="keyword">null</span>)&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="活动的启动模式"><a href="#活动的启动模式" class="headerlink" title="活动的启动模式"></a>活动的启动模式</h3><p>活动的启动模式有4种，分别是standard、singleTop、singleTask和singleInstance，在AndroidManifest中通过给\&lt;activity>标签指定android:launchMode属性来选择启动模式。</p>
<h4 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h4><p>默认启动模式。这种模式不限制活动的启动次数，所以可能会出现同一个activity同时启动多次的情况，比如使用一个按钮点击跳转到自身activity时，就会出现同一个活动创建并启动多次，要退出也是退出多次。所以这种模式不是非常合理。</p>
<h4 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h4><p>当活动的启动模式指定为singTop，在启动活动时如果发现返回栈的栈顶已经是该活动，则认为可以直接使用它，不会再创建新的活动实例。当然如果活动不再栈顶，还是会创建活动。</p>
<p>这种模式解决了重复创建栈顶活动的问题。</p>
<h4 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h4><p>当活动的启动模式指定为singleTask，每次启动该活动时系统首先会在返回栈中检查是否存在该活动的实例，如果发现已经存在则直接使用该实例，并把这个活动之上的所有活动的出栈，如果栈中没有这个活动，则创建一个新的活动实例。</p>
<h4 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h4><p>指定为singleInstance模式的活动会启动一个新的返回栈来管理这个活动。而以上三种方式都是在一个返回栈中实现操作。</p>
<hr>
<h3 id="如何让界面对应活动"><a href="#如何让界面对应活动" class="headerlink" title="如何让界面对应活动"></a>如何让界面对应活动</h3><p>当项目比较大的时候，活动比较多，然后知道某个界面要修改它就比较麻烦，需要找到界面对应的活动。</p>
<p>要解决这个问题，可以在项目中添加一个BaseActivity中间类，继承项目中使用的父类，然后让activity继承BaseActivity类，这时候只要在BaseActivity类中添加适当的Log信息，如在onCreate()方法中添加一行<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log.d(<span class="string">"BaseActivity"</span>, getClass().getSimpleName());</span><br></pre></td></tr></table></figure></p>
<p>之后当界面对应的活动被调用时Logcat就会打印Log信息，这样就能轻易查明某个界面对应的活动了。</p>
<hr>
<h3 id="随时随地退出程序"><a href="#随时随地退出程序" class="headerlink" title="随时随地退出程序"></a>随时随地退出程序</h3><p>如果要随时随地注销或者退出程序，只需要一个专门的集合类对所有的活动进行管理就可以了。</p>
<p>集合类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.activitylifecycletest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：AiJunhao</span></span><br><span class="line"><span class="comment"> * 日期：2018/9/18 19:35</span></span><br><span class="line"><span class="comment"> * 描述：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityCollector</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Activity&gt; activities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addActivity</span><span class="params">(Activity activity)</span></span>&#123;</span><br><span class="line">        activities.add(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeActivity</span><span class="params">(Activity activity)</span></span>&#123;</span><br><span class="line">        activities.remove(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">finishAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Activity activity:activities)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!activity.isFinishing())&#123;</span><br><span class="line">                activity.finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在基础类中调用集合类，当活动onCreate()时往集合类中添加活动，当活动onDestroy()时将集合类移除对应活动。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.activitylifecycletest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：AiJunhao</span></span><br><span class="line"><span class="comment"> * 日期：2018/9/18 19:39</span></span><br><span class="line"><span class="comment"> * 描述：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = BaseActivity.class.getName();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        Log.d(TAG, getClass().getSimpleName());</span><br><span class="line">        ActivityCollector.addActivity(<span class="keyword">this</span>);        <span class="comment">// 往集合类中添加activity</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        ActivityCollector.removeActivity(<span class="keyword">this</span>);     <span class="comment">// 当前activity销毁时移除集合类中的对应activity</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后在想要退出的地方调用ActivityCollector.finishAll()方法就行。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/12/《第一行代码_Android》第2章_探究活动/" data-id="cjt2oa2eh003pz0utjkrscbd2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动端/">移动端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-微信小程序开发" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/03/微信小程序开发/" class="article-date">
  <time datetime="2018-09-03T07:11:06.000Z" itemprop="datePublished">2018-09-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/03/微信小程序开发/">微信小程序开发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目录<br><!-- TOC --></p>
<ul>
<li><a href="#微信小程序开发基本资料">微信小程序开发基本资料</a></li>
<li><a href="#注册并安装开发者工具">注册并安装开发者工具</a></li>
<li><a href="#项目介绍">项目介绍</a><ul>
<li><a href="#小程序配置-appjson">小程序配置 app.json</a></li>
<li><a href="#工具配置-projectconfigjson">工具配置 project.config.json</a></li>
<li><a href="#页面配置-pagejson">页面配置 page.json</a></li>
</ul>
</li>
<li><a href="#wxml-模板">WXML 模板</a><ul>
<li><a href="#wxss-样式">WXSS 样式</a></li>
<li><a href="#js-交互逻辑">JS 交互逻辑</a></li>
</ul>
</li>
<li><a href="#数据绑定">数据绑定</a><ul>
<li><a href="#组件属性绑定">组件属性绑定</a></li>
<li><a href="#控制属性绑定">控制属性绑定</a></li>
<li><a href="#关键字绑定">关键字绑定</a></li>
</ul>
</li>
<li><a href="#运算">运算</a><pre><code>- [三元运算](#三元运算)
</code></pre><ul>
<li><a href="#数学运算">数学运算</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<hr>
<h2 id="微信小程序开发基本资料"><a href="#微信小程序开发基本资料" class="headerlink" title="微信小程序开发基本资料"></a>微信小程序开发基本资料</h2><p>使用学习资料如下：《微信小程序开发》</p>
<p>微信小程序平台：<a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener">https://mp.weixin.qq.com/</a></p>
<p>小程序开发文档如下：<a href="https://developers.weixin.qq.com/miniprogram/dev/?t=20161107" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/?t=20161107</a></p>
<p>微信web开发者工具：<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html?t=18082922" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html?t=18082922</a></p>
<p>工具介绍：<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html</a></p>
<hr>
<h2 id="注册并安装开发者工具"><a href="#注册并安装开发者工具" class="headerlink" title="注册并安装开发者工具"></a>注册并安装开发者工具</h2><p>申请小程序开发者账号：<a href="https://mp.weixin.qq.com/wxopen/waregister?action=step1" target="_blank" rel="noopener">https://mp.weixin.qq.com/wxopen/waregister?action=step1</a> ，按步走如实填写即可。<br><img src="/2018/09/03/微信小程序开发/register.png" alt="register.png"></p>
<p>如下即为开发者工具登录界面，使用微信开发者账号扫一扫登录：<br><img src="/2018/09/03/微信小程序开发/开发者工具.png" alt="开发者工具.png"></p>
<p>按需求选择开发程序，这里使用“小程序项目”：<br><img src="/2018/09/03/微信小程序开发/开发者工具-choice.png" alt="开发者工具-choice.png"></p>
<p>小程序项目管理界面，项目目录就是文件存放地址，自己选择；登录 <a href="https://mp.weixin.qq.com" target="_blank" rel="noopener">https://mp.weixin.qq.com</a> ，我们可以在菜单 “设置”-“开发设置” 看到小程序的 AppID 了 。<br><img src="/2018/09/03/微信小程序开发/开发者工具-小程序项目.png" alt="开发者工具-小程序项目.png"></p>
<p><img src="/2018/09/03/微信小程序开发/开发者工具-AppID.png" alt="开发者工具-AppID.png"></p>
<p>全部设置好后确定，进入开发页面：<br><img src="/2018/09/03/微信小程序开发/FirstWeChatApp.png" alt="FirstWeChatApp.png"></p>
<hr>
<h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>项目里边生成了不同类型的文件:</p>
<ul>
<li>json 后缀的 JSON 配置文件</li>
<li>wxml 后缀的 WXML 模板文件</li>
<li>wxss 后缀的 WXSS 样式文件</li>
<li>js 后缀的 JS 脚本逻辑文件</li>
</ul>
<p>代码构成：<a href="https://developers.weixin.qq.com/miniprogram/dev/quickstart/basic/file.html#json-%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/quickstart/basic/file.html#json-%E9%85%8D%E7%BD%AE</a></p>
<h3 id="小程序配置-app-json"><a href="#小程序配置-app-json" class="headerlink" title="小程序配置 app.json"></a>小程序配置 app.json</h3><p>app.json 是当前小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、底部 tab 等。</p>
<p><img src="/2018/09/03/微信小程序开发/appjson.jpg" alt="appjson.jpg"></p>
<pre><code>pages字段 —— 用于描述当前小程序所有页面路径，这是为了让微信客户端知道当前你的小程序页面定义在哪个目录。
window字段 —— 定义小程序所有页面的顶部背景颜色，文字颜色定义等。
</code></pre><p>更多：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE</a></p>
<h3 id="工具配置-project-config-json"><a href="#工具配置-project-config-json" class="headerlink" title="工具配置 project.config.json"></a>工具配置 project.config.json</h3><p>通常大家在使用一个工具的时候，都会针对各自喜好做一些个性化配置，例如界面颜色、编译配置等等，当你换了另外一台电脑重新安装工具的时候，你还要重新配置。</p>
<p>考虑到这点，小程序开发者工具在每个项目的根目录都会生成一个 project.config.json，你在工具上做的任何配置都会写入到这个文件，当你重新安装工具或者换电脑工作时，你只要载入同一个项目的代码包，开发者工具就自动会帮你恢复到当时你开发项目时的个性化配置，其中会包括编辑器的颜色、代码上传时自动压缩等等一系列选项。</p>
<p>更多：<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html</a></p>
<h3 id="页面配置-page-json"><a href="#页面配置-page-json" class="headerlink" title="页面配置 page.json"></a>页面配置 page.json</h3><p>如果你整个小程序的风格是蓝色调，那么你可以在 app.json 里边声明顶部颜色是蓝色即可。实际情况可能不是这样，可能你小程序里边的每个页面都有不一样的色调来区分不同功能模块，因此我们提供了 page.json，让开发者可以独立定义每个页面的一些属性，例如刚刚说的顶部颜色、是否允许下拉刷新等等。</p>
<h2 id="WXML-模板"><a href="#WXML-模板" class="headerlink" title="WXML 模板"></a>WXML 模板</h2><p>WXML（WeiXin Markup Language）是框架设计的一套标签语言，结合基础组件、事件系统，可以构建出页面的结构。</p>
<p>从事过网页编程的人知道，网页编程采用的是 HTML + CSS + JS 这样的组合，其中 HTML 是用来描述当前这个页面的结构，CSS 用来描述页面的样子，JS 通常是用来处理这个页面和用户的交互。</p>
<p>同样道理，在小程序中也有同样的角色，其中 WXML 充当的就是类似 HTML 的角色。</p>
<p>更多：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/index.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/index.html</a></p>
<h3 id="WXSS-样式"><a href="#WXSS-样式" class="headerlink" title="WXSS 样式"></a>WXSS 样式</h3><p>WXSS 具有 CSS 大部分的特性，小程序在 WXSS 也做了一些扩充和修改。</p>
<ul>
<li><p>新增了尺寸单位。在写 CSS 样式时，开发者需要考虑到手机设备的屏幕会有不同的宽度和设备像素比，采用一些技巧来换算一些像素单位。WXSS 在底层支持新的尺寸单位 rpx ，开发者可以免去换算的烦恼，只要交给小程序底层来换算即可，由于换算采用的浮点数运算，所以运算结果会和预期结果有一点点偏差。</p>
</li>
<li><p>提供了全局的样式和局部样式。和前边 app.json, page.json 的概念相同，你可以写一个 app.wxss 作为全局样式，会作用于当前小程序的所有页面，局部页面样式 page.wxss 仅对当前页面生效。</p>
</li>
<li><p>此外 WXSS 仅支持部分 CSS 选择器</p>
</li>
</ul>
<p>更详细的文档可以参考 WXSS 。</p>
<p>更多：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html</a></p>
<h3 id="JS-交互逻辑"><a href="#JS-交互逻辑" class="headerlink" title="JS 交互逻辑"></a>JS 交互逻辑</h3><p>一个服务仅仅只有界面展示是不够的，还需要和用户做交互：响应用户的点击、获取用户的位置等等。在小程序里边，我们就通过编写 JS 脚本文件来处理用户的操作。</p>
<p>更多：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html</a></p>
<hr>
<h2 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h2><p>WXML页面中的动态数据都是来自js文件Page的data，数据绑定通过双大括号将变量包起来，在WXML页面里将数据值显示出来。Page中的data存放是通过键值对的方式存放。</p>
<p>大括号是小程序特有的表示方式。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        msg: <span class="string">'123'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="组件属性绑定"><a href="#组件属性绑定" class="headerlink" title="组件属性绑定"></a>组件属性绑定</h3><p>将data里的数据绑定到微信小程序的组件上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line">&lt;view id=&quot;item-&#123;&#123;id&#125;&#125;&quot;&gt;&lt;/view&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        id: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="控制属性绑定"><a href="#控制属性绑定" class="headerlink" title="控制属性绑定"></a>控制属性绑定</h3><p>用来进行if语句条件判断，如果满足条件则执行，否则不执行。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;condition&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        condition: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="关键字绑定"><a href="#关键字绑定" class="headerlink" title="关键字绑定"></a>关键字绑定</h3><p>常用于组件的一些关键字，像复选框组件如果需要等于true则代表选中复选框，false代表不选中复选框。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line">&lt;checkbox checked=&apos;&#123;&#123;true&#125;&#125;&apos;&gt;&lt;/checkbox&gt;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h2><p>可以在大括号内进行简单的运算。</p>
<h4 id="三元运算"><a href="#三元运算" class="headerlink" title="三元运算"></a>三元运算</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line">&lt;view hidden=&apos;&#123;&#123;flag ? true : false&#125;&#125;&apos;&gt;&lt;/view&gt;</span><br></pre></td></tr></table></figure>
<h3 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line">&lt;view&gt;&#123;&#123;a + b&#125;&#125; + &#123;&#123;c&#125;&#125;&lt;/view&gt;      // 3 + 3</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        a: <span class="number">1</span>, </span><br><span class="line">        b: <span class="number">2</span>,</span><br><span class="line">        c: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">### 逻辑判断</span><br><span class="line"><span class="string">``</span><span class="string">`wxml</span></span><br><span class="line"><span class="string">index.wxml:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;view wx:if="&#123;&#123;length &gt; 5&#125;&#125;"&gt;&lt;/view&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="字符串运算"><a href="#字符串运算" class="headerlink" title="字符串运算"></a>字符串运算</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line">&lt;view&gt;&#123;&#123;&quot;hello&quot; + name&#125;&#125;&lt;/view&gt;     //helloMINA</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        name: <span class="string">'MINA'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h2><h3 id="wx-for-列表渲染单个组件"><a href="#wx-for-列表渲染单个组件" class="headerlink" title="wx:for 列表渲染单个组件"></a>wx:for 列表渲染单个组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.wxml:</span><br><span class="line"></span><br><span class="line">&lt;!-- arr:数组名, index:键名/索引, item:键值 --&gt;</span><br><span class="line">&lt;!-- 可以通过wx:for-index和wx:for-item修改元素的默认索引和键值 --&gt;</span><br><span class="line">&lt;view wx:for=&quot;&#123;&#123;arr&#125;&#125;&quot; wx:key=&quot;&#123;&#123;index&#125;&#125;&quot;&gt;</span><br><span class="line">    &#123;&#123;index&#125;&#125;:&#123;&#123;item&#125;&#125;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">index.js</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        arr: [<span class="string">"苹果"</span>,<span class="string">"香蕉"</span>,<span class="string">"西瓜"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2018/09/03/微信小程序开发/列表渲染.jpg" alt="列表渲染"></p>
<hr>
<h3 id="block-wx-for列表渲染多个组件"><a href="#block-wx-for列表渲染多个组件" class="headerlink" title="block wx:for列表渲染多个组件"></a>block wx:for列表渲染多个组件</h3><p>使用block标签代替view标签即可。循环之后之后内容，没用多余的标签。</p>
<hr>
<h2 id="尺寸自适应"><a href="#尺寸自适应" class="headerlink" title="尺寸自适应"></a>尺寸自适应</h2><p>rpx单位是微信小程序中css的尺寸单位，rpx可以根据屏幕宽度进行自适应。</p>
<p>规定屏幕宽为750rpx。如在 iPhone6 上，屏幕宽度为375px，共有750个物理像素，则750rpx = 375px = 750物理像素，1rpx = 0.5px</p>
<table>
<thead>
<tr>
<th>设备</th>
<th>rpx换算px (屏幕宽度/750)</th>
<th>px换算rpx (750/屏幕宽度)</th>
</tr>
</thead>
<tbody>
<tr>
<td>iPhone5</td>
<td>1rpx = 0.42px 　</td>
<td>　    1px = 2.34px</td>
</tr>
<tr>
<td>iPhone6</td>
<td>1rpx = 0.5px 　</td>
<td>　　　1px = 2rpx</td>
</tr>
<tr>
<td>iPhone6s</td>
<td>1rpx = 0.552px 　</td>
<td>　  1px = 1.81rpx</td>
</tr>
</tbody>
</table>
<p>将屏幕布局设置为750像素，然后使用rpx单位即可自动适应。</p>
<hr>
<h2 id="模板及模板引用"><a href="#模板及模板引用" class="headerlink" title="模板及模板引用"></a>模板及模板引用</h2><h3 id="样式导入"><a href="#样式导入" class="headerlink" title="样式导入"></a>样式导入</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"导入的wxss路径"</span>;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/03/微信小程序开发/" data-id="cjt2oa293002rz0ut8hibkvku" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/小程序/">小程序</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动端/">移动端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android开发之手机影音" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/26/Android开发之手机影音/" class="article-date">
  <time datetime="2018-08-26T06:44:25.000Z" itemprop="datePublished">2018-08-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/26/Android开发之手机影音/">Android开发之手机影音</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#anroid开发之手机影音">Anroid开发之手机影音</a><ul>
<li><a href="#手机影音项目总结">手机影音项目总结</a></li>
<li><a href="#启动页面">启动页面</a></li>
<li><a href="#启动跳转">启动跳转</a><pre><code>- [普通跳转：](#普通跳转)
- [单例模式+移除消息实现提前跳转](#单例模式移除消息实现提前跳转)
- [通过启动判断](#通过启动判断)
</code></pre></li>
<li><a href="#app名与图表">App名与图表</a></li>
<li><a href="#主界面软件架构分析">主界面——软件架构分析</a></li>
<li><a href="#主页面底部选择按钮">主页面——底部选择按钮</a></li>
<li><a href="#主页面framelayout显示">主页面——FrameLayout显示</a></li>
<li><a href="#顶部标题栏">顶部标题栏</a></li>
<li><a href="#自定义标题栏点击事件">自定义标题栏点击事件</a></li>
<li><a href="#本地视频列表布局">本地视频列表布局</a><ul>
<li><a href="#1-写布局相对布局listview和textview和progressbar并初始化">1. 写布局，相对布局：ListView和TextView和ProgressBar，并初始化</a></li>
<li><a href="#2-加载本地视频在子线程中加载视频加载的视频放入集合中设置适配器要放在主线程中用handler设置适配器">2. 加载本地视频，在子线程中加载视频，加载的视频放入集合中：设置适配器要放在主线程中，用Handler设置适配器。</a></li>
<li><a href="#3-设置item的点击事件把视频播放出来">3. 设置item的点击事件，把视频播放出来</a></li>
</ul>
</li>
<li><a href="#activity的生命周期">Activity的生命周期</a></li>
<li><a href="#activity横竖屏切换的生命周期">Activity横竖屏切换的生命周期</a></li>
<li><a href="#播放器控制面板">播放器控制面板</a></li>
<li><a href="#视频seekbar进度更新">视频SeekBar进度更新</a><ul>
<li><a href="#1-视频的总时长和seekbaar的setmax设置总时长">1. 视频的总时长和SeekBaar的setMax设置总时长)</a></li>
<li><a href="#2-实例化handler每秒得到当前播放进度seekbar的getprogress更新当前进度">2. 实例化Handler，每秒得到当前播放进度，SeekBar的getProgress更新当前进度</a></li>
</ul>
</li>
<li><a href="#视频seekbar拖动">视频SeekBar拖动</a></li>
<li><a href="#设置电池状态">设置电池状态</a></li>
<li><a href="#设置系统时间">设置系统时间</a></li>
<li><a href="#传递播放列表">传递播放列表</a></li>
<li><a href="#播放上一个下一个视频及自动跳转">播放上一个/下一个视频及自动跳转</a></li>
<li><a href="#手势识别">手势识别</a></li>
<li><a href="#控制面板自动延迟隐藏">控制面板自动延迟隐藏</a></li>
<li><a href="#自定义videoview实现视频画面大小">自定义VideoView实现视频画面大小</a></li>
<li><a href="#声音设置">声音设置</a><ul>
<li><a href="#1-实例化audiomanager">1. 实例化AudioManager</a></li>
<li><a href="#2-设置当前音量和最大音量">2. 设置当前音量和最大音量</a></li>
<li><a href="#3-设置seekbar状态变化">3. 设置SeekBar状态变化</a></li>
<li><a href="#4-静音设置及按钮监听">4. 静音设置及按钮监听</a></li>
</ul>
</li>
<li><a href="#屏幕上下滑动实现声音大小变化">屏幕上下滑动实现声音大小变化</a></li>
<li><a href="#通过手机音量按键改变声音大小">通过手机音量按键改变声音大小</a></li>
<li><a href="#让其他软件能调用我们的播放器">让其他软件能调用我们的播放器</a><ul>
<li><a href="#方法一参照系统源代码在功能清单源代码中添加属性">方法一：参照系统源代码，在功能清单源代码中添加属性。</a></li>
<li><a href="#文件调用过程如下">文件调用过程如下：</a></li>
</ul>
</li>
<li><a href="#加载播放网络资源视频">加载播放网络资源视频</a></li>
<li><a href="#添加网络视频缓冲">添加网络视频缓冲</a></li>
<li><a href="#设置监听播放网络视频卡顿">设置监听播放网络视频卡顿</a></li>
<li><a href="#自定义监听卡">自定义监听卡</a></li>
<li><a href="#加载视频等待页面">加载视频等待页面</a></li>
<li><a href="#设置网速">设置网速</a></li>
<li><a href="#播放出错处理万能解码框架-vitamio">播放出错处理——万能解码框架 Vitamio</a><ul>
<li><a href="#1-关联vitamio">1. 关联Vitamio</a></li>
<li><a href="#2">2.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<hr>
<h2 id="Anroid开发之手机影音"><a href="#Anroid开发之手机影音" class="headerlink" title="Anroid开发之手机影音"></a>Anroid开发之手机影音</h2><p>此学习笔记来源于“尚硅谷——Android项目视频——手机影音”</p>
<hr>
<p>svn资源地址：<a href="https://47.96.118.115/svn/MobliePlayer" target="_blank" rel="noopener">https://47.96.118.115/svn/MobliePlayer</a></p>
<hr>
<h3 id="手机影音项目总结"><a href="#手机影音项目总结" class="headerlink" title="手机影音项目总结"></a>手机影音项目总结</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">1. 市场上百分之八十的软件架构</span><br><span class="line">2. 读取本地视频</span><br><span class="line">3. VideoView和MediaPlayer</span><br><span class="line">4. VideoView继承SurfaceView</span><br><span class="line">5. MediaPlayer的三个监听：错误监听，准备监听，播放完成监听</span><br><span class="line">6. 播放列表传递-序列化</span><br><span class="line">7. 播放器相关逻辑：调节声音，滑动屏幕改变声音</span><br><span class="line">8. 手势识别器</span><br><span class="line">9. 注册监听电量广播</span><br><span class="line">10. 得到系统时间</span><br><span class="line">11. 自定义VideoView，实现视频画面的大小变化</span><br><span class="line">12. Ffmpeg，VLC，Vitamio</span><br><span class="line">13. 使用Vitamio打造万能播放器</span><br><span class="line">14. 电视直播</span><br><span class="line">15. 视频播放进度的更新</span><br><span class="line"></span><br><span class="line">16. 本地音乐读取</span><br><span class="line">17. Activity通过AIDL接口文件个Service进行交互</span><br><span class="line">18. 设置音乐的播放模式</span><br><span class="line">19. 根据播放的音乐显示不同的频谱</span><br><span class="line">20. 歌词显示空间的封装</span><br><span class="line">21. 歌词解析</span><br><span class="line">22. 歌词同步</span><br><span class="line">23. 歌词解决乱码问题</span><br><span class="line">24. 使用xUtils请求网络数据和网络图片</span><br><span class="line">25. 手动解析jsohn</span><br><span class="line">26. 数据缓存</span><br><span class="line">27. 标题栏的编写</span><br><span class="line">28. EventBus</span><br><span class="line">29. 手动判断视频是否卡</span><br><span class="line">30. 监听外部请求播放视频</span><br><span class="line">31. 拼比横竖屏切换</span><br><span class="line">32. xListView的使用，下拉刷新</span><br><span class="line">33. 调节声音AudioManger</span><br><span class="line"></span><br><span class="line">重点掌握：</span><br><span class="line">多媒体相关，视频播放器</span><br><span class="line">软件框架和联网模块</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="启动页面"><a href="#启动页面" class="headerlink" title="启动页面"></a>启动页面</h3><p>效果：软件启动的第一个节目。</p>
<p>软件启动时的欢迎页面，称为SplashActivity，LaucherActivity，WelcomeActivity等。</p>
<p>首先创建名为“MobliePlayer”的项目，设置第一个Activity名称为”SplashActivity”作为启动页面。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"#fff"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">"com.me.moblieplayer.SplashActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/iv_splash_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"80dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/login_icon"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">"@id/iv_splash_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"正在启动..."</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18sp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/08/26/Android开发之手机影音/SplashActivity.jpg" alt=""></p>
<hr>
<h3 id="启动跳转"><a href="#启动跳转" class="headerlink" title="启动跳转"></a>启动跳转</h3><p>效果：实现特定时间从启动界面跳转到主界面。</p>
<p>如果只是普通的定时跳转，则调用Handler对象的postDelay()方法即可。但是如果要实现提前跳转，则需要特殊的操作，如果处理不好将出现极其影响用户体验的bug。</p>
<p>添加主界面：新建Activity，名为“MainActivity”，并在“AndroidManifest.xml”中注册。</p>
<p>“MainActivity”测试界面如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.me.moblieplayer.activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.Gravity;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 添加一个TextView并显示在屏幕中间</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TextView textView = <span class="keyword">new</span> TextView(<span class="keyword">this</span>);</span><br><span class="line">        textView.setText(<span class="string">"我是主页面"</span>);</span><br><span class="line">        textView.setTextSize(<span class="number">30</span>);</span><br><span class="line">        textView.setGravity(Gravity.CENTER);</span><br><span class="line">        textView.setTextColor(Color.RED);</span><br><span class="line"></span><br><span class="line">        setContentView(textView);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/26/Android开发之手机影音/MainActivityTest.jpg" alt=""></p>
<h5 id="普通跳转："><a href="#普通跳转：" class="headerlink" title="普通跳转："></a>普通跳转：</h5><p>两秒钟后自动从启动界面跳转到主界面。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.moblieplayer.activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.moblieplayer.R;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplashActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = SplashActivity.class.getSimpleName();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_splash);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 两秒后才执行</span></span><br><span class="line">                <span class="comment">// 执行在主线程中，因为Hnadler在主线程中new</span></span><br><span class="line">                startMainActivity();</span><br><span class="line">                Log.e(TAG, <span class="string">"当前线程名称=="</span> + Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 跳转到主页面，并且把当前界面关闭</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMainActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">        <span class="comment">// 关闭当前界面</span></span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="单例模式-移除消息实现提前跳转"><a href="#单例模式-移除消息实现提前跳转" class="headerlink" title="单例模式+移除消息实现提前跳转"></a>单例模式+移除消息实现提前跳转</h5><p>允许主界面启动方法启动多次，但是只执行一次。</p>
<p>单例模式：在“AndroidManifest.xml”中主界面“MainActivity”注册时，设置launchMod启动模式为“singleTask”单例模式，则主界面只启动一次。但是只是设置单例模式，在跳转过程中会出现仍然打开主界面的bug。</p>
<p>在”AndroidManifest.xml”文件中注册主界面，并设置单例模式：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".activity.MainActivity"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:launchMode</span>=<span class="string">"singleTask"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>“SplashActivity.java”中设置onDestroy()移除handler回调和信息，将Handler定义为类的成员变量，然后退出时销毁，就不会出现在跳转过程中退出后，仍然执行定时跳转的bug。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.moblieplayer.activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.moblieplayer.R;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplashActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = SplashActivity.class.getSimpleName();         <span class="comment">//动态获得类名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_splash);</span><br><span class="line"></span><br><span class="line">        handler.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 两秒后才执行</span></span><br><span class="line">                <span class="comment">// 执行在主线程中，因为Hnadler在主线程中new</span></span><br><span class="line">                startMainActivity();</span><br><span class="line">                Log.e(TAG, <span class="string">"当前线程名称=="</span> + Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 跳转到主页面，并且把当前界面关闭</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMainActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">        <span class="comment">// 关闭当前界面</span></span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 触摸事件，跳过等待</span></span><br><span class="line"><span class="comment">     * 此处就是需要特殊处理的原因，触摸事件会导致多次启动主界面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"onTouchEvent == Action"</span> + event.getAction());</span><br><span class="line">        startMainActivity();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        handler.removeCallbacksAndMessages(<span class="keyword">null</span>);        <span class="comment">// 移除handler的回调和消息</span></span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="通过启动判断"><a href="#通过启动判断" class="headerlink" title="通过启动判断"></a>通过启动判断</h5><p>从源头上主界面启动方法只能启动一次。</p>
<p>此处在”AndroidManifest.xml”文件中注册主界面即可，不需要设置为单例模式：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".activity.MainActivity"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>修改主页面启动方法，添加一个isStartMain属性判断是否启动过。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跳转到主页面，并且把当前界面关闭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMainActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">    <span class="comment">// 关闭当前界面</span></span><br><span class="line">    finish();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">修改为如下代码：</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isStartMain = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跳转到主页面，并且把当前界面关闭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMainActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!isStartMain)&#123;</span><br><span class="line">        isStartMain = <span class="keyword">true</span>;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">        <span class="comment">// 关闭当前界面</span></span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="App名与图表"><a href="#App名与图表" class="headerlink" title="App名与图表"></a>App名与图表</h3><p>在功能清单目录“AndroidManifest.xml”中“android:icon=”@mipmap/ic_launcher””为app的图表，替换掉原先的图表即可，“android:label=”@string/app_name””为app的名称，通过快捷键“Ctrl + 鼠标左键”进入“strings.xml”修改对应的“app_name”即可。</p>
<p>“strings.xml”，字符串文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"app_name"</span>&gt;</span>手机影音<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="主界面——软件架构分析"><a href="#主界面——软件架构分析" class="headerlink" title="主界面——软件架构分析"></a>主界面——软件架构分析</h3><p><img src="/2018/08/26/Android开发之手机影音/软件实现分析.png" alt=""></p>
<p><img src="/2018/08/26/Android开发之手机影音/分析软件的架构.png" alt=""></p>
<hr>
<h3 id="主页面——底部选择按钮"><a href="#主页面——底部选择按钮" class="headerlink" title="主页面——底部选择按钮"></a>主页面——底部选择按钮</h3><p>使用RadioGroup实现底部的选择按钮，效果图如下：</p>
<p><img src="/2018/08/26/Android开发之手机影音/MainRadioGroup.jpg" alt=""></p>
<p>在“activity_main.xml”文件中添加RadioGroup：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">".activity.MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 标题栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- FrameLayout --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/fl_main_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- RadioGroup --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RadioGroup</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/rg_bottom_tag"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#11000000"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 将相同内容打包成style，然后四个RadioButton统一使用一种style --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 为图片设置选择器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RadioButton</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"@style/bottom_tag_style"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/rb_video"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"本地视频"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawableTop</span>=<span class="string">"@drawable/rb_video_drawable_selector"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RadioButton</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"@style/bottom_tag_style"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/rb_audio"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"本地音频"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawableTop</span>=<span class="string">"@drawable/rb_audio_drawable_selector"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RadioButton</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"@style/bottom_tag_style"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/rb_net_video"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"本地视频"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawableTop</span>=<span class="string">"@drawable/rb_net_video_drawable_selector"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RadioButton</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">"@style/bottom_tag_style"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/rb_net_audio"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"本地视频"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawableTop</span>=<span class="string">"@drawable/rb_net_audio_drawable_selector"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RadioGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>style目录下的格式资源文件”style.xml”中添加自定义底部的格式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义底部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"bottom_tag_style"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_width"</span>&gt;</span>wrap_content<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_height"</span>&gt;</span>wrap_content<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_weight"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:layout_gravity"</span>&gt;</span>center_vertical<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:gravity"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>@drawable/rb_video_textcolor_selector<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:drawablePadding"</span>&gt;</span>3dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:button"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span>            <span class="comment">&lt;!-- 设置透明选择按钮透明 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>10sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>图片选择器和文本选择器设置如下：<br>“rb_video_drawable_selector.xml”视频图片选择器，其他图片选择器同理:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"false"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/ic_tab_video"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"true"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/ic_tab_video_press"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>“rb_video_textcolor_selector”文字颜色选择器：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"false"</span> <span class="attr">android:color</span>=<span class="string">"#363636"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">"true"</span> <span class="attr">android:color</span>=<span class="string">"#3097FD"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>此时的项目已经能实现选择效果了，但是并没有设置默认选择，需要在“MainActivity.java”文件中初始化并设置默认选择项。</p>
<p>“MainActivity.java”:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.moblieplayer.activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.FrameLayout;</span><br><span class="line"><span class="keyword">import</span> android.widget.RadioGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.moblieplayer.R;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FrameLayout fl_main_content;</span><br><span class="line">    <span class="keyword">private</span> RadioGroup rg_bottom_tag;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        fl_main_content = (FrameLayout) findViewById(R.id.fl_main_content);</span><br><span class="line">        rg_bottom_tag = (RadioGroup) findViewById(R.id.rg_bottom_tag);</span><br><span class="line"></span><br><span class="line">        rg_bottom_tag.check(R.id.rb_video);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="主页面——FrameLayout显示"><a href="#主页面——FrameLayout显示" class="headerlink" title="主页面——FrameLayout显示"></a>主页面——FrameLayout显示</h3><p>主页面中间区域使用FrameLayout帧布局，FrameLayout可以叠加，被覆盖时无法看见，效果比较好。因此与Fragment复合使用一般用FrameLayout。</p>
<p>这里我们创建四个Fragment，分别是VideoPager，AudioPager, NetVideoPager，NetAudioPager，用以装载与底部四个对应的界面。用四个Fragment都继承BasePager基本页面，将四个Fragment放集合中，并用BasePager作为泛型会很方便。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BasePager 说明：</span><br><span class="line">a. 构造方法时候，创建视图，initView()，子类强制实现该方法。</span><br><span class="line">b. 在initData()，初始化子页面数据。</span><br></pre></td></tr></table></figure>
<p>创建base包，并创建BasePager基类，isInitData控制初始化，在架构中使用这种方法可以节省时间和流量，避免重复初始化，提高用户体验。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.base;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：aijunhao</span></span><br><span class="line"><span class="comment"> * 时间：2018.8.29</span></span><br><span class="line"><span class="comment"> * 作用：四个Pager的基类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上下文</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Context context;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收各个页面的实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> View rootView;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否初始化数据，避免重复初始化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> isInitData;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasePager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">        rootView = initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 强制子页面实现该方法，实现想要的特定的效果</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> View <span class="title">initView</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当子页面，需要绑定数据，或者联网请求数据并且绑定的时候，重写该方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AudioPager继承BasePager的测试页面代码如下，其他三个页面同理：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.pager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.view.Gravity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.base.BasePager;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.utils.LogUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：aijunhao</span></span><br><span class="line"><span class="comment"> * 时间：2018.8.29</span></span><br><span class="line"><span class="comment"> * 作用：网络音频页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudioPager</span> <span class="keyword">extends</span> <span class="title">BasePager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView textView;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AudioPager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化当前页面的控件，由父类调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        textView = <span class="keyword">new</span> TextView(context);</span><br><span class="line">        textView.setTextSize(<span class="number">30</span>);</span><br><span class="line">        textView.setTextColor(Color.RED);</span><br><span class="line">        textView.setGravity(Gravity.CENTER);</span><br><span class="line">        <span class="keyword">return</span> textView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.initData();</span><br><span class="line">        LogUtil.e(<span class="string">"本地音频的数据被初始化了。。。"</span>);</span><br><span class="line">        <span class="comment">//联网</span></span><br><span class="line">        <span class="comment">//音频内容</span></span><br><span class="line">        textView.setText(<span class="string">"本地音频的内容"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在“MainActivity.java”文件中添加页面集合，并为RadioGroup添加改变监听：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.app.Fragment;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.app.FragmentActivity;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.app.FragmentManager;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.app.FragmentTransaction;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.RadioGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.R;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.base.BasePager;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.pager.AudioPager;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.pager.NetAudioPager;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.pager.NetVideoPager;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.pager.VideoPager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：aijunhao</span></span><br><span class="line"><span class="comment"> * 时间：2018.8.29</span></span><br><span class="line"><span class="comment"> * 作用：主界面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">FragmentActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RadioGroup  rg_bottom_tag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;BasePager&gt; basePagers;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 选中的位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> position;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        rg_bottom_tag = (RadioGroup) findViewById(R.id.rg_bottom_tag);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        basePagers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        basePagers.add(<span class="keyword">new</span> VideoPager(<span class="keyword">this</span>));<span class="comment">//添加本地视频页面-0</span></span><br><span class="line">        basePagers.add(<span class="keyword">new</span> AudioPager(<span class="keyword">this</span>));<span class="comment">//添加本地音乐页面-1</span></span><br><span class="line">        basePagers.add(<span class="keyword">new</span> NetVideoPager(<span class="keyword">this</span>));<span class="comment">//添加网络视频页面-2</span></span><br><span class="line">        basePagers.add(<span class="keyword">new</span> NetAudioPager(<span class="keyword">this</span>));<span class="comment">//添加网络音频页面-3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置RadioGroup的监听</span></span><br><span class="line">        rg_bottom_tag.setOnCheckedChangeListener(<span class="keyword">new</span> MyOnCheckedChangeListener());</span><br><span class="line">        rg_bottom_tag.check(R.id.rb_video);<span class="comment">//默认选中首页</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyOnCheckedChangeListener</span> <span class="keyword">implements</span> <span class="title">RadioGroup</span>.<span class="title">OnCheckedChangeListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(RadioGroup group, <span class="keyword">int</span> checkedId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (checkedId)&#123;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    position = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> R.id.rb_audio:<span class="comment">//音频</span></span><br><span class="line">                    position = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> R.id.rb_net_video:<span class="comment">//网络视频</span></span><br><span class="line">                    position = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> R.id.rb_net_audio:<span class="comment">//网络音频</span></span><br><span class="line">                    position = <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            setFragment();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把页面添加到Fragment中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setFragment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.得到FragmentManger</span></span><br><span class="line">        FragmentManager manager = getSupportFragmentManager();</span><br><span class="line">        <span class="comment">//2.开启事务</span></span><br><span class="line">        FragmentTransaction ft = manager.beginTransaction();</span><br><span class="line">        <span class="comment">//3.替换</span></span><br><span class="line">        ft.replace(R.id.fl_main_content,<span class="keyword">new</span> Fragment()&#123;</span><br><span class="line">            <span class="meta">@Nullable</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">                BasePager basePager = getBasePager();</span><br><span class="line">                <span class="keyword">if</span>(basePager != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//各个页面的视图</span></span><br><span class="line">                    <span class="keyword">return</span> basePager.rootView;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//4.提交事务</span></span><br><span class="line">        ft.commit();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据位置得到对应的页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> BasePager <span class="title">getBasePager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BasePager basePager = basePagers.get(position);</span><br><span class="line">        <span class="keyword">if</span>(basePager != <span class="keyword">null</span>&amp;&amp;!basePager.isInitData)&#123;</span><br><span class="line">            basePager.initData();<span class="comment">//联网请求或者绑定数据</span></span><br><span class="line">            basePager.isInitData = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> basePager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>LogUtil.java为log工具类，直接复制即可：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;</span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Formatter;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by GaryChan on 16/5/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String customTagPrefix = <span class="string">""</span>;  <span class="comment">// 自定义Tag的前缀，可以是作者名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> isSaveLog = <span class="keyword">false</span>;    <span class="comment">// 是否把保存日志到SD卡中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOG_PATH = Environment.getExternalStorageDirectory().getPath(); <span class="comment">// SD卡中的根目录</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>, Locale.SIMPLIFIED_CHINESE);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LogUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 容许打印日志的类型，默认是true，设置为false则不打印</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> allowD = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> allowE = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> allowI = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> allowV = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> allowW = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> allowWtf = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">generateTag</span><span class="params">(StackTraceElement caller)</span> </span>&#123;</span><br><span class="line">        String tag = <span class="string">"%s.%s(Line:%d)"</span>; <span class="comment">// 占位符</span></span><br><span class="line">        String callerClazzName = caller.getClassName(); <span class="comment">// 获取到类名</span></span><br><span class="line">        callerClazzName = callerClazzName.substring(callerClazzName.lastIndexOf(<span class="string">"."</span>) + <span class="number">1</span>);</span><br><span class="line">        tag = String.format(tag, callerClazzName, caller.getMethodName(), caller.getLineNumber()); <span class="comment">// 替换</span></span><br><span class="line">        tag = TextUtils.isEmpty(customTagPrefix) ? tag : customTagPrefix + <span class="string">":"</span> + tag;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义的logger</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CustomLogger customLogger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomLogger</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">d</span><span class="params">(String tag, String content)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">d</span><span class="params">(String tag, String content, Throwable e)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">e</span><span class="params">(String tag, String content)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">e</span><span class="params">(String tag, String content, Throwable e)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">i</span><span class="params">(String tag, String content)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">i</span><span class="params">(String tag, String content, Throwable e)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">v</span><span class="params">(String tag, String content)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">v</span><span class="params">(String tag, String content, Throwable e)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">w</span><span class="params">(String tag, String content)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">w</span><span class="params">(String tag, String content, Throwable e)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">w</span><span class="params">(String tag, Throwable tr)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">wtf</span><span class="params">(String tag, String content)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">wtf</span><span class="params">(String tag, String content, Throwable e)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">wtf</span><span class="params">(String tag, Throwable tr)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowD) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.d(tag, content);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">(String content, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowD) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.d(tag, content, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(tag, content, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowE) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.e(tag, content);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.e(tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowE) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.e(tag, <span class="string">"error"</span>, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.e(tag, e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">e</span><span class="params">(String content, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowE) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.e(tag, content, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.e(tag, content, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowI) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.i(tag, content);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.i(tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String content, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowI) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.i(tag, content, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.i(tag, content, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowV) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.v(tag, content);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.v(tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">v</span><span class="params">(String content, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowV) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.v(tag, content, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.v(tag, content, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowW) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.w(tag, content);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.w(tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(String content, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowW) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.w(tag, content, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.w(tag, content, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">w</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowW) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.w(tag, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.w(tag, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wtf</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowWtf) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.wtf(tag, content);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.wtf(tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wtf</span><span class="params">(String content, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowWtf) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.wtf(tag, content, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.wtf(tag, content, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wtf</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!allowWtf) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StackTraceElement caller = getCallerStackTraceElement();</span><br><span class="line">        String tag = generateTag(caller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (customLogger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            customLogger.wtf(tag, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.wtf(tag, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isSaveLog) &#123;</span><br><span class="line">            point(LOG_PATH, tag, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> StackTraceElement <span class="title">getCallerStackTraceElement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread().getStackTrace()[<span class="number">4</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">point</span><span class="params">(String path, String tag, String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isSDAva()) &#123;</span><br><span class="line">            <span class="keyword">long</span> timestamp = System.currentTimeMillis();</span><br><span class="line">            String time = formatter.format(<span class="keyword">new</span> Date());</span><br><span class="line">            path = path + <span class="string">"/logs/log-"</span> + time + <span class="string">"-"</span> + timestamp + <span class="string">".log"</span>;</span><br><span class="line"></span><br><span class="line">            File file = <span class="keyword">new</span> File(path);</span><br><span class="line">            <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                createDipPath(path);</span><br><span class="line">            &#125;</span><br><span class="line">            BufferedWriter out = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                out = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(file, <span class="keyword">true</span>)));</span><br><span class="line">                out.write(time + <span class="string">" "</span> + tag + <span class="string">" "</span> + msg + <span class="string">"\r\n"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        out.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据文件路径 递归创建文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createDipPath</span><span class="params">(String file)</span> </span>&#123;</span><br><span class="line">        String parentFile = file.substring(<span class="number">0</span>, file.lastIndexOf(<span class="string">"/"</span>));</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(file);</span><br><span class="line">        File parent = <span class="keyword">new</span> File(parentFile);</span><br><span class="line">        <span class="keyword">if</span> (!file1.exists()) &#123;</span><br><span class="line">            parent.mkdirs();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                file1.createNewFile();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ReusableFormatter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Formatter formatter;</span><br><span class="line">        <span class="keyword">private</span> StringBuilder builder;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ReusableFormatter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            formatter = <span class="keyword">new</span> Formatter(builder);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">format</span><span class="params">(String msg, Object... args)</span> </span>&#123;</span><br><span class="line">            formatter.format(msg, args);</span><br><span class="line">            String s = builder.toString();</span><br><span class="line">            builder.setLength(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;ReusableFormatter&gt; thread_local_formatter = <span class="keyword">new</span> ThreadLocal&lt;ReusableFormatter&gt;() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> ReusableFormatter <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ReusableFormatter();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(String msg, Object... args)</span> </span>&#123;</span><br><span class="line">        ReusableFormatter formatter = thread_local_formatter.get();</span><br><span class="line">        <span class="keyword">return</span> formatter.format(msg, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSDAva</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED) || Environment.getExternalStorageDirectory().exists();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/2018/08/26/Android开发之手机影音/Pagers.gif" alt=""></h2><h3 id="顶部标题栏"><a href="#顶部标题栏" class="headerlink" title="顶部标题栏"></a>顶部标题栏</h3><p><img src="/2018/08/26/Android开发之手机影音/title.png" alt=""></p>
<p>标题栏使用线性布局，一张图片，一个搜索文本框，两张功能图片及角标红点。搜索文本框又包括了图片、文本、椭圆形背景及其选择器。</p>
<p>此处使用include方法导入额外的标题布局文件。</p>
<p>在“activity_main.xml”文件中添加如下代码，淡入标题栏布局：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--标题栏--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/titlebar"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>创建标题栏布局页面：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:background</span>=<span class="string">"#ff3097fd"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"55dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 标题图片 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/ic_topbanner_logo"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 搜索文本框， --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_search"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawablePadding</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawableLeft</span>=<span class="string">"@drawable/tv_search_drawable_selector"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@drawable/tv_search_bg_selector"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@drawable/tv_search_textcolor_selector"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"14sp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:clickable</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"全网搜索"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 游戏图片及角标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/rl_game"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/tv_game"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawableLeft</span>=<span class="string">"@drawable/ic_topbanner_game"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignRight</span>=<span class="string">"@id/tv_game"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"6dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"6dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@drawable/dot"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 历史记录图片 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/iv_record"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/ic_topbanner_record"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>“tv_search_drawable_selector.xml”搜索文本图片框选择器，判断是否按下，使用不同图片，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/ic_sousuokuang"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/ic_sousuokuang_press"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>“tv_search_bg_selector.xml”搜索文本框背景选择器，判断是否按下，并通过shape样式文件实现背景形状控制和背景颜色变换，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/tv_search_bg_shap_normal"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/tv_search_bg_shap_pressed"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>“tv_search_bg_shap_normal.xml”未按下时的背景样式，同理“tv_search_bg_shap_pressed.xml”只要修改背景颜色就行了：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!-- 矩形圆角边框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"12dp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#ff2679ca"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">padding</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:bottom</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:top</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:left</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:right</span>=<span class="string">"8dp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>“tv_search_textcolor_selector.xml”搜索框文字颜色选择器，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:color</span>=<span class="string">"#99ffffff"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span> <span class="attr">android:color</span>=<span class="string">"#ffffff"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>“dot.xml”角标形状资源，代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!-- 椭圆角标 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">android:shape</span>=<span class="string">"oval"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#ff0000"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:height</span>=<span class="string">"6dp"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:width</span>=<span class="string">"6dp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>整体运行效果如下：<br><img src="/2018/08/26/Android开发之手机影音/Title.jpg" alt=""></p>
<hr>
<h3 id="自定义标题栏点击事件"><a href="#自定义标题栏点击事件" class="headerlink" title="自定义标题栏点击事件"></a>自定义标题栏点击事件</h3><p>一般的点击事件是在类中逐个定义对象并设置监听，该方法比较简单，但是不适用于高级架构中，因此我们此时创建TitleBar自定义类来设置标题栏的点击事件。</p>
<p>“TitleBar.java”自定义标题栏类，继承LinearLayout类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.LinearLayout;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.R;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：AiJunhao</span></span><br><span class="line"><span class="comment"> * 日期：2018/8/30 15:18</span></span><br><span class="line"><span class="comment"> * 描述：自定义标题栏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TitleBar</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用View或者具体的View类型都行，不过View兼容任何View子类，较为方法</span></span><br><span class="line">    <span class="keyword">private</span> View tv_search;</span><br><span class="line">    <span class="keyword">private</span> View rl_game;</span><br><span class="line">    <span class="keyword">private</span> View iv_record;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在代码中实例化该类时使用</span></span><br><span class="line"><span class="comment">     * 使用this不用super，在调用该构造函数时将调用两个参数的构造函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TitleBar</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在布局文件中使用</span></span><br><span class="line"><span class="comment">     * 使用this不用super，在调用该构造函数时将调用三个参数的构造函数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TitleBar</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在需要设置样式时候使用</span></span><br><span class="line"><span class="comment">     * 在该构造函数中获取上下文对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defStyleAttr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TitleBar</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当布局文件加载完成的时候回调方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onFinishInflate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 得到子类的实例</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        tv_search = getChildAt(<span class="number">1</span>);</span><br><span class="line">        rl_game = getChildAt(<span class="number">2</span>);</span><br><span class="line">        iv_record = getChildAt(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 设置点击事件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        tv_search.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        rl_game.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        iv_record.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.tv_search:        <span class="comment">// 搜索</span></span><br><span class="line">                Toast.makeText(context, <span class="string">"搜索"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.rl_game:          <span class="comment">// 游戏</span></span><br><span class="line">                Toast.makeText(context, <span class="string">"游戏"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.iv_record:        <span class="comment">// 播放历史</span></span><br><span class="line">                Toast.makeText(context, <span class="string">"播放历史"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样之后，要设置“title.xml”标题栏资源文件使用这个类，修改“title.xml”的布局为TitleBar类型，因为TitleBar类继承LinearLayout，直接修改不会影响原先布局：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">com.me.mobileplayer.view.TitleBar</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"#ff3097fd"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"55dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">com.me.mobileplayer.view.TitleBar</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/26/Android开发之手机影音/TitleOnClick.gif" alt=""></p>
<hr>
<h3 id="本地视频列表布局"><a href="#本地视频列表布局" class="headerlink" title="本地视频列表布局"></a>本地视频列表布局</h3><h4 id="1-写布局，相对布局：ListView和TextView和ProgressBar，并初始化"><a href="#1-写布局，相对布局：ListView和TextView和ProgressBar，并初始化" class="headerlink" title="1. 写布局，相对布局：ListView和TextView和ProgressBar，并初始化"></a>1. 写布局，相对布局：ListView和TextView和ProgressBar，并初始化</h4><p>“video_pager.xml”布局界面代码如下 :<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:divider</span>=<span class="string">"@null"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/listview"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_nomedia"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"没有发现视频..."</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"#000000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"18sp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">"gone"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/pb_loading"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/26/Android开发之手机影音/video_pager.png" alt=""></p>
<p>“item_video_pager.xml”列表适配界面代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"100dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/iv_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"80dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/video_default_icon"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_toRightOf</span>=<span class="string">"@id/iv_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/tv_name"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"视频的名称"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"@android:color/black"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18sp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/tv_time"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"20:00"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"#55000000"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"16sp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_size"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"20MB"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"#55000000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"16sp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#44000000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"1dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/26/Android开发之手机影音/item_video_pager.png" alt=""></p>
<h4 id="2-加载本地视频，在子线程中加载视频，加载的视频放入集合中：设置适配器要放在主线程中，用Handler设置适配器。"><a href="#2-加载本地视频，在子线程中加载视频，加载的视频放入集合中：设置适配器要放在主线程中，用Handler设置适配器。" class="headerlink" title="2. 加载本地视频，在子线程中加载视频，加载的视频放入集合中：设置适配器要放在主线程中，用Handler设置适配器。"></a>2. 加载本地视频，在子线程中加载视频，加载的视频放入集合中：设置适配器要放在主线程中，用Handler设置适配器。</h4><p>“VideoPager.java”视频加载：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.pager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.ContentResolver;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.Cursor;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.Message;</span><br><span class="line"><span class="keyword">import</span> android.provider.MediaStore;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.ListView;</span><br><span class="line"><span class="keyword">import</span> android.widget.ProgressBar;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.R;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.adapter.VideoPagerAdapter;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.base.BasePager;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.domain.MediaItem;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.utils.LogUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：aijunhao</span></span><br><span class="line"><span class="comment"> * 时间：2018.8.29</span></span><br><span class="line"><span class="comment"> * 作用：网络视频页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoPager</span> <span class="keyword">extends</span> <span class="title">BasePager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ListView listview;</span><br><span class="line">    <span class="keyword">private</span> TextView tv_nomedia;</span><br><span class="line">    <span class="keyword">private</span> ProgressBar pb_loading;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> VideoPagerAdapter videoPagerAdapter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 装数据集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;MediaItem&gt; mediaItems;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VideoPager</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">            <span class="keyword">if</span>(mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//有数据</span></span><br><span class="line">                <span class="comment">//设置适配器</span></span><br><span class="line">                videoPagerAdapter = <span class="keyword">new</span> VideoPagerAdapter(context,mediaItems);</span><br><span class="line">                listview.setAdapter(videoPagerAdapter);</span><br><span class="line">                <span class="comment">//把文本隐藏</span></span><br><span class="line">                tv_nomedia.setVisibility(View.GONE);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//没有数据</span></span><br><span class="line">                <span class="comment">//文本显示</span></span><br><span class="line">                tv_nomedia.setVisibility(View.VISIBLE);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ProgressBar隐藏</span></span><br><span class="line">            pb_loading.setVisibility(View.GONE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化当前页面的控件，由父类调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        View view = View.inflate(context, R.layout.video_pager,<span class="keyword">null</span>);</span><br><span class="line">        listview = (ListView) view.findViewById(R.id.listview);</span><br><span class="line">        tv_nomedia = (TextView) view.findViewById(R.id.tv_nomedia);</span><br><span class="line">        pb_loading = (ProgressBar) view.findViewById(R.id.pb_loading);</span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.initData();</span><br><span class="line">        LogUtil.e(<span class="string">"本地视频的数据被初始化了。。。"</span>);</span><br><span class="line">        <span class="comment">//加载本地视频数据</span></span><br><span class="line">        getDataFromLocal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从本地的sdcard得到数据</span></span><br><span class="line"><span class="comment">     * //1.遍历sdcard,后缀名</span></span><br><span class="line"><span class="comment">     * //2.从内容提供者里面获取视频</span></span><br><span class="line"><span class="comment">     * //3.如果是6.0的系统，动态获取读取sdcard的权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getDataFromLocal</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                <span class="comment">//                SystemClock.sleep(2000);</span></span><br><span class="line">                mediaItems = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                ContentResolver resolver = context.getContentResolver();</span><br><span class="line">                Uri uri = MediaStore.Video.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">                String[] objs = &#123;</span><br><span class="line">                        MediaStore.Video.Media.DISPLAY_NAME,<span class="comment">//视频文件在sdcard的名称</span></span><br><span class="line">                        MediaStore.Video.Media.DURATION,<span class="comment">//视频总时长</span></span><br><span class="line">                        MediaStore.Video.Media.SIZE,<span class="comment">//视频的文件大小</span></span><br><span class="line">                        MediaStore.Video.Media.DATA,<span class="comment">//视频的绝对地址</span></span><br><span class="line">                        MediaStore.Video.Media.ARTIST,<span class="comment">//歌曲的演唱者</span></span><br><span class="line">                &#125;;</span><br><span class="line">                Cursor cursor = resolver.query(uri, objs, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span>(cursor != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">while</span> (cursor.moveToNext())&#123;</span><br><span class="line"></span><br><span class="line">                        MediaItem mediaItem = <span class="keyword">new</span> MediaItem();</span><br><span class="line"></span><br><span class="line">                        mediaItems.add(mediaItem);<span class="comment">//写在上面</span></span><br><span class="line"></span><br><span class="line">                        mediaItem.setName(cursor.getString(<span class="number">0</span>));<span class="comment">//视频的名称</span></span><br><span class="line">                        mediaItem.setDuration(cursor.getLong(<span class="number">1</span>));<span class="comment">//视频的时长</span></span><br><span class="line">                        mediaItem.setSize(cursor.getLong(<span class="number">2</span>));<span class="comment">//视频的文件大小</span></span><br><span class="line">                        mediaItem.setData(cursor.getString(<span class="number">3</span>));<span class="comment">//视频的播放地址</span></span><br><span class="line">                        mediaItem.setArtist(cursor.getString(<span class="number">4</span>));<span class="comment">//艺术家</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    cursor.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//Handler发消息</span></span><br><span class="line">                handler.sendEmptyMessage(<span class="number">10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中，MediaItem是媒体文件的bean，新建domain文件夹，并新建MediaItem类，添加set(), get()方法，toString()方法，toString()是为了后期debug时方便找到对象中具体的内容：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.domain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：aijunhao</span></span><br><span class="line"><span class="comment"> * 时间：2018.8.29</span></span><br><span class="line"><span class="comment"> * 作用：媒体类bean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MediaItem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> duration;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String artist;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDuration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> duration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDuration</span><span class="params">(<span class="keyword">long</span> duration)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.duration = duration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSize</span><span class="params">(<span class="keyword">long</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getArtist</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> artist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setArtist</span><span class="params">(String artist)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.artist = artist;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"MediaItem&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", duration="</span> + duration +</span><br><span class="line">                <span class="string">", size="</span> + size +</span><br><span class="line">                <span class="string">", data='"</span> + data + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", artist='"</span> + artist + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>将适配器单独封装，新建adapter文件夹，创建“VideoPagerAdapter.java”类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.text.format.Formatter;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.BaseAdapter;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.R;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.domain.MediaItem;</span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.utils.Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：aijunhao</span></span><br><span class="line"><span class="comment"> * 时间：2018.8.29</span></span><br><span class="line"><span class="comment"> * 作用：VideoPager的适配器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoPagerAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  Context context;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;MediaItem&gt; mediaItems;</span><br><span class="line">    <span class="keyword">private</span> Utils utils;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VideoPagerAdapter</span><span class="params">(Context context, ArrayList&lt;MediaItem&gt; mediaItems)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">        <span class="keyword">this</span>.mediaItems = mediaItems;</span><br><span class="line">        utils = <span class="keyword">new</span> Utils();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mediaItems.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">        ViewHoder viewHoder;</span><br><span class="line">        <span class="keyword">if</span>(convertView ==<span class="keyword">null</span>)&#123;</span><br><span class="line">            convertView = View.inflate(context, R.layout.item_video_pager,<span class="keyword">null</span>);</span><br><span class="line">            viewHoder = <span class="keyword">new</span> ViewHoder();</span><br><span class="line">            viewHoder.iv_icon = (ImageView) convertView.findViewById(R.id.iv_icon);</span><br><span class="line">            viewHoder.tv_name = (TextView) convertView.findViewById(R.id.tv_name);</span><br><span class="line">            viewHoder.tv_time = (TextView) convertView.findViewById(R.id.tv_time);</span><br><span class="line">            viewHoder.tv_size = (TextView) convertView.findViewById(R.id.tv_size);</span><br><span class="line"></span><br><span class="line">            convertView.setTag(viewHoder);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            viewHoder = (ViewHoder) convertView.getTag();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据position得到列表中对应位置的数据</span></span><br><span class="line">        MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">        viewHoder.tv_name.setText(mediaItem.getName());</span><br><span class="line">        viewHoder.tv_size.setText(Formatter.formatFileSize(context, mediaItem.getSize()));</span><br><span class="line">        viewHoder.tv_time.setText(utils.stringForTime((<span class="keyword">int</span>) mediaItem.getDuration()));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> convertView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHoder</span></span>&#123;</span><br><span class="line">        ImageView iv_icon;</span><br><span class="line">        TextView tv_name;</span><br><span class="line">        TextView tv_time;</span><br><span class="line">        TextView tv_size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>“Utils.java”时间格式转化工具类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Formatter;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Utils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> StringBuilder mFormatBuilder;</span><br><span class="line">	<span class="keyword">private</span> Formatter mFormatter;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Utils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 转换成字符串的时间</span></span><br><span class="line">		mFormatBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		mFormatter = <span class="keyword">new</span> Formatter(mFormatBuilder, Locale.getDefault());</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 把毫秒转换成：1:20:30这里形式</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> timeMs</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">stringForTime</span><span class="params">(<span class="keyword">int</span> timeMs)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> totalSeconds = timeMs / <span class="number">1000</span>;</span><br><span class="line">		<span class="keyword">int</span> seconds = totalSeconds % <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> minutes = (totalSeconds / <span class="number">60</span>) % <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> hours = totalSeconds / <span class="number">3600</span>;</span><br><span class="line"></span><br><span class="line">		mFormatBuilder.setLength(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (hours &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> mFormatter.format(<span class="string">"%d:%02d:%02d"</span>, hours, minutes, seconds)</span><br><span class="line">					.toString();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> mFormatter.format(<span class="string">"%02d:%02d"</span>, minutes, seconds).toString();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在AndroidManifest.xml文件中添加sd卡权限：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>此时，如果手机系统android6.0或者api23以下，则直接运行不会出现问题，反之，需要动态添加sd卡权限，或者在手机系统中打开sd卡权限（比较笨的方法）。</p>
<p>如果程序正确执行，将可以看到本地视频页面将显示所有的视频文件。</p>
<h4 id="3-设置item的点击事件，把视频播放出来"><a href="#3-设置item的点击事件，把视频播放出来" class="headerlink" title="3. 设置item的点击事件，把视频播放出来"></a>3. 设置item的点击事件，把视频播放出来</h4><p>在“VideoPager.java”中为listView的Item添加点击事件，开始播放，播放有两种方法，一种是调用手机中的播放器来打开文件，另一种就是自己写一个播放器来打开文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOnItemClickListener</span> <span class="keyword">implements</span> <span class="title">AdapterView</span>.<span class="title">OnItemClickListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">            MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">            Toast.makeText(context, <span class="string">"mediaItem == "</span> + mediaItem.toString(), Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1. 调用系统所有的播放器 - 隐私意图</span></span><br><span class="line"><span class="comment">//            Intent intent = new Intent();</span></span><br><span class="line"><span class="comment">//            intent.setDataAndType(Uri.parse(mediaItem.getData()), "video/*");</span></span><br><span class="line"><span class="comment">//            context.startActivity(intent);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 调用自己写的播放器 - 显示意图，指定调用软件</span></span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(context, SystemVideoPlayer.class);</span><br><span class="line">            intent.setDataAndType(Uri.parse(mediaItem.getData()), <span class="string">"video/*"</span>);</span><br><span class="line">            context.startActivity(intent);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>自己写播放器，则新建一个播放activity，调用系统的播放组件来完成。</p>
<p>“SystemVideoPlayer.java”：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.media.MediaPlayer;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.widget.MediaController;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> android.widget.VideoView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.me.mobileplayer.R;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：AiJunhao</span></span><br><span class="line"><span class="comment"> * 日期：2018/9/4 12:19</span></span><br><span class="line"><span class="comment"> * 描述：自定义的系统播放器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemVideoPlayer</span> <span class="keyword">extends</span> <span class="title">Activity</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> VideoView videoview;</span><br><span class="line">    <span class="keyword">private</span> Uri uri;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_system_video_player);</span><br><span class="line">        videoview = (VideoView) findViewById(R.id.videoview);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 得到播放地址</span></span><br><span class="line">        uri = getIntent().getData();</span><br><span class="line">        <span class="keyword">if</span>(uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">            videoview.setVideoURI(uri);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 准备好时的监听</span></span><br><span class="line">        videoview.setOnPreparedListener(<span class="keyword">new</span> MyOnPreparedListener());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 播放出错时的监听</span></span><br><span class="line">        videoview.setOnErrorListener(<span class="keyword">new</span> MyOnErrorListener());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 播放完成时的监听</span></span><br><span class="line">        videoview.setOnCompletionListener(<span class="keyword">new</span> MysetOnCompletionListener());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置控制面板</span></span><br><span class="line">        videoview.setMediaController(<span class="keyword">new</span> MediaController(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyOnPreparedListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnPreparedListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当底层解码准备好的时候</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line">            videoview.start();  <span class="comment">// 开始播放</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyOnErrorListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnErrorListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onError</span><span class="params">(MediaPlayer mp, <span class="keyword">int</span> what, <span class="keyword">int</span> extra)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(SystemVideoPlayer.<span class="keyword">this</span>, <span class="string">"播放出错了哦"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MysetOnCompletionListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnCompletionListener</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(SystemVideoPlayer.<span class="keyword">this</span>, <span class="string">"播放完成了 = "</span> + uri, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>“activity_system_video_player.xml”布局文件，添加VideoView视频播放组件，并设置背景黑色，内容居中：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"#000000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">VideoView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/videoview"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>测试界面如下：<br><img src="/2018/08/26/Android开发之手机影音/SystemVideoPlayer.jpg" alt=""></p>
<hr>
<h3 id="Activity的生命周期"><a href="#Activity的生命周期" class="headerlink" title="Activity的生命周期"></a>Activity的生命周期</h3><ul>
<li><p>生命周期</p>
<ol>
<li><p>创建Activity的时候执行的方法<br>onCreate() –&gt; onStart() –&gt; onResume()</p>
</li>
<li><p>销毁Activity的时候执行的方法<br>onPause() –&gt; onStop() –&gt; onDestroy()</p>
</li>
</ol>
</li>
<li><p>A页面跳转到B页面，点击返回，这个过程的生命周期</p>
<ol>
<li><p>B页面完全覆盖A页面的情况，两个activity替换<br> a. A跳转B页面的生命周期方法执行顺序：<br> onPause(A) –&gt; onCreate(B) –&gt; onStart(B) –&gt; onResume(B) –&gt; onStop(A)</p>
<p> b. B页面点击后返回的生命周期方法执行顺序：<br> onPause(B) –&gt; onRestart(A) –&gt; onStart(A) –&gt; onResume(A) –&gt; onStop(B) –&gt; onDestroy(B)</p>
</li>
<li><p>B页面不完全覆盖A页面的情况，对话框形式弹出activity<br> a. A跳转B页面的生命周期方法执行顺序：<br> onPause(A) –&gt; onCreate(B) –&gt; onStart(B) –&gt; onResume(B)</p>
<p> b. B页面点击后返回的生命周期方法执行顺序：<br> onPause(B) –&gt; onResume(A) –&gt; onStop(B) –&gt; onDestroy(B)</p>
</li>
</ol>
</li>
</ul>
<hr>
<h3 id="Activity横竖屏切换的生命周期"><a href="#Activity横竖屏切换的生命周期" class="headerlink" title="Activity横竖屏切换的生命周期"></a>Activity横竖屏切换的生命周期</h3><p>默认情况：onPause() –&gt; onStop() –&gt; onDestroy() –&gt; onCreate() –&gt; onStart<br>这种情况时屏幕横竖屏切换导致生命周期重新执行，即重新加载视频，从头播放。</p>
<p>在“AndroidManifest.xml”中给对应的activity配置configChanges参数，屏蔽横竖屏横竖屏导致的生命周期重新执行:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".activity.SystemVideoPlayer"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:configChanges</span>=<span class="string">"keyboardHidden|screenSize|orientation"</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>同样，其实，之前的代码遗留了一个隐藏的bug，当主页面横竖屏切换和视频页面返回到主页面时，程序会崩溃，也是因为主页面activity的生命周期重新执行，因此，我们再功能注册文件“AndroidManifest.xml”中给MainActivity也配置同样的configChanges参数，解决这个隐藏的bug。</p>
<hr>
<h3 id="播放器控制面板"><a href="#播放器控制面板" class="headerlink" title="播放器控制面板"></a>播放器控制面板</h3><p>“media_controller.xml”布局界面，在视频界面中导入使用：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 顶部 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/ll_top"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@drawable/bg_player_status"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/tv_name"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"视频名称"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">"#ffffff"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/iv_battery"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">"@drawable/ic_battery_10"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/tv_system_time"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"12:00"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">"#ffffff"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@drawable/bg_player_top_control"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/btn_voice"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/btn_voice_selector"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">SeekBar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/seekbar_voice"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:minHeight</span>=<span class="string">"6dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:maxHeight</span>=<span class="string">"6dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:progress</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:progressDrawable</span>=<span class="string">"@drawable/progress_horizontal"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:thumb</span>=<span class="string">"@drawable/progress_thumb"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/btn_switch_player"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/btn_switch_player_selector"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/ll_bottom"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@drawable/bg_player_top_control"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/tv_current_time"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"00:00:00"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">"#ffffff"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">SeekBar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/seekbar_video"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:minHeight</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:maxHeight</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:progress</span>=<span class="string">"30"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:progressDrawable</span>=<span class="string">"@drawable/progress_horizontal"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:thumb</span>=<span class="string">"@drawable/progress_thumb"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/tv_duration"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginRight</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"20:00"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">"#ffffff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@drawable/bg_player_bottom_control"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/btn_exit"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/btn_exit_selector"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/btn_video_pre"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/btn_video_pre_selector"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/btn_video_start_pause"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/btn_video_pause_selector"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/btn_next"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/btn_next_selector"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/btn_video_switch_screen"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"@drawable/btn_video_switch_screen_full_selector"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其中“progress_horizontal.xml”为自定义seekbar的样式文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">layer-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/background"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/progress_background"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/secondaryProgress"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/progress_secondaryprogress"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@android:id/progress"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/progress_normal"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>搭建完布局界面后，就是要实例化对应的按钮，但是由于按钮过多，写起来非常多非常麻烦……</p>
<p>有一个网站可以根据xml布局文件自动生成对应的java实例化文件：<a href="https://www.buzzingandroid.com/tools/android-layout-finder/" target="_blank" rel="noopener">https://www.buzzingandroid.com/tools/android-layout-finder/</a></p>
<p>此时只要将xml文件全选复制到“1. Enter Android XML Layout:”框中，在“3. Get yout Java code:”中将生成对应的实例化代码：</p>
<p><img src="/2018/08/26/Android开发之手机影音/android_layout_finder.png" alt=""></p>
<p>然后将生成的java代码复制到对应的java文件中，然后调用对应的方法并添加监听接口即可。</p>
<hr>
<h3 id="视频SeekBar进度更新"><a href="#视频SeekBar进度更新" class="headerlink" title="视频SeekBar进度更新"></a>视频SeekBar进度更新</h3><h4 id="1-视频的总时长和SeekBaar的setMax设置总时长"><a href="#1-视频的总时长和SeekBaar的setMax设置总时长" class="headerlink" title="1. 视频的总时长和SeekBaar的setMax设置总时长)"></a>1. 视频的总时长和SeekBaar的setMax设置总时长)</h4><p>在“SystemVideoPlayer.java”文件中，在视频准备好的监听中设置视频总时长、seekbar最大长度、总时长文本和发送handler消息：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频进度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span> <span class="keyword">int</span> PROGRESS = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOnPreparedListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnPreparedListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当底层解码准备好的时候</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line">        videoview.start();  <span class="comment">// 开始播放</span></span><br><span class="line">        <span class="comment">// 1. 视频的总长度，关联总长度</span></span><br><span class="line">        <span class="keyword">int</span> duration = videoview.getDuration();   <span class="comment">// 获得视频总时长</span></span><br><span class="line">        seekbarVideo.setMax(duration);</span><br><span class="line">        tvDuration.setText(utils.stringForTime(duration));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 发信息</span></span><br><span class="line">        handler.sendEmptyMessage(PROGRESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="2-实例化Handler，每秒得到当前播放进度，SeekBar的getProgress更新当前进度"><a href="#2-实例化Handler，每秒得到当前播放进度，SeekBar的getProgress更新当前进度" class="headerlink" title="2. 实例化Handler，每秒得到当前播放进度，SeekBar的getProgress更新当前进度"></a>2. 实例化Handler，每秒得到当前播放进度，SeekBar的getProgress更新当前进度</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">        <span class="keyword">switch</span> (msg.what)&#123;</span><br><span class="line">            <span class="keyword">case</span> PROGRESS:</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 得到当前的播放视频进度</span></span><br><span class="line">                <span class="keyword">int</span> currentPosition = videoview.getCurrentPosition();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 设置进度</span></span><br><span class="line">                seekbarVideo.setProgress(currentPosition);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 每秒更新一次</span></span><br><span class="line">                handler.removeMessages(PROGRESS);</span><br><span class="line">                handler.sendEmptyMessageDelayed(PROGRESS, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 更新文本进度</span></span><br><span class="line">                tvCurrentTime.setText(utils.stringForTime(currentPosition));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="视频SeekBar拖动"><a href="#视频SeekBar拖动" class="headerlink" title="视频SeekBar拖动"></a>视频SeekBar拖动</h3><p>在上节的基础上添加一个SeekBar状态变化的监听。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SeekBar状态改变的监听</span></span><br><span class="line">    seekbarVideo.setOnSeekBarChangeListener(<span class="keyword">new</span> VideoOnSeekBarChangeListener());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VideoOnSeekBarChangeListener</span> <span class="keyword">implements</span> <span class="title">SeekBar</span>.<span class="title">OnSeekBarChangeListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当手指欢动的时候，会引起SeekBar进度变化，回调的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> seekBar</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> progress</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fromUser   用户引起的为true， 反之为false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar seekBar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(fromUser)&#123;</span><br><span class="line">            videoview.seekTo(progress);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当按手指触碰的时候回调的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> seekBar</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当按手指离开的时候回调的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> seekBar</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="设置电池状态"><a href="#设置电池状态" class="headerlink" title="设置电池状态"></a>设置电池状态</h3><p>注册广播有两种方式：静态注册和动态注册</p>
<ol>
<li>静态注册：在功能清单文件注册，只要软件安装在手机上，就算软件不启动，也能收到对应的广播。</li>
<li>动态注册：只有注册的代码被执行后，才能收到对应的广播。</li>
</ol>
<p>电量设置，只需要在软件开启时执行即可，因此，我们使用动态注册，在代码中注册广播的方式。</p>
<p>在SystemVideoPlayer.java文件中:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听电量的广播</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> MyReceiver receiver;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册电量广播</span></span><br><span class="line">    receiver = <span class="keyword">new</span> MyReceiver();</span><br><span class="line">    IntentFilter intentFilter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">    <span class="comment">// 当电量变化时的广播</span></span><br><span class="line">    intentFilter.addAction(Intent.ACTION_BATTERY_CHANGED);</span><br><span class="line">    registerReceiver(receiver, intentFilter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> level = intent.getIntExtra(<span class="string">"level"</span>, <span class="number">0</span>); <span class="comment">// 0 - 100</span></span><br><span class="line">        setBattery(level);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置电量图片</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> level</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBattery</span><span class="params">(<span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(level &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_0);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(level &lt;= <span class="number">10</span>)&#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_10);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(level &lt;= <span class="number">20</span>)&#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_20);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(level &lt;= <span class="number">40</span>)&#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_40);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(level &lt;= <span class="number">60</span>)&#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_60);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(level &lt;= <span class="number">80</span>)&#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_80);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(level &lt;= <span class="number">100</span>)&#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_100);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ivBattery.setImageResource(R.drawable.ic_battery_100);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="设置系统时间"><a href="#设置系统时间" class="headerlink" title="设置系统时间"></a>设置系统时间</h3><p>系统时间从系统获取，在Handler中实时刷新：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">        <span class="keyword">switch</span> (msg.what)&#123;</span><br><span class="line">            <span class="keyword">case</span> PROGRESS:</span><br><span class="line"></span><br><span class="line">                ……</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 设置系统时间</span></span><br><span class="line">                tvSystemTime.setText(getSystemTime());</span><br><span class="line"></span><br><span class="line">                ……</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到系统时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getSystemTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"HH:mm:ss"</span>);</span><br><span class="line">    <span class="keyword">return</span> format.format(<span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="传递播放列表"><a href="#传递播放列表" class="headerlink" title="传递播放列表"></a>传递播放列表</h3><p>列表传递数据到Activity中，列表数据如果String、int，则直接传；如果是对象，需要序列化。</p>
<p>这里将MediaIem继承Serializable的方法来实现序列化。然后“VideoPager.java”和“SystemVideoPlayer.java”两个activity之间使用bundle数据包方式传递数据列表。</p>
<p>修改“VideoPager.java”ListView的Item点击监听，将数据列表放入bundle包中，然后intent传递到另一个activity：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyOnItemClickListener</span> <span class="keyword">implements</span> <span class="title">AdapterView</span>.<span class="title">OnItemClickListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">            MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line"><span class="comment">//            Toast.makeText(context, "mediaItem == " + mediaItem.toString(), Toast.LENGTH_SHORT).show();</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1. 调用系统所有的播放器 - 隐私意图</span></span><br><span class="line"><span class="comment">//            Intent intent = new Intent();</span></span><br><span class="line"><span class="comment">//            intent.setDataAndType(Uri.parse(mediaItem.getData()), "video/*");</span></span><br><span class="line"><span class="comment">//            context.startActivity(intent);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 调用自己写的播放器 -- 显示意图，指定调用软件 -- 只有一个播放地址</span></span><br><span class="line"><span class="comment">//            Intent intent = new Intent(context, SystemVideoPlayer.class);</span></span><br><span class="line"><span class="comment">//            intent.setDataAndType(Uri.parse(mediaItem.getData()), "video/*");</span></span><br><span class="line"><span class="comment">//            context.startActivity(intent);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 传递列表数据，需要序列化</span></span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(context, SystemVideoPlayer.class);</span><br><span class="line">            Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">            bundle.putSerializable(<span class="string">"videolist"</span>, mediaItems);</span><br><span class="line">            intent.putExtras(bundle);</span><br><span class="line">            intent.putExtra(<span class="string">"position"</span>, position);</span><br><span class="line">            context.startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>在“SystemVideoPlayer.java”文件中重新设置接收另一个activity的方法并设置播放地址：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 传入进来的视频列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> ArrayList&lt;MediaItem&gt; mediaItems;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要播放的列表的具体位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> position;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置播放地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">        tvName.setText(mediaItem.getName());</span><br><span class="line">        videoview.setVideoPath(mediaItem.getData());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        tvName.setText(uri.toString());</span><br><span class="line">        videoview.setVideoURI(uri);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"无数据"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到播放地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    uri = getIntent().getData();</span><br><span class="line">    mediaItems = (ArrayList&lt;MediaItem&gt;) getIntent().getSerializableExtra(<span class="string">"videolist"</span>);</span><br><span class="line">    position = getIntent().getIntExtra(<span class="string">"position"</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="此时如果能正常运行，则表示修改成功。"><a href="#此时如果能正常运行，则表示修改成功。" class="headerlink" title="此时如果能正常运行，则表示修改成功。"></a>此时如果能正常运行，则表示修改成功。</h2><h3 id="播放上一个-下一个视频及自动跳转"><a href="#播放上一个-下一个视频及自动跳转" class="headerlink" title="播放上一个/下一个视频及自动跳转"></a>播放上一个/下一个视频及自动跳转</h3><p>要完成该操作，必须先完成上一步，否则，视频界面得到的播放信息只有一个，而不是列表。</p>
<p>在SystemVideoPlayer.java中为上一个下一个视频按钮添加onClick点击事件：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( v == btnVoice ) &#123;</span><br><span class="line">        <span class="comment">// Handle clicks for btnVoice</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( v == btnSwitchPlayer ) &#123;</span><br><span class="line">        <span class="comment">// Handle clicks for btnSwitchPlayer</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( v == btnExit ) &#123;</span><br><span class="line">        <span class="comment">// Handle clicks for btnExit</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( v == btnVideoPre ) &#123;</span><br><span class="line">        <span class="comment">// Handle clicks for btnVideoPre</span></span><br><span class="line">        playPreVideo();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( v == btnVideoStartPause ) &#123;</span><br><span class="line">        <span class="comment">// Handle clicks for btnVideoStartPause</span></span><br><span class="line">        <span class="keyword">if</span>(videoview.isPlaying())&#123;</span><br><span class="line">            <span class="comment">// 设置播放 -&gt; 暂停</span></span><br><span class="line">            videoview.pause();</span><br><span class="line">            <span class="comment">// 按钮状态设置为播放</span></span><br><span class="line">            btnVideoStartPause.setBackgroundResource(R.drawable.btn_video_start_selector);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 设置暂停 -&gt; 播放</span></span><br><span class="line">            videoview.start();</span><br><span class="line">            <span class="comment">// 按钮状态设置为暂停</span></span><br><span class="line">            btnVideoStartPause.setBackgroundResource(R.drawable.btn_video_pause_selector);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( v == btnVideoNext ) &#123;</span><br><span class="line">        <span class="comment">// Handle clicks for btnNext</span></span><br><span class="line">        playNextVideo();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( v == btnVideoSwitchScreen ) &#123;</span><br><span class="line">        <span class="comment">// Handle clicks for btnVideoSwitchScreen</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 播放上一个视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">playPreVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        position--;</span><br><span class="line">        <span class="keyword">if</span>(position &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">            tvName.setText(mediaItem.getName());</span><br><span class="line">            videoview.setVideoPath(mediaItem.getData());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置按钮状态</span></span><br><span class="line">            setButtonState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 上一个和下一个按钮设置灰色并不可点击</span></span><br><span class="line">        setButtonState();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 播放下一个视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">playNextVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// 播放下一个</span></span><br><span class="line">        position++;</span><br><span class="line">        <span class="keyword">if</span>(position &lt; mediaItems.size())&#123;</span><br><span class="line">            MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">            tvName.setText(mediaItem.getName());</span><br><span class="line">            videoview.setVideoPath(mediaItem.getData());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置按钮状态</span></span><br><span class="line">            setButtonState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 上一个和下一个按钮设置灰色并不可点击</span></span><br><span class="line">        setButtonState();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 按钮播放状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setButtonState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (mediaItems.size() == <span class="number">1</span>)&#123;</span><br><span class="line">            setEnable(<span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setEnable(<span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">if</span> (position == <span class="number">0</span>)&#123;</span><br><span class="line">                 <span class="comment">// 第一个视频时，设置上一个视频按钮灰色不可点击</span></span><br><span class="line">                setEnable(<span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (position == mediaItems.size() - <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">// 最后一个视频时，设置下一个视频按钮灰色不可点击</span></span><br><span class="line">                setEnable(<span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        setEnable(<span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置左右按钮是否可用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> isLeftEnable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> isRightEnable</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setEnable</span><span class="params">(<span class="keyword">boolean</span> isLeftEnable, <span class="keyword">boolean</span> isRightEnable)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 左</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (isLeftEnable)&#123;</span><br><span class="line">        btnVideoPre.setBackgroundResource(R.drawable.btn_video_pre_selector);</span><br><span class="line">        btnVideoPre.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        btnVideoPre.setBackgroundResource(R.drawable.btn_pre_gray);</span><br><span class="line">        btnVideoPre.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 右</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (isRightEnable)&#123;</span><br><span class="line">        btnVideoNext.setBackgroundResource(R.drawable.btn_video_next_selector);</span><br><span class="line">        btnVideoNext.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        btnVideoNext.setBackgroundResource(R.drawable.btn_next_gray);</span><br><span class="line">        btnVideoNext.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下一个视频的自动跳转功能在视频的播放完成里面调用播放下一个视频的方法即可：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 播放完成时的监听</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MysetOnCompletionListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnCompletionListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line">        playNextVideo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="手势识别"><a href="#手势识别" class="headerlink" title="手势识别"></a>手势识别</h3><ol>
<li><p>定义手势识别器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义手势识别器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> GestureDetector detector;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例化识别器，重写双击、单击、长按方法</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ……</span><br><span class="line"></span><br><span class="line">        detector = <span class="keyword">new</span> GestureDetector(<span class="keyword">this</span>, <span class="keyword">new</span> GestureDetector.SimpleOnGestureListener()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLongPress</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.onLongPress(e);</span><br><span class="line">                startAndPause();</span><br><span class="line"><span class="comment">//                Toast.makeText(SystemVideoPlayer.this, "长按事件", Toast.LENGTH_SHORT).show();</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDoubleTap</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">                Toast.makeText(SystemVideoPlayer.<span class="keyword">this</span>, <span class="string">"双击事件"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onDoubleTap(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSingleTapConfirmed</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">                Toast.makeText(SystemVideoPlayer.<span class="keyword">this</span>, <span class="string">"单击事件"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.onSingleTapConfirmed(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 播放与暂停</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startAndPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(videoview.isPlaying())&#123;</span><br><span class="line">            <span class="comment">// 设置播放 -&gt; 暂停</span></span><br><span class="line">            videoview.pause();</span><br><span class="line">            <span class="comment">// 按钮状态设置为播放</span></span><br><span class="line">            btnVideoStartPause.setBackgroundResource(R.drawable.btn_video_start_selector);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 设置暂停 -&gt; 播放</span></span><br><span class="line">            videoview.start();</span><br><span class="line">            <span class="comment">// 按钮状态设置为暂停</span></span><br><span class="line">            btnVideoStartPause.setBackgroundResource(R.drawable.btn_video_pause_selector);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>main 中的onTouchEvent()中把事件传递个给手势识别器</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 把事件传递给手势识别器</span></span><br><span class="line">    detector.onTouchEvent(event);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="控制面板自动延迟隐藏"><a href="#控制面板自动延迟隐藏" class="headerlink" title="控制面板自动延迟隐藏"></a>控制面板自动延迟隐藏</h3><p>通过Handler对象的消息发送和移除消息。</p>
<p>给“activity_system_video_player.xml”中include的布局添加一个id，id名为“media_controller”。</p>
<p>实现五秒中控制面板自动延迟隐藏时，要重置控制面板在使用时的时间，不然会出现控制面板在使用时突然隐藏的bug。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 控制面板显示状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isShowMediaController = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    handler.removeMessages(HIDE_MEDIACONTROLLER);</span><br><span class="line">    handler.sendEmptyMessageDelayed(HIDE_MEDIACONTROLLER, <span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    detector = <span class="keyword">new</span> GestureDetector(<span class="keyword">this</span>, <span class="keyword">new</span> GestureDetector.SimpleOnGestureListener()&#123;</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSingleTapConfirmed</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (isShowMediaController)&#123;</span><br><span class="line">                <span class="comment">// 隐藏</span></span><br><span class="line">                hideMediaController();</span><br><span class="line">                <span class="comment">// 把隐藏消息移除</span></span><br><span class="line">                handler.removeMessages(HIDE_MEDIACONTROLLER);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 显示</span></span><br><span class="line">                showMediaController();</span><br><span class="line">                <span class="comment">// 发消息隐藏</span></span><br><span class="line">                handler.sendEmptyMessageDelayed(HIDE_MEDIACONTROLLER, <span class="number">5000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.onSingleTapConfirmed(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频进度条监听，重置延迟</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VideoOnSeekBarChangeListener</span> <span class="keyword">implements</span> <span class="title">SeekBar</span>.<span class="title">OnSeekBarChangeListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当按手指触碰的时候回调的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> seekBar</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        handler.removeMessages(HIDE_MEDIACONTROLLER);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当按手指离开的时候回调的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> seekBar</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        handler.sendEmptyMessageDelayed(HIDE_MEDIACONTROLLER, <span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频准备好时的监听</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOnPreparedListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnPreparedListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当底层解码准备好的时候</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line">        ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认隐藏控制面板</span></span><br><span class="line">        hideMediaController();</span><br><span class="line"></span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示控制面板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showMediaController</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mediaController.setVisibility(View.VISIBLE);</span><br><span class="line">    isShowMediaController = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 隐藏控制面板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hideMediaController</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mediaController.setVisibility(View.GONE);</span><br><span class="line">    isShowMediaController = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="自定义VideoView实现视频画面大小"><a href="#自定义VideoView实现视频画面大小" class="headerlink" title="自定义VideoView实现视频画面大小"></a>自定义VideoView实现视频画面大小</h3><p>新建一个名为VideoView的类，与系统自带的VideoView重名，但是因为文件路径不同，并不会产生冲突。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mobileplayer.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作者：AiJunhao</span></span><br><span class="line"><span class="comment"> * 日期：2018/9/8 16:03</span></span><br><span class="line"><span class="comment"> * 描述：自定义VideoView</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoView</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">widget</span>.<span class="title">VideoView</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在代码中实例化该类的时候使用这个方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VideoView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当在布局文件使用该类的时候，Android系统通过这个构造方法实例化该类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VideoView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当需要设置样式的时候，可以使用该方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defStyleAttr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VideoView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> widthMeasureSpec</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> heightMeasureSpec</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        setMeasuredDimension(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置视频的宽和高</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoWidth</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoHeight</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVideoSize</span><span class="params">(<span class="keyword">int</span> videoWidth, <span class="keyword">int</span> videoHeight)</span></span>&#123;</span><br><span class="line">        ViewGroup.LayoutParams params = getLayoutParams();</span><br><span class="line">        params.width = videoWidth;</span><br><span class="line">        params.height = videoHeight;</span><br><span class="line">        setLayoutParams(params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改SystemVideoPlayer.java文件和activity_system_video_player.xml文件中VideoView的路径为我们自定义的VideoView路径。</p>
<p>SystemVideoPlayer.java文件中添加全屏和按比例缩放功能，并添加按钮点击事件：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置全屏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FULL_SCREEN = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SCREEN = <span class="number">2</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是全屏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isFullScrenn = <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置全屏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FULL_SCREEN = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_SCREEN = <span class="number">2</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 屏幕的宽和高</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> screenHeight = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> screenWidth = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频实际的宽和高</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> videoWidth;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> videoHight;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line">    detector = <span class="keyword">new</span> GestureDetector(<span class="keyword">this</span>, <span class="keyword">new</span> GestureDetector.SimpleOnGestureListener()&#123;</span><br><span class="line"></span><br><span class="line">        ……</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDoubleTap</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">            setFullScreenAndDefault();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.onDoubleTap(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ……</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 得到屏幕宽和高</span></span><br><span class="line">    DisplayMetrics displayMetrics = <span class="keyword">new</span> DisplayMetrics();</span><br><span class="line">    getWindowManager().getDefaultDisplay().getMetrics(displayMetrics);</span><br><span class="line">    screenHeight = displayMetrics.heightPixels;</span><br><span class="line">    screenWidth = displayMetrics.widthPixels;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置全屏和默认</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setFullScreenAndDefault</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isFullScrenn)&#123;</span><br><span class="line">        <span class="comment">// 默认</span></span><br><span class="line">        setVideoType(DEFAULT_SCREEN);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 全屏</span></span><br><span class="line">        setVideoType(FULL_SCREEN);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置视频类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> defaultFullScreen</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setVideoType</span><span class="params">(<span class="keyword">int</span> defaultFullScreen)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (defaultFullScreen)&#123;</span><br><span class="line">        <span class="keyword">case</span> FULL_SCREEN:   <span class="comment">// 全屏</span></span><br><span class="line">            <span class="comment">// 1. 设置视频画面的大小</span></span><br><span class="line">            videoview.setVideoSize(screenWidth, screenHeight);</span><br><span class="line">            <span class="comment">// 2. 设置按钮的状态</span></span><br><span class="line">            btnVideoSwitchScreen.setBackgroundResource(R.drawable.btn_video_switch_screen_default_selector);</span><br><span class="line">            isFullScrenn = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> DEFAULT_SCREEN:</span><br><span class="line">            <span class="comment">// 1. 设置视频画面的大小</span></span><br><span class="line">            <span class="comment">// 视频真实的宽和高</span></span><br><span class="line">            <span class="keyword">int</span> mVideoWidth = videoWidth;</span><br><span class="line">            <span class="keyword">int</span> mVideoHeight = videoHight;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 屏幕的宽和高</span></span><br><span class="line">            <span class="keyword">int</span> width = screenWidth;</span><br><span class="line">            <span class="keyword">int</span> height = screenHeight;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( mVideoWidth * height  &lt; width * mVideoHeight ) &#123;</span><br><span class="line">                width = height * mVideoWidth / mVideoHeight;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( mVideoWidth * height  &gt; width * mVideoHeight ) &#123;</span><br><span class="line">                height = width * mVideoHeight / mVideoWidth;</span><br><span class="line">            &#125;</span><br><span class="line">            videoview.setVideoSize(width, height);</span><br><span class="line">            <span class="comment">// 2. 设置按钮的状态</span></span><br><span class="line">            btnVideoSwitchScreen.setBackgroundResource(R.drawable.btn_video_switch_screen_full_selector);</span><br><span class="line">            isFullScrenn = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频准备好时的监听</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOnPreparedListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnPreparedListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当底层解码准备好的时候</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得视频的宽和高</span></span><br><span class="line">        videoWidth = mp.getVideoWidth();</span><br><span class="line">        videoHight = mp.getVideoHeight();</span><br><span class="line"></span><br><span class="line">        ……</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="声音设置"><a href="#声音设置" class="headerlink" title="声音设置"></a>声音设置</h3><h4 id="1-实例化AudioManager"><a href="#1-实例化AudioManager" class="headerlink" title="1. 实例化AudioManager"></a>1. 实例化AudioManager</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 调节声音</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> AudioManager am;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当前音量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> currentVoice;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最大音量</span></span><br><span class="line"><span class="comment"> * 0 - 15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxVoice;</span><br></pre></td></tr></table></figure>
<h4 id="2-设置当前音量和最大音量"><a href="#2-设置当前音量和最大音量" class="headerlink" title="2. 设置当前音量和最大音量"></a>2. 设置当前音量和最大音量</h4><p>注意，此处在使用seekbarVoice关联并设置当前音量时需要先实例化，就是注意onCreate方法中initData()和findView()的先后顺序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 得到音量</span></span><br><span class="line">    am = (AudioManager) getSystemService(AUDIO_SERVICE);</span><br><span class="line">    currentVoice = am.getStreamVolume(AudioManager.STREAM_MUSIC);</span><br><span class="line">    maxVoice = am.getStreamMaxVolume(AudioManager.STREAM_MUSIC);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最大音量和seekBar关联</span></span><br><span class="line">    seekbarVoice.setMax(maxVoice);</span><br><span class="line">    <span class="comment">// 设置当前音量</span></span><br><span class="line">    seekbarVoice.setProgress(currentVoice);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-设置SeekBar状态变化"><a href="#3-设置SeekBar状态变化" class="headerlink" title="3. 设置SeekBar状态变化"></a>3. 设置SeekBar状态变化</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加监听事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SeekBar状态改变的监听</span></span><br><span class="line">    seekbarVideo.setOnSeekBarChangeListener(<span class="keyword">new</span> VideoOnSeekBarChangeListener());</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    seekbarVoice.setOnSeekBarChangeListener(<span class="keyword">new</span> VoiceOnSeekBarChangeListener());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 声音进度条监听</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">VoiceOnSeekBarChangeListener</span> <span class="keyword">implements</span> <span class="title">SeekBar</span>.<span class="title">OnSeekBarChangeListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar seekBar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fromUser)&#123;</span><br><span class="line">            <span class="keyword">if</span> (progress &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                isMute = <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                isMute = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            updataVoice(progress, isMute);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        handler.sendEmptyMessageDelayed(HIDE_MEDIACONTROLLER, <span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置音量大小，是否静音</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> progress</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updataVoice</span><span class="params">(<span class="keyword">int</span> progress, <span class="keyword">boolean</span> isMute)</span> </span>&#123;</span><br><span class="line">    currentVoice = progress;</span><br><span class="line">    <span class="keyword">if</span> (isMute)&#123;</span><br><span class="line">        progress = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 第三个参数为1，就把系统调用出来，为0则不调用。</span></span><br><span class="line">    am.setStreamVolume(AudioManager.STREAM_MUSIC, progress, <span class="number">0</span>);</span><br><span class="line">    seekbarVoice.setProgress(progress);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-静音设置及按钮监听"><a href="#4-静音设置及按钮监听" class="headerlink" title="4. 静音设置及按钮监听"></a>4. 静音设置及按钮监听</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( v == btnVoice ) &#123;</span><br><span class="line">        isMute = !isMute;</span><br><span class="line">        <span class="comment">// Handle clicks for btnVoice</span></span><br><span class="line">        updataVoice(currentVoice, isMute);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     ……</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="屏幕上下滑动实现声音大小变化"><a href="#屏幕上下滑动实现声音大小变化" class="headerlink" title="屏幕上下滑动实现声音大小变化"></a>屏幕上下滑动实现声音大小变化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> startY;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 屏幕的高</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span>  <span class="keyword">float</span> touchRang;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当一按下的音量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> mVol;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 触摸管理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 把事件传递给手势识别器</span></span><br><span class="line">    detector.onTouchEvent(event);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声音滑动变化</span></span><br><span class="line">    <span class="keyword">switch</span> (event.getAction())&#123;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:       <span class="comment">// 手指按下</span></span><br><span class="line">            <span class="comment">// 1. 记录值</span></span><br><span class="line">            startY = event.getY();</span><br><span class="line">            mVol = am.getStreamVolume(AudioManager.STREAM_MUSIC);</span><br><span class="line">            touchRang = Math.min(screenHeight, screenWidth);</span><br><span class="line">            handler.removeMessages(HIDE_MEDIACONTROLLER);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:       <span class="comment">// 手指移动</span></span><br><span class="line">            <span class="comment">// 2. 移动的记录相关值</span></span><br><span class="line">            <span class="keyword">float</span> endY = event.getY();</span><br><span class="line">            <span class="keyword">float</span> distanceY = startY - endY;</span><br><span class="line">            <span class="comment">// 改变的音量</span></span><br><span class="line">            <span class="keyword">float</span> delat = (distanceY/touchRang)*maxVoice;</span><br><span class="line">            <span class="comment">// 最终声音</span></span><br><span class="line">            <span class="keyword">int</span> voice = (<span class="keyword">int</span>) Math.min(maxVoice, Math.max(mVol + delat, <span class="number">0</span>));</span><br><span class="line">            <span class="keyword">if</span> (delat != <span class="number">0</span>)&#123;</span><br><span class="line">                isMute = <span class="keyword">false</span>;</span><br><span class="line">                updataVoice(voice, isMute);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP:         <span class="comment">// 手指离开</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="通过手机音量按键改变声音大小"><a href="#通过手机音量按键改变声音大小" class="headerlink" title="通过手机音量按键改变声音大小"></a>通过手机音量按键改变声音大小</h3><p>只要添加物理按键监听即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 物理按键监听</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keyCode</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_VOLUME_DOWN)&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentVoice &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            currentVoice --;</span><br><span class="line">        &#125;</span><br><span class="line">        updataVoice(currentVoice, <span class="keyword">false</span>);</span><br><span class="line">        handler.removeMessages(HIDE_MEDIACONTROLLER);</span><br><span class="line">        handler.sendEmptyMessageDelayed(HIDE_MEDIACONTROLLER, <span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;        <span class="comment">// 返回true将不调用系统声音进度条，反之则有进度条</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_VOLUME_UP)&#123;</span><br><span class="line">        <span class="keyword">if</span> (currentVoice &lt; maxVoice) &#123;</span><br><span class="line">            currentVoice++;</span><br><span class="line">        &#125;</span><br><span class="line">        updataVoice(currentVoice, <span class="keyword">false</span>);</span><br><span class="line">        handler.removeMessages(HIDE_MEDIACONTROLLER);</span><br><span class="line">        handler.sendEmptyMessageDelayed(HIDE_MEDIACONTROLLER, <span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="让其他软件能调用我们的播放器"><a href="#让其他软件能调用我们的播放器" class="headerlink" title="让其他软件能调用我们的播放器"></a>让其他软件能调用我们的播放器</h3><h4 id="方法一：参照系统源代码，在功能清单源代码中添加属性。"><a href="#方法一：参照系统源代码，在功能清单源代码中添加属性。" class="headerlink" title="方法一：参照系统源代码，在功能清单源代码中添加属性。"></a>方法一：参照系统源代码，在功能清单源代码中添加属性。</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".activity.SystemVideoPlayer"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">"@string/player_name"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:configChanges</span>=<span class="string">"keyboardHidden|screenSize|orientation"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">"@android:style/Theme.NoTitleBar.Fullscreen"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"rtsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"video/*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"application/sdp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.BROWSABLE"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"http"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"video/mp4"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"video/3gp"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"video/3gpp"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:mimeType</span>=<span class="string">"video/3gpp2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时，在strings.xml文本资源文件中添加一个名为“player_name”的字符串，然后在配置文件中SystemVideoPlayer的activity中添加label属性，就是在外部调用的时候显示的名字：</p>
<p><img src="/2018/08/26/Android开发之手机影音/外部调用.png" alt=""></p>
<h4 id="文件调用过程如下："><a href="#文件调用过程如下：" class="headerlink" title="文件调用过程如下："></a>文件调用过程如下：</h4><ol>
<li>文件或图片浏览器intent隐式意图</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 调起系统所有的播放器 - 隐式意图</span></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">intent.setDataAndType(单个视频地址, <span class="string">"video/*"</span>);</span><br><span class="line">context.startActivity(intent);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>视频播放器被调起并播放</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uri = getIntent().getData();    <span class="comment">// 文件夹、图片浏览器、QQ空间等地址</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置播放地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">videoview.setVideoURI(uri);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="加载播放网络资源视频"><a href="#加载播放网络资源视频" class="headerlink" title="加载播放网络资源视频"></a>加载播放网络资源视频</h3><p>我们先创建一个module，添加一个按钮，用隐式intent调用我们已经写好的播放器播放网络资源。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.startallplayer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startAllPlayer</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">        intent.setDataAndType(Uri.parse(<span class="string">"http://120.79.254.54/test.mp4"</span>), <span class="string">"video/*"</span>);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在原先的视频播放module的资源文件中添加联网权限：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p>设置SystemVideoPlayer中MyOnErrorListener中返回值为true，当出现播放错误时将不会弹出错误提醒的对话框。</p>
<p>如果没有问题，则用另一个软件调用我们的视频播放器播放网络视频将可以正常播放。</p>
<hr>
<h3 id="添加网络视频缓冲"><a href="#添加网络视频缓冲" class="headerlink" title="添加网络视频缓冲"></a>添加网络视频缓冲</h3><p>在utils文件夹下Utils.java文件中增加地址是否是网络视频，通过它的地址前缀实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否是网络资源</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uri</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isNetUri</span><span class="params">(String uri)</span></span>&#123;</span><br><span class="line">	<span class="keyword">boolean</span> reault = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">if</span> (uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(uri.toLowerCase().startsWith(<span class="string">"http"</span>) || uri.toLowerCase().startsWith(<span class="string">"rtsp"</span>) || uri.toLowerCase().startsWith(<span class="string">"mms"</span>))&#123;</span><br><span class="line">			reault = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> reault;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在SystemVideoPlayer中只要是设置播放地址的地方就要判断播放地址是否是网络地址，然后在handler中每秒更新一次缓冲：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是网络资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isNetUri;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置播放地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">        tvName.setText(mediaItem.getName());</span><br><span class="line">        isNetUri = utils.isNetUri(mediaItem.getData());   <span class="comment">// 判断地址是不是网络地址</span></span><br><span class="line">        videoview.setVideoPath(mediaItem.getData());</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        tvName.setText(uri.toString());</span><br><span class="line">        isNetUri = utils.isNetUri(uri.toString());</span><br><span class="line">        videoview.setVideoURI(uri);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"无数据"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">    setButtonState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 播放上一个视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">playPreVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        position--;</span><br><span class="line">        <span class="keyword">if</span>(position &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">            tvName.setText(mediaItem.getName());</span><br><span class="line">            isNetUri = utils.isNetUri(mediaItem.getData());</span><br><span class="line">            videoview.setVideoPath(mediaItem.getData());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置按钮状态</span></span><br><span class="line">            setButtonState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 上一个和下一个按钮设置灰色并不可点击</span></span><br><span class="line">        setButtonState();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 播放下一个视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">playNextVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// 播放下一个</span></span><br><span class="line">        position++;</span><br><span class="line">        <span class="keyword">if</span>(position &lt; mediaItems.size())&#123;</span><br><span class="line">            MediaItem mediaItem = mediaItems.get(position);</span><br><span class="line">            tvName.setText(mediaItem.getName());</span><br><span class="line">            isNetUri = utils.isNetUri(mediaItem.getData());</span><br><span class="line">            videoview.setVideoPath(mediaItem.getData());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置按钮状态</span></span><br><span class="line">            setButtonState();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 上一个和下一个按钮设置灰色并不可点击</span></span><br><span class="line">        setButtonState();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">        <span class="keyword">switch</span> (msg.what)&#123;</span><br><span class="line">            <span class="keyword">case</span> HIDE_MEDIACONTROLLER:</span><br><span class="line">                hideMediaController();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PROGRESS:</span><br><span class="line"></span><br><span class="line">                ……</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 缓存进度的更新</span></span><br><span class="line">                <span class="keyword">if</span> (isNetUri)&#123;</span><br><span class="line">                    <span class="comment">// 只有网络资源有缓存效果</span></span><br><span class="line">                    <span class="keyword">int</span> buffer = videoview.getBufferPercentage();       <span class="comment">// 0 - 100缓冲</span></span><br><span class="line">                    <span class="keyword">int</span> totalBuffer = buffer * seekbarVideo.getMax();</span><br><span class="line">                    <span class="keyword">int</span> secondaryProgress = totalBuffer/<span class="number">100</span>;</span><br><span class="line">                    seekbarVideo.setSecondaryProgress(secondaryProgress);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 本地视频无缓冲效果</span></span><br><span class="line">                    seekbarVideo.setSecondaryProgress(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="/2018/08/26/Android开发之手机影音/NetVideo.jpg" alt=""></h2><h3 id="设置监听播放网络视频卡顿"><a href="#设置监听播放网络视频卡顿" class="headerlink" title="设置监听播放网络视频卡顿"></a>设置监听播放网络视频卡顿</h3><p>前提：播放网络视频网络缓慢的情况。</p>
<p>Android2.3版本在MediaPlayer中引入监听卡，Android4.2.2左右吧监听卡封装在VideoView中，因此在使用时需要注意版本。在没有监听卡的系统版本中，可以使用校验播放进度来判断是否卡顿。</p>
<p>首先新建一个xml资源文件，名为ll_buffer，用来显示卡顿时的跳转进度条和网络速度(模拟，之后完成)。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"#33000000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_netspeed"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"缓存中...30kb/s"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后用include的方式导入到activity_system_video_player.xml文件中，并设置id为ll_buffer。</p>
<p>在SystemVideoPlayer.java文件中，只要实例化组件并在视频准备完成时和卡顿时监听设置组件的视图为可见或者不可见即可：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TextView tv_netspeed;</span><br><span class="line"><span class="keyword">private</span> LinearLayout llBuffer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findViews</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line">    tv_netspeed = (TextView) findViewById(R.id.tv_netspeed);</span><br><span class="line">    llBuffer = (LinearLayout) findViewById(R.id.ll_buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加监听事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">      ……</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在能使用监听卡的android版本范围内监听视频卡顿</span></span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) &#123;</span><br><span class="line">        videoview.setOnInfoListener(<span class="keyword">new</span> MyOnInfoListener());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频卡顿监听</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyOnInfoListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnInfoListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInfo</span><span class="params">(MediaPlayer mp, <span class="keyword">int</span> what, <span class="keyword">int</span> extra)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (what)&#123;</span><br><span class="line">            <span class="keyword">case</span> MediaPlayer.MEDIA_INFO_BUFFERING_START:    <span class="comment">// 视频卡顿</span></span><br><span class="line">                llBuffer.setVisibility(View.VISIBLE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span>  MediaPlayer.MEDIA_INFO_BUFFERING_END:     <span class="comment">// 卡顿结束</span></span><br><span class="line">                llBuffer.setVisibility(View.GONE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频准备好时的监听</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOnPreparedListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnPreparedListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当底层解码准备好的时候</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ……</span><br><span class="line"></span><br><span class="line">        llBuffer.setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="自定义监听卡"><a href="#自定义监听卡" class="headerlink" title="自定义监听卡"></a>自定义监听卡</h3><p>系统自带的监听卡并不是万能的，如果能获得视频的总长度，系统自带的监听卡比较方便，但是如果是直播视频，系统得到的总长度为0而不是实际的总长度，因此，使用自定义的监听卡来实现最为合适。</p>
<p>自定义的监听卡原理是通过handle每秒获得当前进度，然后减去上一秒的进度，如果进度差值过小，则判断为卡顿。</p>
<p>当然两种方式各有优势，我们使用混用的方式，根据需求，修改isUseSystem属性的方式进行切换。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否使用系统监听卡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> isUseSystem = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">        <span class="keyword">switch</span> (msg.what)&#123;</span><br><span class="line">            <span class="keyword">case</span> HIDE_MEDIACONTROLLER:</span><br><span class="line">                hideMediaController();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PROGRESS:</span><br><span class="line"></span><br><span class="line">                ……</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 监听卡</span></span><br><span class="line">                <span class="keyword">if</span> (!isUseSystem &amp;&amp; isNetUri)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(videoview.isPlaying()) &#123;</span><br><span class="line">                        <span class="keyword">int</span> buffer = currentPosition - precurrentPosition;</span><br><span class="line">                        <span class="keyword">if</span> (buffer &lt; <span class="number">500</span>) &#123;</span><br><span class="line">                            <span class="comment">// 视频卡顿</span></span><br><span class="line">                            llBuffer.setVisibility(View.VISIBLE);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// 视频不卡</span></span><br><span class="line">                            llBuffer.setVisibility(View.GONE);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        llBuffer.setVisibility(View.GONE);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                precurrentPosition = currentPosition;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加监听事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isUseSystem)&#123;</span><br><span class="line">        <span class="comment">// 监听视频卡顿</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) &#123;</span><br><span class="line">            videoview.setOnInfoListener(<span class="keyword">new</span> MyOnInfoListener());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>该方法由于是每秒执行一次，所有会有一秒延迟。</p>
<hr>
<h3 id="加载视频等待页面"><a href="#加载视频等待页面" class="headerlink" title="加载视频等待页面"></a>加载视频等待页面</h3><p>等待页面其实很简单，只需要在视频页面上再加一个页面显示等待动画，然后当视频准备好时设置它的属性为不可视即可。</p>
<p>在activity_system_video_player.xml中间中include导入一个名为ll_loading界面:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"@drawable/bg_player_loading_background"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tv_loading"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"#ffffff"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"10sp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"玩命加载中...30kb/s"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后在SystemVideoPlayer.java文件实例化并在视频准备好时的监听中设置llLoading不可视，并在上一个、下一个视频播放的时候设置为可视。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TextView tvLoading;</span><br><span class="line"><span class="keyword">private</span> LinearLayout llLoading;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findViews</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line">    tvLoading = (TextView) findViewById(R.id.tv_loading);</span><br><span class="line">    llLoading = (LinearLayout) findViewById(R.id.ll_loading);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 播放上一个视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">playPreVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        position--;</span><br><span class="line">        <span class="keyword">if</span>(position &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            llLoading.setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">            ……</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 上一个和下一个按钮设置灰色并不可点击</span></span><br><span class="line">        setButtonState();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 播放下一个视频</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">playNextVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mediaItems != <span class="keyword">null</span> &amp;&amp; mediaItems.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// 播放下一个</span></span><br><span class="line">        position++;</span><br><span class="line">        <span class="keyword">if</span>(position &lt; mediaItems.size())&#123;</span><br><span class="line">            llLoading.setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">            ……</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(uri != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 上一个和下一个按钮设置灰色并不可点击</span></span><br><span class="line">        setButtonState();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频准备好时的监听</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyOnPreparedListener</span> <span class="keyword">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnPreparedListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当底层解码准备好的时候</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ……</span><br><span class="line"></span><br><span class="line">        llBuffer.setVisibility(View.GONE);</span><br><span class="line">        llLoading.setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="设置网速"><a href="#设置网速" class="headerlink" title="设置网速"></a>设置网速</h3><p>上面几步只是显示了一个网速文本但是并没有具体真实的值，这里我们真正实现网速功能。</p>
<p>获取网速的方法我们写在工具类Utils.java中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到网速</span></span><br><span class="line"><span class="comment"> * 每隔两秒调用一次</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getNetSpeed</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">	String netSpeed = <span class="string">"kb/s"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">long</span> nowTotalRxBytes = TrafficStats.getUidRxBytes(context.getApplicationInfo().uid)==TrafficStats.UNSUPPORTED ? <span class="number">0</span> :(TrafficStats.getTotalRxBytes()/<span class="number">1024</span>);<span class="comment">//转为KB</span></span><br><span class="line">	<span class="keyword">long</span> nowTimeStamp = System.currentTimeMillis();</span><br><span class="line">	<span class="keyword">long</span> speed = ((nowTotalRxBytes - lastTotalRxBytes) * <span class="number">1000</span> / (nowTimeStamp - lastTimeStamp));<span class="comment">//毫秒转换</span></span><br><span class="line"></span><br><span class="line">	lastTimeStamp = nowTimeStamp;</span><br><span class="line">	lastTotalRxBytes = nowTotalRxBytes;</span><br><span class="line"></span><br><span class="line">	netSpeed = String.valueOf(speed) + <span class="string">" kb/s"</span>;</span><br><span class="line">	<span class="keyword">return</span> netSpeed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>类似的代码可以在百度中查找，但是往往找到的不是直接能用的，因此需要在理解的基础上进行修改，得到我们需要的代码。</p>
<p>在SystemVideoPlayer中调用该方法，并设置加载页面和卡顿时候的网速文本，两秒加载一次。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示网速</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_SPEED = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">        <span class="keyword">switch</span> (msg.what)&#123;</span><br><span class="line">            <span class="keyword">case</span> SHOW_SPEED:    <span class="comment">// 网速</span></span><br><span class="line">                <span class="comment">// 获得网速</span></span><br><span class="line">                String netSpeed = utils.getNetSpeed(SystemVideoPlayer.<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 两秒钟更新一次</span></span><br><span class="line">                handler.removeMessages(SHOW_SPEED);</span><br><span class="line">                handler.sendEmptyMessageDelayed(SHOW_SPEED, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 显示网速</span></span><br><span class="line">                tvLoadingNetSpeed.setText(<span class="string">"玩命加载中..."</span> + netSpeed);</span><br><span class="line">                tvBufferNetSpeed.setText(<span class="string">"玩命加载中..."</span> + netSpeed);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            ……</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到播放地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 得到播放视频</span></span><br><span class="line">    uri = getIntent().getData();        <span class="comment">// 来自于文件夹、图片浏览器、qq空间的视频</span></span><br><span class="line">    mediaItems = (ArrayList&lt;MediaItem&gt;) getIntent().getSerializableExtra(<span class="string">"videolist"</span>);</span><br><span class="line">    position = getIntent().getIntExtra(<span class="string">"position"</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line"></span><br><span class="line">    handler.removeMessages(HIDE_MEDIACONTROLLER);</span><br><span class="line">    handler.sendEmptyMessageDelayed(HIDE_MEDIACONTROLLER, <span class="number">5000</span>);</span><br><span class="line">    <span class="comment">// 初始化完成文本之后要给handler发消息</span></span><br><span class="line">    handler.sendEmptyMessage(SHOW_SPEED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="播放出错处理——万能解码框架-Vitamio"><a href="#播放出错处理——万能解码框架-Vitamio" class="headerlink" title="播放出错处理——万能解码框架 Vitamio"></a>播放出错处理——万能解码框架 Vitamio</h3><p>Vitamio下载地址：<a href="https://www.vitamio.org/Download/" target="_blank" rel="noopener">https://www.vitamio.org/Download/</a></p>
<p>下载完成后解压，运行，可以查看案例。</p>
<h4 id="1-关联Vitamio"><a href="#1-关联Vitamio" class="headerlink" title="1. 关联Vitamio"></a>1. 关联Vitamio</h4><h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/26/Android开发之手机影音/" data-id="cjt2oa2r3004wz0utw5zhifxn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动端/">移动端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android蓝牙开发学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/23/Android蓝牙开发学习/" class="article-date">
  <time datetime="2018-08-23T11:19:06.000Z" itemprop="datePublished">2018-08-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/23/Android蓝牙开发学习/">Android蓝牙开发学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#wifi">WIFI</a></li>
<li><a href="#nfc">NFC</a></li>
<li><a href="#蓝牙bluetooth">蓝牙BlueTooth</a></li>
<li><a href="#对比">对比</a></li>
<li><a href="#蓝牙的工作流程">蓝牙的工作流程</a></li>
<li><a href="#添加权限">添加权限</a></li>
<li><a href="#蓝牙在设备上的可用性">蓝牙在设备上的可用性</a></li>
<li><a href="#开启关闭蓝牙">开启/关闭蓝牙</a></li>
<li><a href="#查找设备">查找设备</a></li>
</ul>
<!-- /TOC -->
<hr>
<p><img src="/2018/08/23/Android蓝牙开发学习/BlueTooth.png" alt=""></p>
<p>无线传输方案：WIFI、NFC、BlueTooth、红外。</p>
<hr>
<h3 id="WIFI"><a href="#WIFI" class="headerlink" title="WIFI"></a>WIFI</h3><p>工作频段：2.4G/5G<br>有效传输距离：10米到数公里<br>传输速度：根据802.11协议族确定。<br>802.11b 11Mpba<br>802.11g 54Mpba<br>802.11n 600Mbps<br>802.11ac 1.3Gbps<br>常用场景：智能家居、无人机控制<br>缺陷：功耗较高</p>
<hr>
<h3 id="NFC"><a href="#NFC" class="headerlink" title="NFC"></a>NFC</h3><p>近场通信技术，能在短距离内与兼容设备进行识别和数据交换。<br>有效传输距离：13.56MHz频率云运行于20厘米距离内。<br>传输速度：400kb/s以下。<br>常用场景：手机支付、门禁、信用卡、AndroidBeam(分享照片和视频)<br>优点：不需要电池、功耗低。</p>
<hr>
<h3 id="蓝牙BlueTooth"><a href="#蓝牙BlueTooth" class="headerlink" title="蓝牙BlueTooth"></a>蓝牙BlueTooth</h3><p>是一种无线技术标准、可实现固定设置设备和楼宇个人域网络之间的短距离数据交换。<br>传输距离：一般在10米内<br>传输速度：2.4G频率，理论传输速度24Mbps(4.0版本)<br>常用场景：蓝牙耳机、蓝牙音箱、无线键鼠、可穿戴个人健康设备、无线数据传输、车载设备通信。</p>
<hr>
<h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><table>
<thead>
<tr>
<th>网络类型</th>
<th>WIFI</th>
<th>NFC</th>
<th>BlueTooth</th>
</tr>
</thead>
<tbody>
<tr>
<td>连接方式</td>
<td>单点对多点</td>
<td>点对点</td>
<td>单点对多点</td>
</tr>
<tr>
<td>使用距离</td>
<td>&lt; 10m-1000m</td>
<td>&lt;=0.02m</td>
<td>&lt;=10m</td>
</tr>
<tr>
<td>速度</td>
<td>&lt; 1.3Gbps</td>
<td>&lt; 400Kbps</td>
<td>&lt; 2424MkBPS</td>
</tr>
<tr>
<td>功耗</td>
<td>中低</td>
<td>很低</td>
<td>低</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="蓝牙的工作流程"><a href="#蓝牙的工作流程" class="headerlink" title="蓝牙的工作流程"></a>蓝牙的工作流程</h3><hr>
<h3 id="添加权限"><a href="#添加权限" class="headerlink" title="添加权限"></a>添加权限</h3><p>在androi studio中创建项目后，在“AndroidManifest.xml”文件中添加如下权限：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加蓝牙权限 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 蓝牙普通权限 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 高级权限，可与其他设备连接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.BLUETOOTH_ADMIN"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>google在android6.0之后，为了更好的保护用户的数据安全，所有需要访问硬件唯一标识符的地方都需要申请位置权限，也就是需要申请:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_COARSE_LOCATION"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="蓝牙在设备上的可用性"><a href="#蓝牙在设备上的可用性" class="headerlink" title="蓝牙在设备上的可用性"></a>蓝牙在设备上的可用性</h3><p>在项目中添加蓝牙权限之后，还需要判断该设备是否拥有蓝牙设备，蓝牙在设备中是否可用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BluetoothAdapter: 本机的蓝牙适配器</span><br><span class="line">BluetoothDevice: 远程的蓝牙适配器</span><br><span class="line"></span><br><span class="line">BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</span><br><span class="line"><span class="keyword">if</span>( mBluetoothAdapter == <span class="keyword">null</span>)&#123;</span><br><span class="line">  <span class="comment">// Device does notsupport BlueTooth</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果设备支持蓝牙，BluetoothAdapter.getDefaultAdapter()将返回一个对象，否则将返回null值。</p>
<hr>
<h3 id="开启-关闭蓝牙"><a href="#开启-关闭蓝牙" class="headerlink" title="开启/关闭蓝牙"></a>开启/关闭蓝牙</h3><p>新建一个名为“BlueToothController.java”类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mybluetooth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.bluetooth.BluetoothAdapter;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  蓝牙适配器</span></span><br><span class="line"><span class="comment"> *  Created by AiJunhao on 2018/8/23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlueToothController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BluetoothAdapter mAdapter;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BlueToothController</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mAdapter = BluetoothAdapter.getDefaultAdapter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否支持蓝牙</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSupperBlueTooth</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( mAdapter != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断当前蓝牙状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getBlueToothStatus</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> (mAdapter != <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span>  mAdapter.isEnabled();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打开蓝牙</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestCode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOnBlueTooth</span><span class="params">(Activity activity, <span class="keyword">int</span> requestCode)</span></span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);</span><br><span class="line">        activity.startActivityForResult(intent, requestCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭蓝牙</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnOffBlueTooth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mAdapter.disable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在“activity_main.xml”文件中添加四个测试按钮：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">".MainActivity"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/is_support_blue_tooth"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"isSupperBlueTooth"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/is_support_blue_tooth"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/is_blue_tooth_enable"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"isBlueToothEnable"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/is_blue_tooth_enable"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/turn_on_blue_tooth"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"requestTurnOnBlueTooth"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/turn_on_blue_tooth"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/turn_off_blue_tooth"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"turnDownBlueTooth"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/turn_off_blue_tooth"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在“MainActivity.java”文件中添加具体的功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.me.mybluetooth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.bluetooth.BluetoothAdapter;</span><br><span class="line"><span class="keyword">import</span> android.content.BroadcastReceiver;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.IntentFilter;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_CODE = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> BlueToothController mController = <span class="keyword">new</span> BlueToothController();</span><br><span class="line">    <span class="keyword">private</span> Toast mToast;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听广播</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BroadcastReceiver receivec = <span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> state = intent.getIntExtra(BluetoothAdapter.EXTRA_STATE, -<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">switch</span> (state)&#123;</span><br><span class="line">                <span class="keyword">case</span> BluetoothAdapter.STATE_OFF:</span><br><span class="line">                    showToast(<span class="string">"STATE_OFF"</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> BluetoothAdapter.STATE_ON:</span><br><span class="line">                    showToast(<span class="string">"STATE_ON"</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> BluetoothAdapter.STATE_TURNING_ON:</span><br><span class="line">                    showToast(<span class="string">"STATE_TURNING_ON"</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> BluetoothAdapter.STATE_TURNING_OFF:</span><br><span class="line">                    showToast(<span class="string">"STATE_TURNING_OFF"</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    showToast(<span class="string">"Unkown STATE"</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        IntentFilter filter = <span class="keyword">new</span> IntentFilter(BluetoothAdapter.ACTION_STATE_CHANGED);</span><br><span class="line">        registerReceiver(receivec, filter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isSupperBlueTooth</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> ret = mController.isSupperBlueTooth();</span><br><span class="line">        showToast(<span class="string">"support Bluetooth? "</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isBlueToothEnable</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> ret = mController.getBlueToothStatus();</span><br><span class="line">        showToast(<span class="string">"BlueTooth enable? "</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestTurnOnBlueTooth</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        mController.turnOnBlueTooth(<span class="keyword">this</span>, REQUEST_CODE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">turnDownBlueTooth</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        mController.turnOffBlueTooth();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(String text)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mToast == <span class="keyword">null</span>)&#123;</span><br><span class="line">            mToast = Toast.makeText(<span class="keyword">this</span>, text, Toast.LENGTH_SHORT);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mToast.setText(text);</span><br><span class="line">        &#125;</span><br><span class="line">        mToast.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="查找设备"><a href="#查找设备" class="headerlink" title="查找设备"></a>查找设备</h3><p>使用BluetoothAdapter中的startDiscovery()方法，需要与广播向结合。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/23/Android蓝牙开发学习/" data-id="cjt2oa27p002ez0utbl37zgjc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动端/">移动端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python学习笔记——Pygame游戏开发(打飞机小游戏)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/" class="article-date">
  <time datetime="2018-08-12T07:18:59.000Z" itemprop="datePublished">2018-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/">Python学习笔记——Pygame游戏开发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#安装pygame">安装Pygame</a></li>
<li><a href="#pygame-基本框架">Pygame 基本框架</a></li>
<li><a href="#颜控set_mode">颜控，set_mode()</a></li>
<li><a href="#图像">图像</a><ul>
<li><a href="#基本几何图形绘制">基本几何图形绘制</a></li>
</ul>
</li>
<li><a href="#事件处理">事件处理</a></li>
<li><a href="#绘制文字">绘制文字</a></li>
<li><a href="#pygame-动画精灵">Pygame 动画精灵</a><ul>
<li><a href="#创建精灵">创建精灵</a></li>
<li><a href="#精灵组">精灵组</a></li>
<li><a href="#一个基本动画精灵小游戏代码">一个基本动画精灵小游戏代码：</a></li>
<li><a href="#播放音乐和音效">播放音乐和音效</a></li>
<li><a href="#音效">音效</a></li>
<li><a href="#音乐">音乐</a></li>
</ul>
</li>
<li><a href="#光标处理">光标处理</a></li>
</ul>
<!-- /TOC -->
<hr>
<p>Pygame 内部是使用c语言实现的，所以Pygame游戏的效率还是比较高的。</p>
<hr>
<h3 id="安装Pygame"><a href="#安装Pygame" class="headerlink" title="安装Pygame"></a>安装Pygame</h3><p>打开cmd命令行。输入”pip install pygame”，系统自行安装即可。<br><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/InstallPygame.png" alt=""></p>
<p>在IDLE中测试：<br><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameTest.png" alt=""></p>
<p>如此，安装完成。</p>
<hr>
<h3 id="Pygame-基本框架"><a href="#Pygame-基本框架" class="headerlink" title="Pygame 基本框架"></a>Pygame 基本框架</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化Pygame</span></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画布大小，元组类型</span></span><br><span class="line">SIZE = (width, height) = <span class="number">600</span>, <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建指定大小的窗口，单位为像素，返回Surface对象，作为背景画布</span></span><br><span class="line">screen = pygame.display.set_mode(SIZE)</span><br><span class="line"><span class="comment"># 设置窗口标题</span></span><br><span class="line">pygame.display.set_caption(<span class="string">"初次见面，大家多多关照!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载图片</span></span><br><span class="line"><span class="comment">#turtle = pygame.image.load("turtle.png")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序主循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取事件</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="comment"># 判断事件是否为退出事件</span></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            <span class="comment"># 退出pygame</span></span><br><span class="line">            pygame.quit()</span><br><span class="line">            <span class="comment"># 退出系统</span></span><br><span class="line">            sys.exit()</span><br></pre></td></tr></table></figure>
<p>一个游戏循环（也可以称为主循环）就做下面这三件事：</p>
<ul>
<li>处理事件</li>
<li>更新游戏状态</li>
<li>绘制游戏状态到屏幕上</li>
</ul>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameMain.png" alt=""></p>
<hr>
<h3 id="颜控，set-mode"><a href="#颜控，set-mode" class="headerlink" title="颜控，set_mode()"></a>颜控，set_mode()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set_mode返回值为Surface对象</span></span><br><span class="line">screen = set_mode(resolution(<span class="number">0</span>, <span class="number">0</span>), flags=<span class="number">0</span>, depth=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>flags拓展选项：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>FULLSCREEN</td>
<td>全屏模式</td>
</tr>
<tr>
<td>DOUBLEBUF</td>
<td>双缓冲模式</td>
</tr>
<tr>
<td>HWSURFACE</td>
<td>硬件加速支持(只有在全屏模式下才能使用)</td>
</tr>
<tr>
<td>OPENGL</td>
<td>使用OpenGL渲染(3D游戏)</td>
</tr>
<tr>
<td>RESIZABLE</td>
<td>是的窗口可以调整大小</td>
</tr>
<tr>
<td>NOFRAME</td>
<td>使得窗口没有边框和控制按钮</td>
</tr>
</tbody>
</table>
<p>depth一般不建议自动设置，系统会根据需要自己调整。</p>
<p>案例：全屏设置(有bug)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line">SIZE = (WITDH, HEIGHT) = (<span class="number">600</span>, <span class="number">400</span>)</span><br><span class="line">WIGHT = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全屏</span></span><br><span class="line">fullscreen = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">screen</span><br><span class="line">= pygame.display.set_mode(SIZE)</span><br><span class="line">pygame.display.set_caption(<span class="string">"全屏设置"</span>)</span><br><span class="line">screen.fill(WIGHT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            pygame.quit()</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.KEYDOWN:</span><br><span class="line">            <span class="comment"># 设置F11为全屏键</span></span><br><span class="line">            <span class="keyword">if</span> event.key == pygame.K_F11:</span><br><span class="line">                fullscreen = <span class="keyword">not</span> fullscreen</span><br><span class="line">                <span class="keyword">if</span> fullscreen:</span><br><span class="line">                    <span class="comment"># 获取系统支持的最高分辨率</span></span><br><span class="line">                    SIZE_Biggest = pygame.display.list_modes()[<span class="number">0</span>]</span><br><span class="line">                    screen = pygame.display.set_mode(SIZE_Biggest, pygame.FULLSCREEN | pygame.HWSURFACE)</span><br><span class="line">                <span class="keyword">else</span> :</span><br><span class="line">                    screen = pygame.display.set_mode(SIZE)</span><br><span class="line">    screen.fill(WIGHT)</span><br><span class="line">    <span class="comment"># 更新界面</span></span><br><span class="line">    pygame.display.flip()</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="图像"><a href="#图像" class="headerlink" title="图像"></a>图像</h3><p>与图像有关的方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>flip</td>
<td>上下、左右转转图片</td>
</tr>
<tr>
<td>scale</td>
<td>快速缩放图像</td>
</tr>
<tr>
<td>rotate</td>
<td>旋转图像</td>
</tr>
<tr>
<td>rotozoom</td>
<td>缩放并旋转图像</td>
</tr>
<tr>
<td>scale2x</td>
<td>快速放大一倍图像</td>
</tr>
<tr>
<td>smoothscale</td>
<td>精准平滑缩放图像</td>
</tr>
<tr>
<td>chop</td>
<td>裁剪图像</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载png图片，使用convert_alpha加载透明alpha通道</span></span><br><span class="line">turtle_img = pygame.image.load(<span class="string">"turtle.png"</span>).convert_alpha()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载jpg图片</span></span><br><span class="line">turtle_img = pygame.image.load(<span class="string">"turtle.jpg"</span>).convert()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不支持gif</span></span><br></pre></td></tr></table></figure>
<p>实例：沿框运动的小乌龟<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化Pygame</span></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line">size = (width, height) = (<span class="number">600</span>, <span class="number">400</span>)</span><br><span class="line">speed = [<span class="number">2</span>, <span class="number">0</span>]</span><br><span class="line">bg = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置帧率</span></span><br><span class="line">clock = pygame.time.Clock()</span><br><span class="line"></span><br><span class="line">screen = pygame.display.set_mode(size)</span><br><span class="line">pygame.display.set_caption(<span class="string">"沿框运动的小乌龟"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载图片</span></span><br><span class="line">turtle_img = pygame.image.load(<span class="string">"turtle.png"</span>)</span><br><span class="line">turtle_right = pygame.transform.rotate(turtle_img, <span class="number">90</span>)</span><br><span class="line">turtle_top = pygame.transform.rotate(turtle_img, <span class="number">180</span>)</span><br><span class="line">turtle_left = pygame.transform.rotate(turtle_img, <span class="number">270</span>)</span><br><span class="line">turtle_bottom = turtle_img</span><br><span class="line">turtle = turtle_top</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得图像的位置矩形</span></span><br><span class="line">position = turtle.get_rect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序主循环持续运行</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取事件，在此处退出</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="comment"># 判断事件是否为退出事件</span></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            <span class="comment"># 退出pygame</span></span><br><span class="line">            <span class="comment"># pygame.quit()</span></span><br><span class="line">            <span class="comment"># 退出系统</span></span><br><span class="line">            sys.exit()</span><br><span class="line">    <span class="comment"># 移动图像</span></span><br><span class="line">    position = position.move(speed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> position.right &gt; width:</span><br><span class="line">        turtle = turtle_right</span><br><span class="line">        position = turtle_rect = turtle.get_rect()</span><br><span class="line">        position.left = width - turtle_rect.width</span><br><span class="line">        speed = [<span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> position.bottom &gt; height:</span><br><span class="line">        turtle = turtle_bottom</span><br><span class="line">        position = turtle_rect = turtle.get_rect()</span><br><span class="line">        position.left = width - turtle_rect.width</span><br><span class="line">        position.top = height - turtle_rect.height</span><br><span class="line">        speed = [<span class="number">-2</span>, <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> position.left &lt; <span class="number">0</span>:</span><br><span class="line">        turtle = turtle_left</span><br><span class="line">        position = turtle_rect = turtle.get_rect()</span><br><span class="line">        position.top = height - turtle_rect.height</span><br><span class="line">        speed = [<span class="number">0</span>, <span class="number">-2</span>]</span><br><span class="line">    <span class="keyword">if</span> position.top &lt; <span class="number">0</span>:</span><br><span class="line">        turtle = turtle_top</span><br><span class="line">        position = turtle_rect = turtle.get_rect()</span><br><span class="line">        speed = [<span class="number">2</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 填充背景</span></span><br><span class="line">    screen.fill(bg)</span><br><span class="line">    <span class="comment"># 更新图像</span></span><br><span class="line">    screen.blit(turtle, position)</span><br><span class="line">    <span class="comment"># 更新界面</span></span><br><span class="line">    pygame.display.flip()</span><br><span class="line">    <span class="comment"># 延迟10毫秒</span></span><br><span class="line">    <span class="comment"># pygame.time.delay(10)</span></span><br><span class="line">    clock.tick(<span class="number">200</span>)</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameRunAroundTurtle.gif" alt=""></p>
<h4 id="基本几何图形绘制"><a href="#基本几何图形绘制" class="headerlink" title="基本几何图形绘制"></a>基本几何图形绘制</h4><table>
<thead>
<tr>
<th>名称</th>
<th>方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>一条</td>
<td>pygame.draw.line(Surface, color, start_pos, end_pos, width)</td>
</tr>
<tr>
<td>抗锯齿的线</td>
<td>pygame.draw.aaline(Surface, color, start_pos, end_pos, blend)</td>
</tr>
<tr>
<td>折线</td>
<td>pygame.draw.lines(Surface, color, closed, pointlist, width)</td>
</tr>
<tr>
<td>矩形</td>
<td>pygame.draw.rect(Surface, color, Rect)</td>
</tr>
<tr>
<td>矩形框</td>
<td>pygame.draw.rect(Surface, color, Rect, width</td>
</tr>
<tr>
<td>椭圆</td>
<td>pygame.draw.ellipse(Surface, color, Rect)</td>
</tr>
<tr>
<td>椭圆框</td>
<td>pygame.draw.ellipse(Surface, color, Rect, width)</td>
</tr>
<tr>
<td>多边形</td>
<td>pygame.draw.polygon(Surface, color, pointlist, width)</td>
</tr>
<tr>
<td>弧线</td>
<td>pygame.draw.arc(Surface, color, Rect, start_angle, stop_angle, width)</td>
</tr>
<tr>
<td>圆</td>
<td>pygame.draw.circle(Surface, color, Rect, radius)</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入需要的模块</span></span><br><span class="line"><span class="keyword">import</span> pygame, sys</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> pi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化pygame</span></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置窗口的大小，单位为像素</span></span><br><span class="line">screen = pygame.display.set_mode((<span class="number">400</span>,<span class="number">300</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置窗口标题</span></span><br><span class="line">pygame.display.set_caption(<span class="string">'Drawing'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义颜色</span></span><br><span class="line">BLACK = ( <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">WHITE = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">RED = (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">GREEN = ( <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">BLUE = ( <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置背景颜色</span></span><br><span class="line">screen.fill(WHITE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一条线</span></span><br><span class="line">pygame.draw.line(screen, GREEN, [<span class="number">0</span>, <span class="number">0</span>], [<span class="number">50</span>,<span class="number">30</span>], <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一条抗锯齿的线</span></span><br><span class="line">pygame.draw.aaline(screen, GREEN, [<span class="number">0</span>, <span class="number">50</span>],[<span class="number">50</span>, <span class="number">80</span>],<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一条折线</span></span><br><span class="line">pygame.draw.lines(screen, BLACK, <span class="keyword">False</span>,</span><br><span class="line">         [[<span class="number">0</span>, <span class="number">80</span>], [<span class="number">50</span>, <span class="number">90</span>], [<span class="number">200</span>, <span class="number">80</span>], [<span class="number">220</span>, <span class="number">30</span>]], <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一个空心矩形</span></span><br><span class="line">pygame.draw.rect(screen, BLACK, [<span class="number">75</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">20</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一个矩形</span></span><br><span class="line">pygame.draw.rect(screen, BLACK, [<span class="number">150</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">20</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一个空心椭圆</span></span><br><span class="line">pygame.draw.ellipse(screen, RED, [<span class="number">225</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">20</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一个椭圆</span></span><br><span class="line">pygame.draw.ellipse(screen, RED, [<span class="number">300</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">20</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制多边形</span></span><br><span class="line">pygame.draw.polygon(screen, BLACK, [[<span class="number">100</span>, <span class="number">100</span>], [<span class="number">0</span>, <span class="number">200</span>], [<span class="number">200</span>, <span class="number">200</span>]], <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制多条弧线</span></span><br><span class="line">pygame.draw.arc(screen, BLACK,[<span class="number">210</span>, <span class="number">75</span>, <span class="number">150</span>, <span class="number">125</span>], <span class="number">0</span>, pi/<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">pygame.draw.arc(screen, GREEN,[<span class="number">210</span>, <span class="number">75</span>, <span class="number">150</span>, <span class="number">125</span>], pi/<span class="number">2</span>, pi, <span class="number">2</span>)</span><br><span class="line">pygame.draw.arc(screen, BLUE, [<span class="number">210</span>, <span class="number">75</span>, <span class="number">150</span>, <span class="number">125</span>], pi,<span class="number">3</span>*pi/<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">pygame.draw.arc(screen, RED, [<span class="number">210</span>, <span class="number">75</span>, <span class="number">150</span>, <span class="number">125</span>], <span class="number">3</span>*pi/<span class="number">2</span>, <span class="number">2</span>*pi, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制一个圆</span></span><br><span class="line">pygame.draw.circle(screen, BLUE, [<span class="number">60</span>, <span class="number">250</span>], <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序主循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 获取事件</span></span><br><span class="line">  <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">    <span class="comment"># 判断事件是否为退出事件</span></span><br><span class="line">    <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">      <span class="comment"># 退出pygame</span></span><br><span class="line">      pygame.quit()</span><br><span class="line">      <span class="comment"># 退出系统</span></span><br><span class="line">      sys.exit()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 绘制屏幕内容</span></span><br><span class="line">  pygame.display.flip()</span><br></pre></td></tr></table></figure>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameImage.png" alt=""></p>
<hr>
<h3 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h3><p>编写一个程序，将所有执行的事件写入到一个文件中：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame, sys</span><br><span class="line"></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line">size = width, height =  <span class="number">600</span>, <span class="number">400</span></span><br><span class="line">screen = pygame.display.set_mode(size)</span><br><span class="line">pygame.display.set_caption(<span class="string">"事件处理"</span>)</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">"record.txt"</span>, <span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="comment"># 获取事件</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        f.write(str(event) + <span class="string">'\n'</span>)</span><br><span class="line">        <span class="comment"># 判断事件是否为退出事件</span></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            f.close()</span><br><span class="line">            <span class="comment"># 退出pygame</span></span><br><span class="line">            pygame.quit()</span><br><span class="line">            <span class="comment"># 退出系统</span></span><br><span class="line">            sys.exit()</span><br></pre></td></tr></table></figure></p>
<p>运行程序，随意移动鼠标、点击鼠标、按键盘等，然后关闭程序，在程序同目录下打开“record.txt”文件，可以看到如下：<br><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameEventTxt.png" alt=""></p>
<table>
<thead>
<tr>
<th>事件</th>
<th>产生途径</th>
<th>参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>QUIT</td>
<td>用户按下关闭按钮</td>
<td>none</td>
</tr>
<tr>
<td>ACTIVEEVENT</td>
<td>Pygame被激活或者隐藏</td>
<td>gain, state</td>
</tr>
<tr>
<td>KEYDOWN</td>
<td>键盘被按下</td>
<td>unicode, key, mod</td>
</tr>
<tr>
<td>KEYUP</td>
<td>键盘被放开</td>
<td>key, mod</td>
</tr>
<tr>
<td>MOUSEMOTION</td>
<td>鼠标移动</td>
<td>pos, rel, buttons</td>
</tr>
<tr>
<td>MOUSEBUTTONDOWN</td>
<td>鼠标按下</td>
<td>pos, button</td>
</tr>
<tr>
<td>MOUSEBUTTONUP</td>
<td>鼠标放开</td>
<td>pos, button</td>
</tr>
<tr>
<td>JOYAXISMOTION</td>
<td>游戏手柄的摇杆移动</td>
<td>joy, axis, value</td>
</tr>
<tr>
<td>JOYBALLMOTION</td>
<td>游戏手柄上的轨迹球混动</td>
<td>joy, axis, value</td>
</tr>
<tr>
<td>JOYHATMOTION</td>
<td>游戏手柄上的帽子开关移动</td>
<td>joy， axis， value</td>
</tr>
<tr>
<td>JOYBUTTONDOWN</td>
<td>游戏手柄按钮被按下</td>
<td>joy,button</td>
</tr>
<tr>
<td>JOYBUTTONUP</td>
<td>游戏手柄按钮被松开</td>
<td>joy, button</td>
</tr>
<tr>
<td>VIDEORESIZE</td>
<td>Pygame窗口缩放</td>
<td>size, w, h</td>
</tr>
<tr>
<td>VIDEOEXPOSE</td>
<td>部分窗口需要重新绘制</td>
<td>none</td>
</tr>
<tr>
<td>USEERVENT</td>
<td>用户定义的事件</td>
<td>code</td>
</tr>
</tbody>
</table>
<p>运动的小乌龟事件处理：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化Pygame</span></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line">size = width, height = <span class="number">600</span>, <span class="number">400</span></span><br><span class="line">speed = [<span class="number">-2</span>, <span class="number">1</span>]</span><br><span class="line">bg = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 帧率</span></span><br><span class="line">clock = pygame.time.Clock()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建指定大小的窗口，单位为像素，返回Surface对象，作为背景画布</span></span><br><span class="line">screen = pygame.display.set_mode(size)</span><br><span class="line"><span class="comment"># 设置窗口标题</span></span><br><span class="line">pygame.display.set_caption(<span class="string">"初次见面，大家多多关照!"</span>)</span><br><span class="line"><span class="comment"># 加载图片</span></span><br><span class="line">turtle = pygame.image.load(<span class="string">"turtle.png"</span>)</span><br><span class="line"><span class="comment"># 获得图像的位置矩形</span></span><br><span class="line">position = turtle.get_rect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置左右键按下时的乌龟头朝向</span></span><br><span class="line">l_head = turtle</span><br><span class="line">r_head = pygame.transform.flip(turtle, <span class="keyword">True</span>, <span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序主循环持续运行</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取事件，在此处退出</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="comment"># 判断事件是否为退出事件</span></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            <span class="comment"># 退出pygame</span></span><br><span class="line">            pygame.quit()</span><br><span class="line">            <span class="comment"># 退出系统</span></span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.KEYDOWN:</span><br><span class="line">            <span class="keyword">if</span> event.key == pygame.K_LEFT:</span><br><span class="line">                turtle = l_head</span><br><span class="line">                speed = [<span class="number">-1</span>, <span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> event.key == pygame.K_RIGHT:</span><br><span class="line">                turtle = r_head</span><br><span class="line">                speed = [<span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> event.key == pygame.K_UP:</span><br><span class="line">                speed = [<span class="number">0</span>, <span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> event.key == pygame.K_DOWN:</span><br><span class="line">                speed = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 移动图像</span></span><br><span class="line">    position = position.move(speed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> position.left &lt; <span class="number">0</span> <span class="keyword">or</span> position.right &gt; width:</span><br><span class="line">        <span class="comment"># 翻转图像</span></span><br><span class="line">        turtle = pygame.transform.flip(turtle, <span class="keyword">True</span>, <span class="keyword">False</span>)</span><br><span class="line">        <span class="comment"># 反方向移动</span></span><br><span class="line">        speed[<span class="number">0</span>] = -speed[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> position.top &lt; <span class="number">0</span> <span class="keyword">or</span> position.bottom &gt; height:</span><br><span class="line">        speed[<span class="number">1</span>] = -speed[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 填充背景</span></span><br><span class="line">    screen.fill(bg)</span><br><span class="line">    <span class="comment"># 更新图像</span></span><br><span class="line">    screen.blit(turtle, position)</span><br><span class="line">    <span class="comment"># 更新界面</span></span><br><span class="line">    pygame.display.flip()</span><br><span class="line">    <span class="comment"># 设置帧率</span></span><br><span class="line">    clock.tick(<span class="number">200</span>)</span><br></pre></td></tr></table></figure></p>
<p>小乌龟素材：<br><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/turtle.png" alt=""></p>
<p>效果如下：<br><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/TurtleMoveEvent.gif" alt=""></p>
<hr>
<h3 id="绘制文字"><a href="#绘制文字" class="headerlink" title="绘制文字"></a>绘制文字</h3><p>Pygame没有文本组件，大师可以通过另一种方式实现相同效果。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过字体文件获得字体对象; filename:系统文字名， size：字体大小</span></span><br><span class="line">fontObj = pygame.font.SysFont(filename, size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义字体</span></span><br><span class="line">fontObj = pygame.font.Font(filename, size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置要显示的文字；text：要显示的文字， antialias：是否抗锯齿(Ture/False), color：字体颜色，background：背景色</span></span><br><span class="line">textSurfaceObj = fontObj.render(text, antialias, color, background=<span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得要显示的对象的rect</span></span><br><span class="line">textRectObj = textSurfaceObj.get_rect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置显示对象的坐标</span></span><br><span class="line">textRectObj.center = (<span class="number">250</span>, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制字体</span></span><br><span class="line">screen.blit(textSurfaceObj, textRectObj)</span><br></pre></td></tr></table></figure></p>
<p>如果不知道系统中用什么字体，可以在IDLE环境中通过以下获取：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pygame</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(pygame.font.get_fonts())</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameFont.png" alt=""></p>
<p>文字绘制案例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入需要的模块</span></span><br><span class="line"><span class="keyword">import</span> pygame, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化pygame</span></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义颜色</span></span><br><span class="line">WHITE = (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)</span><br><span class="line">GREEN = ( <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">BLUE = ( <span class="number">0</span>, <span class="number">0</span>, <span class="number">128</span>)</span><br><span class="line">SIZE = (width, height) = (<span class="number">500</span>, <span class="number">400</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置窗口的大小，单位为像素</span></span><br><span class="line">screen = pygame.display.set_mode(SIZE)</span><br><span class="line"><span class="comment"># 设置背景</span></span><br><span class="line">screen.fill(WHITE)</span><br><span class="line"><span class="comment"># 设置窗口的标题</span></span><br><span class="line">pygame.display.set_caption(<span class="string">'Font'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过字体文件获得字体对象</span></span><br><span class="line">fontObj = pygame.font.SysFont(<span class="string">"华文彩云"</span>, <span class="number">50</span>)</span><br><span class="line"><span class="comment"># 配置要显示的文字</span></span><br><span class="line">textSurfaceObj = fontObj.render(<span class="string">'Pygame'</span>, <span class="keyword">True</span>, BLUE, GREEN)</span><br><span class="line"><span class="comment"># 获得要显示的对象的rect</span></span><br><span class="line">textRectObj = textSurfaceObj.get_rect()</span><br><span class="line"><span class="comment"># 设置显示对象的坐标</span></span><br><span class="line">textRectObj.center = (<span class="number">250</span>, <span class="number">200</span>)</span><br><span class="line"><span class="comment"># 绘制字体</span></span><br><span class="line">screen.blit(textSurfaceObj, textRectObj)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序主循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 获取事件</span></span><br><span class="line">  <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">    <span class="comment"># 判断事件是否为退出事件</span></span><br><span class="line">    <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">      <span class="comment"># 退出pygame</span></span><br><span class="line">      pygame.quit()</span><br><span class="line">      <span class="comment"># 退出系统</span></span><br><span class="line">      sys.exit()</span><br><span class="line"></span><br><span class="line">  pygame.display.flip()</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameFontTest.png" alt=""></p>
<p>模拟文本，在页面上打印event事件：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame, sys</span><br><span class="line"></span><br><span class="line">pygame.init()</span><br><span class="line"></span><br><span class="line">SIZE = (width, height) = (<span class="number">600</span>, <span class="number">400</span>)</span><br><span class="line">BLACK = (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">GREEN = (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>)</span><br><span class="line">screen = pygame.display.set_mode(SIZE)</span><br><span class="line">pygame.display.set_caption(<span class="string">"Font"</span>)</span><br><span class="line"></span><br><span class="line">font = pygame.font.SysFont(<span class="keyword">None</span>, <span class="number">20</span>)</span><br><span class="line">line_height = font.get_linesize()</span><br><span class="line">postion = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">screen.fill(BLACK)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            pygame.quit()</span><br><span class="line">            sys.exit()</span><br><span class="line">        screen.blit(font.render(str(event), <span class="keyword">True</span>, GREEN), (<span class="number">0</span>, postion))</span><br><span class="line">        postion += line_height</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> postion &gt; height:</span><br><span class="line">            postion = <span class="number">0</span></span><br><span class="line">            screen.fill(BLACK)</span><br><span class="line"></span><br><span class="line">    pygame.display.flip()</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameFont2.png" alt=""></p>
<hr>
<h3 id="Pygame-动画精灵"><a href="#Pygame-动画精灵" class="headerlink" title="Pygame 动画精灵"></a>Pygame 动画精灵</h3><p>pygame.sprite.Sprite就是Pygame里面用来实现精灵的一个类，使用时，并不需要对它实例化，只需要继承他，然后按需写出自己的类就好了，因此非常简单实用。</p>
<h4 id="创建精灵"><a href="#创建精灵" class="headerlink" title="创建精灵"></a>创建精灵</h4><p>创建Sprite精灵类，用过调用精灵，创建对象：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义一个类，继承Sprite类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ball</span><span class="params">(pygame.sprite.Sprite)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        pygame.sprite.Sprite.__init__(self)     <span class="comment"># 调用基类及init方法</span></span><br></pre></td></tr></table></figure></p>
<h4 id="精灵组"><a href="#精灵组" class="headerlink" title="精灵组"></a>精灵组</h4><p>当程序中有大量的实体的时候，操作这些实体将会是一件相当麻烦的事，使用精灵组来管理精灵绘制和更新，会轻松很多。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group = pygame.sprite.Group()</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>常用方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Group.sprites</td>
<td>精灵组</td>
</tr>
<tr>
<td>Group.add</td>
<td>添加</td>
</tr>
<tr>
<td>Group.copy</td>
<td>复制</td>
</tr>
<tr>
<td>Group.remove</td>
<td>移除</td>
</tr>
<tr>
<td>Group.has</td>
<td>判断精灵组成员</td>
</tr>
<tr>
<td>Group.update</td>
<td>更新</td>
</tr>
<tr>
<td>Group.draw</td>
<td>位块显示</td>
</tr>
<tr>
<td>Group.clear</td>
<td>绘制背景</td>
</tr>
<tr>
<td>Group.empty</td>
<td>清空</td>
</tr>
</tbody>
</table>
<h4 id="一个基本动画精灵小游戏代码："><a href="#一个基本动画精灵小游戏代码：" class="headerlink" title="一个基本动画精灵小游戏代码："></a>一个基本动画精灵小游戏代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ball</span><span class="params">(pygame.sprite.Sprite)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, image, position, speed, bg_size)</span>:</span></span><br><span class="line">        pygame.sprite.Sprite.__init__(self)</span><br><span class="line"></span><br><span class="line">        self.image = pygame.image.load(image).convert_alpha()</span><br><span class="line">        self.rect = self.image.get_rect()</span><br><span class="line">        (self.rect.left, self.rect.top) = position</span><br><span class="line">        self.speed = speed</span><br><span class="line">        (self.width, self.height) = bg_size</span><br><span class="line">        <span class="comment"># 确定半径，在sprite内置碰撞检测中使用</span></span><br><span class="line">        self.radius = self.rect.width / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 运动检测</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.rect = self.rect.move(self.speed)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 完全穿过时穿越</span></span><br><span class="line">        <span class="keyword">if</span> self.rect.right &lt; <span class="number">0</span>:</span><br><span class="line">            self.rect.left = self.width</span><br><span class="line">        <span class="keyword">elif</span> self.rect.left &gt; self.width:</span><br><span class="line">            self.rect.right = <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> self.rect.bottom &lt; <span class="number">0</span>:</span><br><span class="line">            self.rect.top = self.height</span><br><span class="line">        <span class="keyword">elif</span> self.rect.top &gt; self.height:</span><br><span class="line">            self.rect.bottom = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义的碰撞检测方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">collide_check</span><span class="params">(item, target)</span>:</span></span><br><span class="line">    col_balls = []</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> target:</span><br><span class="line">        distance = math.sqrt(</span><br><span class="line">            math.pow((item.rect.center[<span class="number">0</span>] - each.rect.center[<span class="number">0</span>]), <span class="number">2</span>) +</span><br><span class="line">            math.pow((item.rect.center[<span class="number">1</span>] - each.rect.center[<span class="number">1</span>]), <span class="number">2</span>))</span><br><span class="line">        <span class="keyword">if</span> distance &lt;= (item.rect.width + each.rect.width) / <span class="number">2</span>:</span><br><span class="line">            col_balls.append(each)</span><br><span class="line">    <span class="keyword">return</span> col_balls</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    pygame.init()</span><br><span class="line"></span><br><span class="line">    ball_image = <span class="string">"gray_ball.png"</span></span><br><span class="line">    bg_image = <span class="string">"background.png"</span></span><br><span class="line"></span><br><span class="line">    running = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    bg_size = (width, height) = (<span class="number">1024</span>, <span class="number">681</span>)</span><br><span class="line">    screen = pygame.display.set_mode(bg_size)</span><br><span class="line">    pygame.display.set_caption(<span class="string">"PlayTheBall"</span>)</span><br><span class="line"></span><br><span class="line">    background = pygame.image.load(bg_image).convert_alpha()</span><br><span class="line"></span><br><span class="line">    balls = []</span><br><span class="line">    group = pygame.sprite.Group()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建5个小球</span></span><br><span class="line">    BALL_NUM = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(BALL_NUM):</span><br><span class="line">        <span class="comment"># 位置随机，速度随机</span></span><br><span class="line">        position = (random.randint(<span class="number">0</span>, width<span class="number">-100</span>), random.randint(<span class="number">0</span>, height<span class="number">-100</span>))</span><br><span class="line">        speed = [random.randint(<span class="number">-10</span>, <span class="number">10</span>), random.randint(<span class="number">-10</span>, <span class="number">10</span>)]</span><br><span class="line">        ball = Ball(ball_image, position, speed, bg_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 生成球时的碰撞检测</span></span><br><span class="line">        <span class="string">""" # 自定义碰撞检测</span></span><br><span class="line"><span class="string">        while collide_check(ball, balls):</span></span><br><span class="line"><span class="string">            (ball.rect.left, ball.rect.top) = random.randint(0, width-100), random.randint(0, height-100)"""</span></span><br><span class="line">        <span class="comment"># sprite方法碰撞检测</span></span><br><span class="line">        <span class="keyword">while</span> pygame.sprite.spritecollide(ball, group, <span class="keyword">False</span>, pygame.sprite.collide_circle):</span><br><span class="line">            (ball.rect.left, ball.rect.top) = (random.randint(<span class="number">0</span>, width - <span class="number">100</span>), random.randint(<span class="number">0</span>, height - <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">        balls.append(ball)</span><br><span class="line">        group.add(ball)</span><br><span class="line"></span><br><span class="line">    clock = pygame.time.Clock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> running:</span><br><span class="line">        <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">            <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">                pygame.quit()</span><br><span class="line">                sys.exit()</span><br><span class="line"></span><br><span class="line">        screen.blit(background, (<span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> balls:</span><br><span class="line">            each.move()</span><br><span class="line">            screen.blit(each.image, each.rect)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># sprite 的碰撞检测</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> group:</span><br><span class="line">            group.remove(each)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> pygame.sprite.spritecollide(each, group, <span class="keyword">False</span>, pygame.sprite.collide_circle):</span><br><span class="line">                each.speed[<span class="number">0</span>] = -each.speed[<span class="number">0</span>]</span><br><span class="line">                each.speed[<span class="number">1</span>] = -each.speed[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            group.add(each)</span><br><span class="line"></span><br><span class="line">        <span class="string">"""# 自定义的碰撞检测</span></span><br><span class="line"><span class="string">        for i in range(BALL_NUM):</span></span><br><span class="line"><span class="string">            item = balls.pop(i)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            if collide_check(item, balls):</span></span><br><span class="line"><span class="string">                item.speed[0] = -item.speed[0]</span></span><br><span class="line"><span class="string">                item.speed[1] = -item.speed[1]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            balls.insert(i, item)"""</span></span><br><span class="line"></span><br><span class="line">        pygame.display.flip()</span><br><span class="line">        clock.tick(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameSpriteBall.gif" alt=""></p>
<hr>
<h4 id="播放音乐和音效"><a href="#播放音乐和音效" class="headerlink" title="播放音乐和音效"></a>播放音乐和音效</h4><p>背景音乐是时刻伴随着游戏存在的，往往是重复播放的一首歌或曲子。<br>音效是某种条件下呗出发产生的，如小球碰撞时发出声音。</p>
<p>Pygame支持的声音格式十分有限，一般使用ogg格式作为背景音乐，用无压缩的wav格式作为音效。格式可以通过“格式工厂”来转换。</p>
<p>格式工厂官网链接：<a href="http://www.pcfreetime.com/" target="_blank" rel="noopener">http://www.pcfreetime.com/</a></p>
<h4 id="音效"><a href="#音效" class="headerlink" title="音效"></a>音效</h4><p>播放音效使用mixer模块，先生成一个Sound对象，然后调用play()方法来播放。</p>
<p>音效可以有多个。</p>
<p>Sound支持的方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>play()</td>
<td>播放音效</td>
</tr>
<tr>
<td>stop()</td>
<td>停止播放</td>
</tr>
<tr>
<td>fadeout()</td>
<td>淡出</td>
</tr>
<tr>
<td>set_volume()</td>
<td>设置音量</td>
</tr>
<tr>
<td>get_volune()</td>
<td>获取音量</td>
</tr>
<tr>
<td>get_num_channels()</td>
<td>计算该音效播放了多少次</td>
</tr>
<tr>
<td>get_length()</td>
<td>获得该音效的长度，多少秒</td>
</tr>
<tr>
<td>get_raw()</td>
<td>将音效以二进制格式的字符串返回</td>
</tr>
</tbody>
</table>
<h4 id="音乐"><a href="#音乐" class="headerlink" title="音乐"></a>音乐</h4><p>音乐使用music模块。</p>
<p>背景音乐只能有一个。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>load()</td>
<td>载入音乐</td>
</tr>
<tr>
<td>play()</td>
<td>播放音乐</td>
</tr>
<tr>
<td>rewind()</td>
<td>重新播放</td>
</tr>
<tr>
<td>stop()</td>
<td>停止播放</td>
</tr>
<tr>
<td>pause()</td>
<td>暂停播放</td>
</tr>
<tr>
<td>uppause()</td>
<td>恢复播放</td>
</tr>
<tr>
<td>fadeout()</td>
<td>淡出</td>
</tr>
<tr>
<td>set_volume()</td>
<td>设置音量</td>
</tr>
<tr>
<td>get_volume()</td>
<td>获取音量</td>
</tr>
<tr>
<td>get_busy()</td>
<td>监测音乐流是否正在播放</td>
</tr>
<tr>
<td>set_pos()</td>
<td>设置开始播放的位置</td>
</tr>
<tr>
<td>get_pos()</td>
<td>获取已经播放的时间</td>
</tr>
<tr>
<td>queue()</td>
<td>将音乐文件放入待播放列表中</td>
</tr>
<tr>
<td>set_endevent()</td>
<td>在音乐播放完毕时发送事件</td>
</tr>
<tr>
<td>get_endevent()</td>
<td>获取音乐播放完毕时发送的事件类型</td>
</tr>
</tbody>
</table>
<p>声音播放案例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">pygame.init()</span><br><span class="line">pygame.mixer.init()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载背景音乐</span></span><br><span class="line">pygame.mixer.music.load(<span class="string">"bg_music.ogg"</span>)</span><br><span class="line">pygame.mixer.music.set_volume(<span class="number">0.2</span>)</span><br><span class="line">pygame.mixer.music.play()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载音效</span></span><br><span class="line">cat_sound = pygame.mixer.Sound(<span class="string">"cat.wav"</span>)</span><br><span class="line">cat_sound.set_volume(<span class="number">0.2</span>)</span><br><span class="line">dog_sound = pygame.mixer.Sound(<span class="string">"dog.wav"</span>)</span><br><span class="line">dog_sound.set_volume(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">bg_size = (width, height) = (<span class="number">300</span>, <span class="number">200</span>)</span><br><span class="line">screen = pygame.display.set_mode(bg_size)</span><br><span class="line">pygame.display.set_caption(<span class="string">"Music"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 音乐暂停标志</span></span><br><span class="line">pause = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载暂停和开始图片，并设置居中</span></span><br><span class="line">pause_img = pygame.image.load(<span class="string">"pause.png"</span>).convert_alpha()</span><br><span class="line">unpause_img = pygame.image.load(<span class="string">"unpause.png"</span>).convert_alpha()</span><br><span class="line">pause_rect = pause_img.get_rect()</span><br><span class="line">(pause_rect.left, pause_rect.top) = ((width - pause_rect.width) // <span class="number">2</span>, (height - pause_rect.height) // <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">clock = pygame.time.Clock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.QUIT:</span><br><span class="line">            pygame.quit()</span><br><span class="line">            sys.exit()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 鼠标点击事件</span></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.MOUSEBUTTONDOWN:</span><br><span class="line">            <span class="comment"># 1为鼠标左键，2为鼠标中键，3为鼠标右键</span></span><br><span class="line">            <span class="keyword">if</span> event.button == <span class="number">1</span>:</span><br><span class="line">                cat_sound.play()</span><br><span class="line">            <span class="keyword">if</span> event.button == <span class="number">3</span>:</span><br><span class="line">                dog_sound.play()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置按键事件</span></span><br><span class="line">        <span class="keyword">if</span> event.type == pygame.KEYDOWN:</span><br><span class="line">            <span class="keyword">if</span> event.key == pygame.K_SPACE:</span><br><span class="line">                pause = <span class="keyword">not</span> pause</span><br><span class="line"></span><br><span class="line">    screen.fill((<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据pause状态画图标，的并设置背景的暂停和播放</span></span><br><span class="line">    <span class="keyword">if</span> pause:</span><br><span class="line">        screen.blit(pause_img, pause_rect)</span><br><span class="line">        pygame.mixer.music.pause()</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        screen.blit(unpause_img, pause_rect)</span><br><span class="line">        pygame.mixer.music.unpause()</span><br><span class="line"></span><br><span class="line">    pygame.display.flip()</span><br><span class="line"></span><br><span class="line">    clock.tick(<span class="number">30</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/PygameMusic.png" alt=""></p>
<hr>
<h3 id="光标处理"><a href="#光标处理" class="headerlink" title="光标处理"></a>光标处理</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/12/Python学习笔记——Pygame游戏开发(打飞机小游戏)/" data-id="cjt2oa2e7003lz0utddu4099h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python学习笔记——网络爬虫" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/09/Python学习笔记——网络爬虫/" class="article-date">
  <time datetime="2018-08-09T07:05:46.000Z" itemprop="datePublished">2018-08-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/09/Python学习笔记——网络爬虫/">Python学习笔记——网络爬虫</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<!-- TOC -->
<ul>
<li><a href="#网络爬虫">网络爬虫</a></li>
<li><a href="#url">URL</a></li>
<li><a href="#python访问url测试">python访问URL测试</a></li>
<li><a href="#爬虫实战">爬虫实战</a><ul>
<li><a href="#实例1-抓取一张网络图片">实例1 抓取一张网络图片</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h3 id="网络爬虫"><a href="#网络爬虫" class="headerlink" title="网络爬虫"></a>网络爬虫</h3><p>网络爬虫（又被称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本。网络爬虫就是根据网页的地址来寻找网页的，也就是URL。举一个简单的例子，我们在浏览器的地址栏中输入的字符串就是URL，例如：<a href="https://www.baidu.com/" target="_blank" rel="noopener">https://www.baidu.com/</a></p>
<hr>
<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>URL的一般格式为(当方括号[]的为可选项)：protocol://hostname[:port]/path/[;parameters][?query]#fragment</p>
<ul>
<li>“protocol://“ : 协议，如http, https, ftp, file(本地磁盘文件), ed2k …</li>
<li>“hostname[:port]” : 存放资源的服务器的域名系统或IP地址(有时候包含端口号，各种传输协议都有默认的端口嗷，如http的80端口)</li>
<li>“path/[;parameters][?query]#fragment” : 资源的具体地址，如目录或文件名等。</li>
</ul>
<hr>
<h3 id="python访问URL测试"><a href="#python访问URL测试" class="headerlink" title="python访问URL测试"></a>python访问URL测试</h3><p>使用urllib.request实现：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> urllib.request       <span class="comment"># 导入urllib.request包</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = urllib.request.urlopen(<span class="string">"http://www.aijunhao.com.cn"</span>)     <span class="comment"># 获取我的个人网站首页</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>html = response.read().decode(<span class="string">"utf-8"</span>)      <span class="comment"># 读取我的个人网站首页，并用utf-8编码模式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(html)             <span class="comment"># 打印</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span>/&gt;</span><br><span class="line">        &lt;link rel=<span class="string">"shortcut icon"</span> href=<span class="string">"images/1.ico"</span>&gt;</span><br><span class="line">        &lt;link href=<span class="string">"css/menu.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">        &lt;title&gt;AI , Sparks of fire&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;!-- 背景画布开始 --&gt;</span><br><span class="line">        &lt;canvas id="canvas" &gt;&lt;/canvas&gt;</span><br><span class="line">        &lt;script src="js/background.js" type="text/javascript"&gt;&lt;/script&gt;</span><br><span class="line">        &lt;!-- 背景画布结束 --&gt;</span><br><span class="line">        &lt;!-- 使用外联播放器，并隐藏播放器 --&gt;</span><br><span class="line">        &lt;iframe frameborder="no" border="0" width=0 height=0  src="//music.163.com/outchain/player?type=2&amp;id=491757187&amp;auto=1&amp;height=66"&gt;&lt;/iframe&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class="cs" &gt;</span><br><span class="line">            &lt;div class="introduction" align="center"&gt;</span><br><span class="line"></span><br><span class="line">                &lt;header style="color: white;font-size: 4rem;"&gt;Hello，&lt;/header&gt;</span><br><span class="line">                &lt;header style=<span class="string">"color: white;font-size: 2rem;"</span>&gt;I<span class="string">'m Junhao Ai.&lt;/header&gt;</span></span><br><span class="line"><span class="string">                &lt;p style="color: white;font-size: 1rem;"&gt;A student of the Zhijiang College of ZheJiang University of Technology.&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;br&gt; &lt;br&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                &lt;p&gt;Whatever is worth doing is worth doing well.&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                &lt;br&gt; &lt;br&gt; &lt;br&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                &lt;a href="http://user.qzone.qq.com/1172949809/infocenter" class="btn-slide" target="_blank"&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="circle"&gt;&lt;i class="fa fa-rocket"&gt;&lt;/i&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="title"&gt;QQ Zone&lt;/span&gt; &lt;span class="title-hover"&gt;Visit me.&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="files/test.php" class="btn-slide2" target="_blank"&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="circle2"&gt;&lt;i class="fa fa-download"&gt;&lt;/i&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="title2"&gt;About Me&lt;/span&gt; &lt;span class="title-hover2"&gt;Building...&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="https://aijunhao.github.io" class="btn-slide" target="_blank"&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="circle"&gt;&lt;i class="fa fa-rocket"&gt;&lt;/i&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="title"&gt;My Blog&lt;/span&gt; &lt;span class="title-hover"&gt;Building...&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="files/test.php" class="btn-slide2" target="_blank"&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="circle2"&gt;&lt;i class="fa fa-download"&gt;&lt;/i&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="title2"&gt;My Gains&lt;/span&gt; &lt;span class="title-hover2"&gt;Building...&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1172949809&amp;website=www.oicqzone.com" class="btn-slide" target="_blank"&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="circle"&gt;&lt;i class="fa fa-rocket"&gt;&lt;/i&gt;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;span class="title"&gt;Contact Me&lt;/span&gt; &lt;span class="title-hover"&gt;QQ Test&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/09/Python学习笔记——网络爬虫/myweb.png" alt=""></p>
<hr>
<h3 id="爬虫实战"><a href="#爬虫实战" class="headerlink" title="爬虫实战"></a>爬虫实战</h3><h4 id="实例1-抓取一张网络图片"><a href="#实例1-抓取一张网络图片" class="headerlink" title="实例1 抓取一张网络图片"></a>实例1 抓取一张网络图片</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(<span class="string">"http://www.aijunhao.com.cn/images/building.png"</span>)</span><br><span class="line">img = response.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'webTest.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(img)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/09/Python学习笔记——网络爬虫/" data-id="cjt2oa23x000nz0utzl4pqrxa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python学习笔记——GUI编程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/08/Python学习笔记——GUI编程/" class="article-date">
  <time datetime="2018-08-08T11:48:50.000Z" itemprop="datePublished">2018-08-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/08/Python学习笔记——GUI编程/">Python学习笔记——GUI编程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#第一个实例">第一个实例</a></li>
<li><a href="#tkinter-常用方法">tkinter 常用方法</a></li>
<li><a href="#label-文本">Label 文本</a></li>
<li><a href="#button-按钮">Button 按钮</a></li>
<li><a href="#checkbutton-复选框">Checkbutton 复选框</a></li>
<li><a href="#radiobutton">Radiobutton</a></li>
</ul>
<!-- /TOC -->
<hr>
<p>GUI的终极选择：Tkinter</p>
<h2 id="https-blog-csdn-net-u014380159-article-details-51941842"><a href="#https-blog-csdn-net-u014380159-article-details-51941842" class="headerlink" title="https://blog.csdn.net/u014380159/article/details/51941842"></a><a href="https://blog.csdn.net/u014380159/article/details/51941842" target="_blank" rel="noopener">https://blog.csdn.net/u014380159/article/details/51941842</a></h2><h3 id="第一个实例"><a href="#第一个实例" class="headerlink" title="第一个实例"></a>第一个实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk      <span class="comment"># 导入tkinter模块</span></span><br><span class="line"></span><br><span class="line">root = tk.Tk()        <span class="comment"># 生成窗口实例，即父容器</span></span><br><span class="line"></span><br><span class="line">photo = tk.PhotoImage(file=<span class="string">'bg.gif'</span>)      <span class="comment"># 添加图片</span></span><br><span class="line">theLabel = tk.Label(root,</span><br><span class="line">                  text=<span class="string">'我们一起学猫叫\n一起喵喵喵喵~'</span>,</span><br><span class="line">                  justify=tk.LEFT,</span><br><span class="line">                  image=photo,</span><br><span class="line">                  compound=tk.CENTER,</span><br><span class="line">                  font=(<span class="string">"华康少女文字W5"</span>, <span class="number">20</span>),</span><br><span class="line">                  fg=<span class="string">"white"</span>)</span><br><span class="line"></span><br><span class="line">theLabel.pack()</span><br><span class="line"></span><br><span class="line">tk.mainloop()   <span class="comment"># 进入消息循环</span></span><br></pre></td></tr></table></figure>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/2018/08/08/Python学习笔记——GUI编程/FirstTkinter.PNG" alt=""></h2><h3 id="tkinter-常用方法"><a href="#tkinter-常用方法" class="headerlink" title="tkinter 常用方法"></a>tkinter 常用方法</h3><table>
<thead>
<tr>
<th style="text-align:left">方法名</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">案例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Tk()</td>
<td style="text-align:left">生成窗口实例</td>
<td style="text-align:left">root = tkinter.Tk()</td>
</tr>
<tr>
<td style="text-align:left">title()</td>
<td style="text-align:left">设置窗口标题</td>
<td style="text-align:left">root.title(‘title’)</td>
</tr>
<tr>
<td style="text-align:left">geometry()</td>
<td style="text-align:left">设置窗口大小</td>
<td style="text-align:left">root.geometry(‘300x200’)</td>
</tr>
<tr>
<td style="text-align:left">mainloop()</td>
<td style="text-align:left">主事件循环</td>
<td style="text-align:left">root.mainloop() 或 tkinter.mainloop()</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<hr>
<h3 id="Label-文本"><a href="#Label-文本" class="headerlink" title="Label 文本"></a>Label 文本</h3><p>标签控件，可以显示文本和位图。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">label = tkinter.Label(master, option=value, ... )</span><br><span class="line"></span><br><span class="line">l.pack()</span><br></pre></td></tr></table></figure></p>
<p>案例:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter_label</span><span class="params">(label)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">global</span> counter</span><br><span class="line">        counter += <span class="number">1</span></span><br><span class="line">        label.config(text=str(counter))</span><br><span class="line">        label.after(<span class="number">1000</span>, count)</span><br><span class="line"></span><br><span class="line">    count()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root = tk.Tk()</span><br><span class="line">root.title(<span class="string">"Counting Seconds"</span>)</span><br><span class="line">label = tk.Label(root, fg=<span class="string">"green"</span>)</span><br><span class="line">label.pack()</span><br><span class="line">counter_label(label)</span><br><span class="line">button = tk.Button(root, text=<span class="string">'Stop'</span>, width=<span class="number">25</span>, command=root.destroy)</span><br><span class="line">button.pack()</span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>可选项(option)</th>
<th>描述</th>
<th>案例</th>
</tr>
</thead>
<tbody>
<tr>
<td>activebackground</td>
<td>设置当Label处于活动状态(state选项设置状态)，选择框的背景色。</td>
<td>activebackground=”#000000”</td>
</tr>
<tr>
<td>activeforeground</td>
<td>设置当Label处于活动状态(当鼠标点击时)，选择框的文本颜色。</td>
<td>activeforeground=”yellow”</td>
</tr>
<tr>
<td>anchor</td>
<td>锚选项，可选项为n, ne, e, se, s, sw, w, nw, center(默认)。</td>
<td>anchor=’w’</td>
</tr>
<tr>
<td>bg/background</td>
<td>标签的背景色。</td>
<td>bg=”yellow”</td>
</tr>
<tr>
<td>compound</td>
<td>文本和图像的混合模式</td>
<td>image=img, <br> compound=tkinter.LEFT</td>
</tr>
<tr>
<td>fg</td>
<td>按钮文本的颜色。</td>
<td>fg=”yellow”</td>
</tr>
<tr>
<td>font</td>
<td>文本字体。</td>
<td>font=”楷体”</td>
</tr>
<tr>
<td>height/width</td>
<td>按钮的高度/宽度。</td>
<td>height=5,width=15</td>
</tr>
<tr>
<td>image</td>
<td>按钮图片。</td>
<td>img_png = tkinter.PhotoImage(file = ‘18.gif’)  <br>  button = tkinter.Label(root,image=img_png)</td>
</tr>
<tr>
<td>justify</td>
<td>显示多行文本的对齐方式，可选项包括left, right, cneter(默认)。</td>
<td>justify=”center” <br> 或 justify=tkinter.CENTER</td>
</tr>
<tr>
<td>text</td>
<td>按钮的文本内容</td>
<td>text=”…”</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="Button-按钮"><a href="#Button-按钮" class="headerlink" title="Button 按钮"></a>Button 按钮</h3><p>按钮控件，在程序中显示按钮。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">button = tkinter.Button(master, option=value, ... )       <span class="comment"># master:按钮父容器,option:可选项</span></span><br><span class="line"></span><br><span class="line">button.pack()       <span class="comment"># 将小部件放置到窗口中</span></span><br></pre></td></tr></table></figure>
<p>案例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"></span><br><span class="line">root = tkinter.Tk()</span><br><span class="line">button = tkinter.Button(root, text=<span class="string">"Button"</span>)</span><br><span class="line"></span><br><span class="line">button.pack()</span><br><span class="line"></span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/08/Python学习笔记——GUI编程/Button.PNG" alt=""></p>
<table>
<thead>
<tr>
<th>可选项(option)</th>
<th>描述</th>
<th>案例</th>
</tr>
</thead>
<tbody>
<tr>
<td>activebackground</td>
<td>当鼠标点击时，按钮的背景色。</td>
<td>activebackground=”#000000”</td>
</tr>
<tr>
<td>activeforeground</td>
<td>当鼠标点击时，按钮的文本颜色。</td>
<td>activeforeground=”yellow”</td>
</tr>
<tr>
<td>anchor</td>
<td>锚选项，可选项为n, ne, e, se, s, sw, w, nw, center(默认)。</td>
<td>anchor=’w’</td>
</tr>
<tr>
<td>bd</td>
<td>按钮边框的大小，默认为 2 个像素。</td>
<td>bd=5</td>
</tr>
<tr>
<td>bg/background</td>
<td>按钮的背景色。</td>
<td>bg=”blue”</td>
</tr>
<tr>
<td>command</td>
<td>按钮关联的函数，当按钮被点击时，执行该函数。</td>
<td>command=函数名</td>
</tr>
<tr>
<td>fg</td>
<td>按钮文本的颜色。</td>
<td>fg=”yellow”</td>
</tr>
<tr>
<td>font</td>
<td>文本字体。</td>
<td>font=”楷体”</td>
</tr>
<tr>
<td>height/width</td>
<td>按钮的高度/宽度。</td>
<td>height=5,width=15</td>
</tr>
<tr>
<td>image</td>
<td>按钮图片。</td>
<td>img_png = tkinter.PhotoImage(file = ‘18.gif’)  <br>  button = tkinter.Button(root,image=img_png)</td>
</tr>
<tr>
<td>justify</td>
<td>显示多行文本的对齐方式，可选项包括left, right, cneter(默认)。</td>
<td>justify=”center” <br> 或 justify=tkinter.CENTER</td>
</tr>
<tr>
<td>padx/pady</td>
<td>按钮在x/y轴防线上的内边距。</td>
<td>padx=30, pady=30</td>
</tr>
<tr>
<td>relief</td>
<td>边框样式，设置控件3D效果，可选的有：flat(默认)、sunken、raised、groove、ridge。</td>
<td>relief=”flat”</td>
</tr>
<tr>
<td>state</td>
<td>设置按钮组件状态,可选的有normal(默认)、active、 disabled。</td>
<td>state=”disabled”</td>
</tr>
<tr>
<td>underline</td>
<td>下划线。</td>
<td>有些小问题。underline=0</td>
</tr>
<tr>
<td>text</td>
<td>按钮的文本内容</td>
<td>text=”…”</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="Checkbutton-复选框"><a href="#Checkbutton-复选框" class="headerlink" title="Checkbutton 复选框"></a>Checkbutton 复选框</h3><p>多选框控件，用于在程序中提供多项选择框。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">c = Checkbutton ( master, option=value, ... )</span><br><span class="line">c.pack()</span><br></pre></td></tr></table></figure>
<p>案例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"></span><br><span class="line">root = tkinter.Tk()</span><br><span class="line"></span><br><span class="line">c = tkinter.Checkbutton(root, text=<span class="string">"选择框"</span>)</span><br><span class="line"></span><br><span class="line">c.pack()</span><br><span class="line"></span><br><span class="line">root.mainloop()</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/08/08/Python学习笔记——GUI编程/CheckButton1.PNG" alt=""></p>
<table>
<thead>
<tr>
<th style="text-align:left">可选项(option)</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">案例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">activebackground</td>
<td style="text-align:left">设置当Button处于活动状态(当鼠标点击时)，选择框的背景色。</td>
<td style="text-align:left">activebackground=”#000000”</td>
</tr>
<tr>
<td style="text-align:left">activeforeground</td>
<td style="text-align:left">设置当Button处于活动状态(当鼠标点击时)，选择框的文本颜色。</td>
<td style="text-align:left">activeforeground=”yellow”</td>
</tr>
<tr>
<td style="text-align:left">anchor</td>
<td style="text-align:left">锚选项，可选项为n, ne, e, se, s, sw, w, nw, center(默认)。</td>
<td style="text-align:left">anchor=’w’</td>
</tr>
<tr>
<td style="text-align:left">bg/background</td>
<td style="text-align:left">按钮的背景色。</td>
<td style="text-align:left">bg=”blue”</td>
</tr>
<tr>
<td style="text-align:left">bitmap</td>
<td style="text-align:left">使用位图，可选项有error，gray75，gray50，gray25，gray12，<br>hourglass，info，questhead，question，warning</td>
<td style="text-align:left">bitmap=”error”</td>
</tr>
<tr>
<td style="text-align:left">bd</td>
<td style="text-align:left">边框的大小，默认为 2 个像素</td>
<td style="text-align:left">bd=10</td>
</tr>
<tr>
<td style="text-align:left">command</td>
<td style="text-align:left">按钮关联的函数，当按钮被点击时，执行该函数。</td>
<td style="text-align:left">command=函数名</td>
</tr>
<tr>
<td style="text-align:left">cursor</td>
<td style="text-align:left">光标的形状设定，可选项有arrow(默认), circle, cross, plus</td>
<td style="text-align:left">cursor=”circle”</td>
</tr>
<tr>
<td style="text-align:left">disabledforeground</td>
<td style="text-align:left">禁用选项的前景色</td>
<td style="text-align:left">disabledforeground=”#123456”</td>
</tr>
<tr>
<td style="text-align:left">font</td>
<td style="text-align:left">文本字体</td>
<td style="text-align:left">font=”…”</td>
</tr>
<tr>
<td style="text-align:left">fg</td>
<td style="text-align:left">选项的前景色</td>
<td style="text-align:left">fg=”red”</td>
</tr>
<tr>
<td style="text-align:left">image</td>
<td style="text-align:left">是否使用图标。</td>
<td style="text-align:left">img = tkinter.PhotoImage(file=”bg.gif”) <br>c = tkinter.Checkbutton(root,image=img)</td>
</tr>
<tr>
<td style="text-align:left">justify</td>
<td style="text-align:left">多行文本设置不同行之间的对齐方式，可选项包括left, right, cneter(默认)。</td>
<td style="text-align:left">justify=“center” <br> 或 justify=tkinter.CENTER</td>
</tr>
<tr>
<td style="text-align:left">onvalue/offvalue</td>
<td style="text-align:left">设置 Checkbutton 的状态值。</td>
<td style="text-align:left">onvalue = 1, offvalue = 0</td>
</tr>
<tr>
<td style="text-align:left">padx/pady</td>
<td style="text-align:left">设置选择框在x轴/y轴方向上的内边距，默认为1像素</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">relief</td>
<td style="text-align:left">边框样式，设置控件3D效果，可选的有：flat(默认)、sunken、raised、groove、ridge。</td>
<td style="text-align:left">relief=”flat”</td>
</tr>
<tr>
<td style="text-align:left">relief=”raised”</td>
<td style="text-align:left">选中后的颜色。</td>
<td style="text-align:left">selectcolor=”red”</td>
</tr>
<tr>
<td style="text-align:left">state</td>
<td style="text-align:left">设置选择框组件状态,可选的有normal(默认)、active、 disabled。</td>
<td style="text-align:left">state=”disabled”</td>
</tr>
<tr>
<td style="text-align:left">underline</td>
<td style="text-align:left">下划线。</td>
<td style="text-align:left">有些小问题。underline=0</td>
</tr>
<tr>
<td style="text-align:left">text</td>
<td style="text-align:left">选择框的文本内容</td>
<td style="text-align:left">text=”…”</td>
</tr>
<tr>
<td style="text-align:left">variable</td>
<td style="text-align:left">变量，variable 的值为 1 或 0，代表着选中或不选中</td>
<td style="text-align:left">v = tkinter.IntVar() <br> c = tkinter.Checkbutton(root, variable = v)</td>
</tr>
</tbody>
</table>
<p>常用方法</p>
<table>
<thead>
<tr>
<th style="text-align:left">方法</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">deselect()</td>
<td style="text-align:left">清除复选框选中选项。</td>
</tr>
<tr>
<td style="text-align:left">flash()</td>
<td style="text-align:left">在激活状态颜色和正常颜色之间闪烁几次单选按钮，但保持它开始时的状态。</td>
</tr>
<tr>
<td style="text-align:left">invoke()</td>
<td style="text-align:left">可以调用此方法来获得与用户单击单选按钮以更改其状态时发生的操作相同的操作。</td>
</tr>
<tr>
<td style="text-align:left">select()</td>
<td style="text-align:left">设置按钮为选中。</td>
</tr>
<tr>
<td style="text-align:left">toggle()</td>
<td style="text-align:left">选中与没有选中的选项互相切换。</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"></span><br><span class="line">root = tkinter.Tk()         <span class="comment"># 生成窗口</span></span><br><span class="line"></span><br><span class="line">GIRLS = [<span class="string">'西施'</span>, <span class="string">'貂蝉'</span>, <span class="string">'王昭君'</span>, <span class="string">'杨玉环'</span>]</span><br><span class="line">v = []        <span class="comment"># 表示按钮是否被选中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> girl <span class="keyword">in</span> GIRLS:</span><br><span class="line">    v.append(tkinter.IntVar())</span><br><span class="line">    b = tkinter.Checkbutton(root, text=girl, variable=v[<span class="number">-1</span>])</span><br><span class="line">    b.pack(anchor=<span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line">tkinter.mainloop()</span><br></pre></td></tr></table></figure>
<p><img src="/2018/08/08/Python学习笔记——GUI编程/TkinterCheckButton.PNG" alt=""></p>
<hr>
<h3 id="Radiobutton"><a href="#Radiobutton" class="headerlink" title="Radiobutton"></a>Radiobutton</h3><p>单选按钮控件，显示一个单选的按钮状态。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/08/Python学习笔记——GUI编程/" data-id="cjt2oa27q002gz0utd4srjior" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python学习笔记——异常处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/07/Python学习笔记——异常处理/" class="article-date">
  <time datetime="2018-08-07T14:22:19.000Z" itemprop="datePublished">2018-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/07/Python学习笔记——异常处理/">Python学习笔记——异常处理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#python标准异常总结">Python标准异常总结</a></li>
<li><a href="#异常处理">异常处理</a></li>
<li><a href="#触发异常">触发异常</a></li>
<li><a href="#用户自定义异常类型">用户自定义异常类型</a></li>
</ul>
<!-- /TOC -->
<h3 id="Python标准异常总结"><a href="#Python标准异常总结" class="headerlink" title="Python标准异常总结"></a>Python标准异常总结</h3><table>
<thead>
<tr>
<th style="text-align:left">异常</th>
<th style="text-align:left">异常说明</th>
<th style="text-align:center">出现程度</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">AssertionError</td>
<td style="text-align:left">断言语句（assert）失败</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">AttributeError</td>
<td style="text-align:left">尝试访问未知的对象属性</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">EOFError</td>
<td style="text-align:left">用户输入文件末尾标志EOF（Ctrl+d）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">FloatingPointError</td>
<td style="text-align:left">浮点计算错误</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">GeneratorExit</td>
<td style="text-align:left">generator.close()方法被调用的时候</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">ImportError</td>
<td style="text-align:left">导入模块失败的时候</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">IndexError</td>
<td style="text-align:left">索引超出序列的范围</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">KeyError</td>
<td style="text-align:left">字典中查找一个不存在的关键字</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">KeyboardInterrupt</td>
<td style="text-align:left">用户输入中断键（Ctrl+c）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">MemoryError</td>
<td style="text-align:left">内存溢出（可通过删除对象释放内存）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">NameError</td>
<td style="text-align:left">尝试访问一个不存在的变量</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">NotImplementedError</td>
<td style="text-align:left">尚未实现的方法</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">OSError</td>
<td style="text-align:left">操作系统产生的异常（例如打开一个不存在的文件）</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">OverflowError</td>
<td style="text-align:left">数值运算超出最大限制</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">ReferenceError</td>
<td style="text-align:left">弱引用（weak reference）试图访问一个已经被垃圾回收机制回收了的对象</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">RuntimeError</td>
<td style="text-align:left">一般的运行时错误</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">StopIteration</td>
<td style="text-align:left">迭代器没有更多的值</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">SyntaxError</td>
<td style="text-align:left">Python的语法错误</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">IndentationError</td>
<td style="text-align:left">缩进错误</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">TabError</td>
<td style="text-align:left">Tab和空格混合使用</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">SystemError</td>
<td style="text-align:left">Python编译器系统错误</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">SystemExit</td>
<td style="text-align:left">Python编译器进程被关闭</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">TypeError</td>
<td style="text-align:left">不同类型间的无效操作</td>
<td style="text-align:center">常见</td>
</tr>
<tr>
<td style="text-align:left">UnboundLocalError</td>
<td style="text-align:left">访问一个未初始化的本地变量（NameError的子类）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">UnicodeError</td>
<td style="text-align:left">Unicode相关的错误（ValueError的子类）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">UnicodeEncodeError</td>
<td style="text-align:left">Unicode编码时的错误（UnicodeError的子类）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">UnicodeDecodeError</td>
<td style="text-align:left">Unicode解码时的错误（UnicodeError的子类）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">UnicodeTranslateError</td>
<td style="text-align:left">Unicode转换时的错误（UnicodeError的子类）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">ValueError</td>
<td style="text-align:left">传入无效的参数</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left">ZeroDivisionError</td>
<td style="text-align:left">除数为零</td>
<td style="text-align:center">常见</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><p>捕捉异常可以使用try/except语句。</p>
<p>try/except语句用来检测try语句块中的错误，从而让except语句捕获异常信息并处理。</p>
<p>如果你不想在异常发生时结束你的程序，只需在try里捕获它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  &lt;语句块&gt;       <span class="comment"># 运行代码</span></span><br><span class="line"><span class="keyword">except</span> &lt;异常名&gt; [<span class="keyword">as</span> reason]:</span><br><span class="line">  &lt;语句块&gt;       <span class="comment"># 出现错误时执行的语句</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">  &lt;语句块&gt;        <span class="comment"># 无论都会被执行的代码</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = open(<span class="string">"一个错误的文件.txt"</span>)</span><br><span class="line">    print(f.read())</span><br><span class="line">    f.close()</span><br><span class="line"><span class="keyword">except</span> OSError <span class="keyword">as</span> reason:</span><br><span class="line">    print(<span class="string">'文件出错！错误原因是：'</span> + str(reason))    <span class="comment"># 打印异常名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">文件出错！错误原因是：[Errno <span class="number">2</span>] No such file <span class="keyword">or</span> directory: <span class="string">'一个错误的文件.txt'</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="触发异常"><a href="#触发异常" class="headerlink" title="触发异常"></a>触发异常</h3><p>我们可以使用raise语句自己触发异常。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line"><span class="keyword">raise</span> [Exception [, args [, traceback]]]</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="用户自定义异常类型"><a href="#用户自定义异常类型" class="headerlink" title="用户自定义异常类型"></a>用户自定义异常类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义异常类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Networkerror</span><span class="params">(RuntimeError)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">        self.args = arg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 触发该异常，如下所示：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> Networkerror(<span class="string">"Bad hostname"</span>)</span><br><span class="line"><span class="keyword">except</span> Networkerror,e:</span><br><span class="line">    <span class="keyword">print</span> e.args</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/07/Python学习笔记——异常处理/" data-id="cjt2oa23q000iz0utrpd9u7m5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python学习笔记——常用模块" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/07/Python学习笔记——常用模块/" class="article-date">
  <time datetime="2018-08-07T08:25:42.000Z" itemprop="datePublished">2018-08-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/07/Python学习笔记——常用模块/">Python学习笔记——常用模块</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#python模块篇">Python模块篇</a><ul>
<li><a href="#模块导入">模块导入</a><ul>
<li><a href="#import语句">import语句</a></li>
</ul>
</li>
<li><a href="#from--import--语句">from … import * 语句</a></li>
<li><a href="#dir函数">dir()函数</a></li>
<li><a href="#random模块">random模块</a></li>
<li><a href="#time模块">time模块</a></li>
<li><a href="#jieba模块">jieba模块</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<hr>
<h2 id="Python模块篇"><a href="#Python模块篇" class="headerlink" title="Python模块篇"></a>Python模块篇</h2><hr>
<h3 id="模块导入"><a href="#模块导入" class="headerlink" title="模块导入"></a>模块导入</h3><h4 id="import语句"><a href="#import语句" class="headerlink" title="import语句"></a>import语句</h4><p>在文件顶部位置导入模块，然后使用。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line"><span class="keyword">import</span> module_name          <span class="comment"># 导入一个模块，同一个模块只会被导入一次</span></span><br><span class="line"></span><br><span class="line">module_name.function()          <span class="comment"># 调用模块中的指定方法</span></span><br></pre></td></tr></table></figure></p>
<h3 id="from-…-import-语句"><a href="#from-…-import-语句" class="headerlink" title="from … import * 语句"></a>from … import * 语句</h3><p>不适用于大文件，容易重名冲突。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module_name <span class="keyword">import</span> *    <span class="comment"># 导入名为module_name的模块</span></span><br><span class="line"></span><br><span class="line">function()       <span class="comment"># 直接使用模块中的方法即可</span></span><br></pre></td></tr></table></figure></p>
<h3 id="dir-函数"><a href="#dir-函数" class="headerlink" title="dir()函数"></a>dir()函数</h3><p>返回模块中所有方法。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(module_name)</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="random模块"><a href="#random模块" class="headerlink" title="random模块"></a>random模块</h3><p>random模块主要用于生成随机数，由梅森旋转算法生成的伪随机数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">seed(N)</td>
<td style="text-align:left">初始化给定的随机数种子，默认为当前系统时间</td>
</tr>
<tr>
<td style="text-align:left">random()</td>
<td style="text-align:left">生成一个[0,1)之间的随机小数，与随机数种子有关</td>
</tr>
<tr>
<td style="text-align:left">randint(a,b)</td>
<td style="text-align:left">生成一个[a,b]之间的整数</td>
</tr>
<tr>
<td style="text-align:left">randrange(m,n[,k])</td>
<td style="text-align:left">生成一个[m,n)之间以k为步长的随机整数</td>
</tr>
<tr>
<td style="text-align:left">getrandbits(k)</td>
<td style="text-align:left">生成一个k比特长的随机整数</td>
</tr>
<tr>
<td style="text-align:left">uniform(a,b)</td>
<td style="text-align:left">生成一个[a,b]之间的随机小数</td>
</tr>
<tr>
<td style="text-align:left">choice(list)</td>
<td style="text-align:left">从序列中随机选择一个元素</td>
</tr>
<tr>
<td style="text-align:left">shuffle(list)</td>
<td style="text-align:left">将序列seq中元素随机排列,返回打乱后的序列</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="time模块"><a href="#time模块" class="headerlink" title="time模块"></a>time模块</h3><hr>
<h3 id="jieba模块"><a href="#jieba模块" class="headerlink" title="jieba模块"></a>jieba模块</h3><hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/07/Python学习笔记——常用模块/" data-id="cjt2oa22z000gz0utikjqfway" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BOM/">BOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Html-Css/">Html/Css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/">Node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后端/">后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小程序/">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器兼容/">浏览器兼容</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移动端/">移动端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件配置/">软件配置</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 18.33px;">Android</a> <a href="/tags/BOM/" style="font-size: 10px;">BOM</a> <a href="/tags/DOM/" style="font-size: 10px;">DOM</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Html-Css/" style="font-size: 11.67px;">Html/Css</a> <a href="/tags/JavaScript/" style="font-size: 13.33px;">JavaScript</a> <a href="/tags/Node/" style="font-size: 10px;">Node</a> <a href="/tags/Python/" style="font-size: 16.67px;">Python</a> <a href="/tags/blog/" style="font-size: 11.67px;">blog</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/tool/" style="font-size: 10px;">tool</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/后端/" style="font-size: 10px;">后端</a> <a href="/tags/小程序/" style="font-size: 10px;">小程序</a> <a href="/tags/浏览器兼容/" style="font-size: 10px;">浏览器兼容</a> <a href="/tags/移动端/" style="font-size: 20px;">移动端</a> <a href="/tags/软件配置/" style="font-size: 10px;">软件配置</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/10/软件配置/">软件配置</a>
          </li>
        
          <li>
            <a href="/2019/03/04/移动应用开发——Cordova/">移动应用开发——Cordova</a>
          </li>
        
          <li>
            <a href="/2019/03/02/后端基础——Nodejs/">后端基础——Node.js</a>
          </li>
        
          <li>
            <a href="/2019/02/16/前端-JavaScript基础-jQuery基础/">前端-JavaScript基础-jQuery基础</a>
          </li>
        
          <li>
            <a href="/2019/02/13/前端-ECharts/">前端-ECharts</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Ai Junhao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>