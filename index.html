<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hello, I&#39;m Junhao Ai.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hello, I&#39;m Junhao Ai.">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hello, I&#39;m Junhao Ai.">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hello, I&#39;m Junhao Ai.">
  
    <link rel="alternate" href="/atom.xml" title="Hello, I&#39;m Junhao Ai." type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hello, I&#39;m Junhao Ai.</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-后端基础——npm常见包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/19/后端基础——npm常见包/" class="article-date">
  <time datetime="2019-03-19T13:20:46.000Z" itemprop="datePublished">2019-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/19/后端基础——npm常见包/">后端基础——npm常见包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#npm-基础">npm 基础</a><ul>
<li><a href="#项目初始化">项目初始化</a></li>
<li><a href="#下载模块包">下载模块包</a></li>
<li><a href="#其他常用命令">其他常用命令</a></li>
<li><a href="#npm-被墙问题">npm 被墙问题</a></li>
</ul>
</li>
<li><a href="#常用包使用">常用包使用</a><ul>
<li><a href="#json-server">json-server</a></li>
<li><a href="#http-server">http-server</a></li>
<li><a href="#art-template">art-template</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="npm-基础"><a href="#npm-基础" class="headerlink" title="npm 基础"></a>npm 基础</h2><p>NPM（node package manager），是基于Node.js开发的包管理器。是世界上最大的开源库生态系统。</p>
<p>中文文档： <a href="https://www.npmjs.cn/" target="_blank" rel="noopener">https://www.npmjs.cn/</a><br>官网： <a href="https://www.npmjs.com/" target="_blank" rel="noopener">https://www.npmjs.com/</a></p>
<p>一些常用的包都可以在官网查找。</p>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><p><code>package.json</code> 包描述文件，这个文件会记录我们的项目信息，比如需要的项目依赖、版本号之类，非常重要，访问项目文件被误删导致无法挽回的后果。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 命令，有向导</span><br><span class="line">npm init</span><br><span class="line"></span><br><span class="line">// 跳过向导，快速创建，所有选项默认</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<p>执行这个命令之后，如果没有 <code>package.json</code> 包描述文件，就会新建；如果已经有了，当 <code>node_modules</code> 依赖丢失时，会根据 <code>package.json</code> 中的 <code>dependencies</code> 字段重新下载依赖。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">/** </span><br><span class="line"> * 如下为新建包描述文件（初始化项目）全过程</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">// 输入命令，通过命令向导创建</span><br><span class="line"><span class="function">F:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;<span class="title">npm</span> <span class="title">init</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 自动输出内容</span></span><br><span class="line"><span class="function"><span class="title">This</span> <span class="title">utility</span> <span class="title">will</span> <span class="title">walk</span> <span class="title">you</span> <span class="title">through</span> <span class="title">creating</span> <span class="title">a</span> <span class="title">package.json</span> <span class="title">file</span>.</span></span><br><span class="line"><span class="function"><span class="title">It</span> <span class="title">only</span> <span class="title">covers</span> <span class="title">the</span> <span class="title">most</span> <span class="title">common</span> <span class="title">items</span>, <span class="title">and</span> <span class="title">tries</span> <span class="title">to</span> <span class="title">guess</span> <span class="title">sensible</span> <span class="title">defaults</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">See</span> `<span class="title">npm</span> <span class="title">help</span> <span class="title">json</span>` <span class="title">for</span> <span class="title">definitive</span> <span class="title">documentation</span> <span class="title">on</span> <span class="title">these</span> <span class="title">fields</span></span></span><br><span class="line"><span class="function"><span class="title">and</span> <span class="title">exactly</span> <span class="title">what</span> <span class="title">they</span> <span class="title">do</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Use</span> `<span class="title">npm</span> <span class="title">install</span> &lt;<span class="title">pkg</span>&gt;` <span class="title">afterwards</span> <span class="title">to</span> <span class="title">install</span> <span class="title">a</span> <span class="title">package</span> <span class="title">and</span></span></span><br><span class="line"><span class="function"><span class="title">save</span> <span class="title">it</span> <span class="title">as</span> <span class="title">a</span> <span class="title">dependency</span> <span class="title">in</span> <span class="title">the</span> <span class="title">package.json</span> <span class="title">file</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Press</span> ^<span class="title">C</span> <span class="title">at</span> <span class="title">any</span> <span class="title">time</span> <span class="title">to</span> <span class="title">quit</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">/**</span></span><br><span class="line"><span class="function"> * 问答式填写项目内容，可以不填，回车直接跳过</span></span><br><span class="line"><span class="function"> */</span></span><br><span class="line"><span class="function">// 包名，默认是我们已经通过 <span class="title">cd</span> 命令进入的文件夹</span></span><br><span class="line"><span class="function"><span class="title">package</span> <span class="title">name</span>: (<span class="title">nodejs</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 版本号，默认为(1.0.0)，我们填写一个较低的版本(0.0.1)</span></span><br><span class="line"><span class="function"><span class="title">version</span>: (1.0.0) 0.0.1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 项目描述，手动输入</span></span><br><span class="line"><span class="function"><span class="title">description</span>: 这是一个学习项目</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 入口文件，默认是 <span class="title">index.js</span>，我们可以自定义</span></span><br><span class="line"><span class="function"><span class="title">entry</span> <span class="title">point</span>: (<span class="title">index.js</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 测试命令</span></span><br><span class="line"><span class="function"><span class="title">test</span> <span class="title">command</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="title">git</span> 仓库地址</span></span><br><span class="line"><span class="function"><span class="title">git</span> <span class="title">repository</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 关键字，如果想自己的项目通过 <span class="title">npm</span> 被别人下载，就可以填写关键字，供别人下载</span></span><br><span class="line"><span class="function"><span class="title">keywords</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 作者</span></span><br><span class="line"><span class="function"><span class="title">author</span>: <span class="title">AiJunhao</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 软件开源许可证</span></span><br><span class="line"><span class="function"><span class="title">license</span>: (<span class="title">ISC</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 生成的包描述文件内容</span></span><br><span class="line"><span class="function"><span class="title">About</span> <span class="title">to</span> <span class="title">write</span> <span class="title">to</span> <span class="title">F</span>:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>\<span class="title">package.json</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#123;</span></span><br><span class="line"><span class="function">  "<span class="title">name</span>": "<span class="title">nodejs</span>",</span></span><br><span class="line"><span class="function">  "<span class="title">version</span>": "0.0.1",</span></span><br><span class="line"><span class="function">  "<span class="title">description</span>": "这是一个学习项目",</span></span><br><span class="line"><span class="function">  "<span class="title">main</span>": "<span class="title">index.js</span>",</span></span><br><span class="line"><span class="function">  "<span class="title">scripts</span>": &#123;</span></span><br><span class="line"><span class="function">    "<span class="title">test</span>": "<span class="title">echo</span> \"<span class="title">Error</span>: <span class="title">no</span> <span class="title">test</span> <span class="title">specified</span>\" &amp;&amp; <span class="title">exit</span> 1"</span></span><br><span class="line"><span class="function">  &#125;,</span></span><br><span class="line"><span class="function">  "<span class="title">author</span>": "<span class="title">AiJunhao</span>",</span></span><br><span class="line"><span class="function">  "<span class="title">license</span>": "<span class="title">ISC</span>"</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 是否同意，输入 <span class="title">yes</span> </span></span><br><span class="line"><span class="function"><span class="title">Is</span> <span class="title">this</span> <span class="title">OK</span>? (<span class="title">yes</span>) <span class="title">yes</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">F</span>:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时在项目根目录就创建了 <code>package.json</code> 文件。</p>
<h3 id="下载模块包"><a href="#下载模块包" class="headerlink" title="下载模块包"></a>下载模块包</h3><p>使用 npm 下载的包，放在同级目录下的 “node_modules” 文件夹下。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 语法</span><br><span class="line">npm install 模块关键字 --save</span><br><span class="line"></span><br><span class="line">或者简写：npm i 模块关键字 --save</span><br><span class="line">或者简写：npm i 模块关键字 -S</span><br><span class="line"></span><br><span class="line">// --save：表示将这个下载记录到 package.js 的 dependencies 中。如果不写，则不保存。</span><br></pre></td></tr></table></figure>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 输入mingl</span><br><span class="line"><span class="function">F:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;<span class="title">npm</span> <span class="title">install</span> <span class="title">art</span>-<span class="title">template</span> --<span class="title">save</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 会有一些 <span class="title">WARN</span> ，不用管它</span></span><br><span class="line"><span class="function"><span class="title">npm</span> <span class="title">notice</span> <span class="title">created</span> <span class="title">a</span> <span class="title">lockfile</span> <span class="title">as</span> <span class="title">package</span>-<span class="title">lock.json</span>. <span class="title">You</span> <span class="title">should</span> <span class="title">commit</span> <span class="title">this</span> <span class="title">file</span>.</span></span><br><span class="line"><span class="function"><span class="title">npm</span> <span class="title">WARN</span> <span class="title">nodejs</span>@0.0.1 <span class="title">No</span> <span class="title">repository</span> <span class="title">field</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 表示包已经添加</span></span><br><span class="line"><span class="function">+ <span class="title">art</span>-<span class="title">template</span>@4.13.2</span></span><br><span class="line"><span class="function"><span class="title">added</span> 32 <span class="title">packages</span> <span class="title">from</span> 133 <span class="title">contributors</span> <span class="title">and</span> <span class="title">audited</span> 40 <span class="title">packages</span> <span class="title">in</span> 6.025<span class="title">s</span></span></span><br><span class="line"><span class="function"><span class="title">found</span> 0 <span class="title">vulnerabilities</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">F</span>:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时看项目文件夹，就会有 node_modules 文件夹被新建，里面放了所有一级、二级……依赖文件；<code>package.json</code> 文件中会添加 <code>dependencies</code> 字段，记录这次添加的依赖包。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"nodejs"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"这是一个学习项目"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"AiJunhao"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"art-template"</span>: <span class="string">"^4.13.2"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h3><ul>
<li><p>删除包</p>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm unistall 包名       // 只删除，不会删除依赖项中的内容</span><br><span class="line"></span><br><span class="line">简写: npm un 包名</span><br></pre></td></tr></table></figure>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm unistall 包名 --save       // 删除包并删除依赖项中的内容</span><br><span class="line"></span><br><span class="line">简写: npm un 包名 -S</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看使用帮助</p>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm --<span class="built_in">help</span>      // 查看所有使用帮助</span><br><span class="line"></span><br><span class="line">npm 命令 --<span class="built_in">help</span>     // 查看该命令的具体使用方法</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="npm-被墙问题"><a href="#npm-被墙问题" class="headerlink" title="npm 被墙问题"></a>npm 被墙问题</h3><p>npm 存储包文件的服务器在国外，有时候会被墙，这时候可以使用淘宝镜像 cnpm。</p>
<p><a href="http://npm.taobao.org/" target="_blank" rel="noopener">http://npm.taobao.org/</a> 淘宝的开发团队把 npm 在国内做了一个备份。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 安装淘宝的 cnpm</span><br><span class="line">npm install --global cnpm</span><br><span class="line"></span><br><span class="line">// 然后将正常的 npm 命令中 npm 改成 cnpm 即可</span><br><span class="line">npm install jquery</span><br><span class="line">变成：cpm install jquery</span><br></pre></td></tr></table></figure>
<p>如果不想安装 cnpm 又想使用淘宝镜像下载：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery --registry=https://registry.npm.taoba.org</span><br></pre></td></tr></table></figure>
<p>但是这样比较麻烦，可以将这个选项加入配置文件中：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 配置</span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">// 查看配置</span><br><span class="line">npm config list</span><br></pre></td></tr></table></figure>
<p>配置之后，之后所有的下载都是从淘宝镜像下载的。</p>
<hr>
<h2 id="常用包使用"><a href="#常用包使用" class="headerlink" title="常用包使用"></a>常用包使用</h2><p>在开发中，有很多包对我们的测试和开发非常有用，这里做一个积累。</p>
<h3 id="json-server"><a href="#json-server" class="headerlink" title="json-server"></a>json-server</h3><p>视频教程：<a href="https://egghead.io/lessons/javascript-creating-demo-apis-with-json-server" target="_blank" rel="noopener">https://egghead.io/lessons/javascript-creating-demo-apis-with-json-server</a></p>
<p>git教程：<a href="https://github.com/typicode/json-server" target="_blank" rel="noopener">https://github.com/typicode/json-server</a></p>
<p>在开发中很多时候我们并不想使用简单的静态数据，而是希望自己起一个本地的mock-server来完全模拟请求以及请求回来的过程。json-server是一个很好的可以替我们完成这一工作的工具。我们只需要提供一个json文件，或者写几行简单的js脚本就可以模拟出 <code>RESTful API</code> 的接口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> npm install -g json-server</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看版本号</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> json-server -v</span></span><br></pre></td></tr></table></figure>
<p>安装之后创建一个 <code>json</code> 文件，用来模拟提供接口数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// data.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"users"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">            <span class="attr">"age"</span>: <span class="number">28</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">            <span class="attr">"age"</span>: <span class="number">28</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"username"</span>: <span class="string">"admin"</span>,</span><br><span class="line">            <span class="attr">"age"</span>: <span class="number">28</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后就是在 <code>json</code> 文件目录下启动服务了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动服务命令，实时监测 data.json 的变化</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> json-server --watch data.json</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务命令，不监测变化，data.json 文件内容变化后不重启服务接口内容不变</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> json-server data.json</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">f:\WorkSpace\nodejs\05&gt;json-server --watch data.json</span><br><span class="line"></span><br><span class="line">  \&#123;^_^&#125;/ hi!</span><br><span class="line"></span><br><span class="line">  Loading data.json</span><br><span class="line">  Done</span><br><span class="line"></span><br><span class="line">  Resources</span><br><span class="line">  http://localhost:3000/users</span><br><span class="line"></span><br><span class="line">  Home</span><br><span class="line">  http://localhost:3000</span><br><span class="line"></span><br><span class="line">  Type s + enter at any time to create a snapshot of the database</span><br><span class="line">  Watching...</span><br><span class="line"></span><br><span class="line">GET /db 200 2.483 ms - 608</span><br><span class="line">GET /__rules 404 8.024 ms - 2</span><br></pre></td></tr></table></figure>
<p>然后浏览器访问 <a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a> 可以查看我们的主页，此时基本满足所有 API 操作。</p>
<p><img src="/2019/03/19/后端基础——npm常见包/json-server.jpg" alt="json-server.jpg"></p>
<h3 id="http-server"><a href="#http-server" class="headerlink" title="http-server"></a>http-server</h3><h3 id="art-template"><a href="#art-template" class="headerlink" title="art-template"></a>art-template</h3><p>模板引擎</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/19/后端基础——npm常见包/" data-id="cjtg2fv6x0017o4utl9rdp8te" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node/">Node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后端/">后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-前端-JavaScript基础-EcamScript6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/18/前端-JavaScript基础-EcamScript6/" class="article-date">
  <time datetime="2019-03-18T08:59:13.000Z" itemprop="datePublished">2019-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/18/前端-JavaScript基础-EcamScript6/">前端-JavaScript基础-EcamScript6</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#ecamscript-6-简介">EcamScript 6 简介</a></li>
<li><a href="#声明与表达式">声明与表达式</a></li>
<li><a href="#内置对象">内置对象</a></li>
<li><a href="#运算符与语句">运算符与语句</a></li>
<li><a href="#异步操作">异步操作</a><ul>
<li><a href="#promise-对象">Promise 对象</a><ul>
<li><a href="#promise-状态">Promise 状态</a></li>
<li><a href="#then-方法">then() 方法</a></li>
<li><a href="#案例nodejs-中-promise-读取文件数据">案例：Node.js 中 Promise 读取文件数据</a></li>
<li><a href="#案例前端请求数据时的-promise">案例：前端请求数据时的 Promise</a></li>
<li><a href="#案例nodejs-调用-mongodb-时的-promise">案例：Node.js 调用 Mongodb 时的 promise</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="EcamScript-6-简介"><a href="#EcamScript-6-简介" class="headerlink" title="EcamScript 6 简介"></a>EcamScript 6 简介</h2><hr>
<h2 id="声明与表达式"><a href="#声明与表达式" class="headerlink" title="声明与表达式"></a>声明与表达式</h2><hr>
<h2 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h2><hr>
<h2 id="运算符与语句"><a href="#运算符与语句" class="headerlink" title="运算符与语句"></a>运算符与语句</h2><hr>
<h2 id="异步操作"><a href="#异步操作" class="headerlink" title="异步操作"></a>异步操作</h2><h3 id="Promise-对象"><a href="#Promise-对象" class="headerlink" title="Promise 对象"></a>Promise 对象</h3><p><code>Promise</code> 对象用于解决异步操作的回调地狱（函数作为参数层层嵌套）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 虽然解决了异步操作的先后顺序，单数出现了回调地域</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./a.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line"></span><br><span class="line">  fs.readFile(<span class="string">'./b.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line"></span><br><span class="line">    fs.readFile(<span class="string">'./c.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Promise-状态"><a href="#Promise-状态" class="headerlink" title="Promise 状态"></a>Promise 状态</h4><p><code>Promise</code> 异步操作有三种状态：<code>pending（进行中）</code>、 <code>resolved（已定型） /fulfilled（已成功）</code> 和  <code>rejected（已失败）</code>。</p>
<p><code>Promise</code>对象只有：从 <code>pending</code> 变为 <code>Resolved</code> 和从 <code>pending</code> 变为 <code>rejected</code> 的状态改变。只要处于 <code>resolved</code> 和 <code>rejected</code> ，状态就不会再变了。</p>
<p><img src="/2019/03/18/前端-JavaScript基础-EcamScript6/Promise.jpg" alt="Promise.jpg"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promise 对象的使用</span></span><br><span class="line"><span class="keyword">var</span> myPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">  异步操作方法(xxx, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 承诺任务失败，Pending 状态变成 Rejected</span></span><br><span class="line">      reject(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 承诺任务完成，Pending 状态变成 Resolve</span></span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>Promise</code> 对象一旦新建就会被执行，中途无法被取消。</p>
<h4 id="then-方法"><a href="#then-方法" class="headerlink" title="then() 方法"></a>then() 方法</h4><p><code>then()</code> 方法接收两个回调函数作为参数，两个函数只会有一个被调用。</p>
<ul>
<li><p>第一个参数是 <code>Promise</code> 执行成功 <code>Resolve</code> 状态时的回调。</p>
</li>
<li><p>第二个参数是 <code>Promise</code> 执行失败 <code>Reject</code> 状态时的回调。</p>
</li>
</ul>
<p><code>then()</code> 方法会在异步操作完成之后执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单个异步操作</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myPromise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">  fs.readFile(<span class="string">'./a.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 承诺任务失败，Pending 状态变成 Rejected</span></span><br><span class="line">      reject(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 承诺任务完成，Pending 状态变成 Resolve</span></span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">myPromise.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'文件读取失败，错误对象：'</span>, err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>then()</code> 方法可以链式调用，每个 <code>then()</code> 方法的一个回调函数中 <code>return</code> 下一个要执行的异步操作的 <code>Promise</code> 对象，这样第二个异步操作就会在第一个异步操作之后执行，这样就确保了异步操作的执行顺序问题，同时也避免了回调地域问题。</p>
<hr>
<h4 id="案例：Node-js-中-Promise-读取文件数据"><a href="#案例：Node-js-中-Promise-读取文件数据" class="headerlink" title="案例：Node.js 中 Promise 读取文件数据"></a>案例：Node.js 中 Promise 读取文件数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Node.js 中多个异步操作依次执行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  fs.readFile(<span class="string">'./a.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 承诺任务失败，Pending 状态变成 Rejected</span></span><br><span class="line">      reject(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 承诺任务完成，Pending 状态变成 Resolve</span></span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  fs.readFile(<span class="string">'./b.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 承诺任务失败，Pending 状态变成 Rejected</span></span><br><span class="line">      reject(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 承诺任务完成，Pending 状态变成 Resolve</span></span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  fs.readFile(<span class="string">'./c.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 承诺任务失败，Pending 状态变成 Rejected</span></span><br><span class="line">      reject(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 承诺任务完成，Pending 状态变成 Resolve</span></span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p1</span><br><span class="line">  .then(</span><br><span class="line">    data =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">      <span class="keyword">return</span> p2</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'文件读取失败，错误对象：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    data =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">      <span class="keyword">return</span> p3</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'文件读取失败，错误对象：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    data =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'文件读取失败，错误对象：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为了简化代码，可以将这个异步操作封装成 API</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pReadFile</span> (<span class="params">filePath</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(filePath, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 承诺任务失败，Pending 状态变成 Rejected</span></span><br><span class="line">        reject(err)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 承诺任务完成，Pending 状态变成 Resolve</span></span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pReadFile(<span class="string">'./a.txt'</span>)</span><br><span class="line">  .then(</span><br><span class="line">    data =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">      <span class="keyword">return</span> pReadFile(<span class="string">'./b.txt'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'文件读取失败，错误对象：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    data =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">      <span class="keyword">return</span> pReadFile(<span class="string">'./c.txt'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'文件读取失败，错误对象：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .then(</span><br><span class="line">    data =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'文件读取失败，错误对象：'</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="案例：前端请求数据时的-Promise"><a href="#案例：前端请求数据时的-Promise" class="headerlink" title="案例：前端请求数据时的 Promise"></a>案例：前端请求数据时的 Promise</h4><p>这里使用 <code>ajax</code> 请求 <code>API</code> 数据时，有时会出现一个页面需要请求多个不同的 <code>API</code>，少则三五个，多则七八个，因彼此间有先后顺序，此时就需要保证异步请求的先后顺序了，<code>jQuery</code> 中已经支持了 <code>Promise</code>。</p>
<p>这个案例需要 <code>API</code> 数据，可以用 <code>json-server</code> 工具来模拟。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"user_form"</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 模板内容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/template"</span> <span class="attr">id</span>=<span class="string">"tpl"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; user.username &#125;&#125;"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; user.age &#125;&#125;"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>职业<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">""</span>&gt;</span></span></span><br><span class="line"><span class="undefined">                    &#123;&#123; each jobs&#125;&#125;</span></span><br><span class="line"><span class="javascript">                        &#123;&#123; <span class="keyword">if</span> user.jobId === $value.id&#125;&#125;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; $value.id &#125;&#125;"</span> <span class="attr">selected</span>&gt;</span>&#123;&#123; $value.name &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="javascript">                        &#123;&#123; <span class="keyword">else</span> &#125;&#125;</span></span><br><span class="line"><span class="xml">                            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; $value.id &#125;&#125;"</span>&gt;</span>&#123;&#123; $value.name &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="javascript">                        &#123;&#123; /<span class="keyword">if</span> &#125;&#125;</span></span><br><span class="line"><span class="undefined">                    &#123;&#123; /each &#125;&#125;</span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引用模板 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/art-template/lib/template-web.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引用 jQuery --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/jquery/dist/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 模板渲染 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">            /**</span></span><br><span class="line"><span class="undefined">             *  未用 promise</span></span><br><span class="line"><span class="undefined">             */</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> data = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">            promiseGet(<span class="string">"http://127.0.0.1:3000/users/4"</span>)</span></span><br><span class="line"><span class="javascript">                .then(<span class="function"><span class="params">userData</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="undefined">                    data.user = userData</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> promiseGet(<span class="string">"http://127.0.0.1:3000/jobs"</span>)</span></span><br><span class="line"><span class="undefined">                &#125;)</span></span><br><span class="line"><span class="javascript">                .then(<span class="function"><span class="params">jobsData</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="undefined">                    data.jobs = jobsData</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(data)</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> htmlStr = template(<span class="string">"tpl"</span>, data)</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">document</span>.querySelector(<span class="string">"#user_form"</span>).innerHTML = htmlStr</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">            /**</span></span><br><span class="line"><span class="undefined">             *  使用 promise 的 jQuery</span></span><br><span class="line"><span class="undefined">             */</span></span><br><span class="line"><span class="javascript">            <span class="comment">// var data = &#123;&#125;;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// // userData，jobsData 返回时就是对象了</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// $.get("http://127.0.0.1:3000/users/4")</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     .then(userData =&gt; &#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//         data.user = userData</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//         return $.get("http://127.0.0.1:3000/jobs")</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     &#125;)</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     .then(jobsData =&gt; &#123;</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//         data.jobs = jobsData</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">            <span class="comment">//         var htmlStr = template("tpl", data)</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//         document.querySelector("#user_form").innerHTML = htmlStr</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//     &#125;)</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">            /**</span></span><br><span class="line"><span class="undefined">             * 封装 ajax 获取网络请求的 promise 方法，可以再写个callback，就可以支持多重形式</span></span><br><span class="line"><span class="undefined">             **/</span></span><br><span class="line"><span class="javascript">            <span class="function"><span class="keyword">function</span> <span class="title">promiseGet</span>(<span class="params">url</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">                    <span class="comment">// 当请求加载成功之后要调用的函数</span></span></span><br><span class="line"><span class="javascript">                    oReq.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                        resolve(<span class="built_in">JSON</span>.parse(oReq.responseText));</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">// 当请求加载失败之后要调用的函数</span></span></span><br><span class="line"><span class="javascript">                    oReq.onerror = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="undefined">                        reject(err);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="javascript">                    oReq.open(<span class="string">"get"</span>, url, <span class="literal">true</span>);</span></span><br><span class="line"><span class="undefined">                    oReq.send();</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// data.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"users"</span>:[</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">1</span>,<span class="attr">"username"</span>:<span class="string">"admin"</span>,<span class="attr">"age"</span>:<span class="number">28</span>,<span class="attr">"jobId"</span>:<span class="number">3</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">2</span>,<span class="attr">"username"</span>:<span class="string">"admin"</span>,<span class="attr">"age"</span>:<span class="number">28</span>,<span class="attr">"jobId"</span>:<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">3</span>,<span class="attr">"username"</span>:<span class="string">"admin"</span>,<span class="attr">"age"</span>:<span class="number">28</span>,<span class="attr">"jobId"</span>:<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">4</span>,<span class="attr">"username"</span>:<span class="string">"admin"</span>,<span class="attr">"age"</span>:<span class="number">28</span>,<span class="attr">"jobId"</span>:<span class="number">5</span>&#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"jobs"</span>:[</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">1</span>,<span class="attr">"name"</span>:<span class="string">"学生"</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">2</span>,<span class="attr">"name"</span>:<span class="string">"老师"</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">3</span>,<span class="attr">"name"</span>:<span class="string">"司机"</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">4</span>,<span class="attr">"name"</span>:<span class="string">"画家"</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">5</span>,<span class="attr">"name"</span>:<span class="string">"演员"</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">"id"</span>:<span class="number">6</span>,<span class="attr">"name"</span>:<span class="string">"电竞"</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="案例：Node-js-调用-Mongodb-时的-promise"><a href="#案例：Node-js-调用-Mongodb-时的-promise" class="headerlink" title="案例：Node.js 调用 Mongodb 时的 promise"></a>案例：Node.js 调用 Mongodb 时的 promise</h4><p><code>mongodb</code> 所有 <code>API</code> 都支持 <code>promise</code>。</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/18/前端-JavaScript基础-EcamScript6/" data-id="cjtg2fvlo002to4utnio12d3b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/EcamScript6/">EcamScript6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-数据库——MySQL" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/15/数据库——MySQL/" class="article-date">
  <time datetime="2019-03-15T09:35:10.000Z" itemprop="datePublished">2019-03-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/15/数据库——MySQL/">数据库——MySQL</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#mysql-简介">MySQL 简介</a></li>
<li><a href="#mysql-安装">MySQL 安装</a><ul>
<li><a href="#zip-压缩版">ZIP 压缩版</a></li>
<li><a href="#msi-安装包安装">MSI 安装包安装</a></li>
<li><a href="#第三方可视化工具-patchnavicat">第三方可视化工具 PatchNavicat</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="MySQL-简介"><a href="#MySQL-简介" class="headerlink" title="MySQL 简介"></a>MySQL 简介</h2><p>关系型数据库</p>
<h2 id="MySQL-安装"><a href="#MySQL-安装" class="headerlink" title="MySQL 安装"></a>MySQL 安装</h2><p><a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a></p>
<h3 id="ZIP-压缩版"><a href="#ZIP-压缩版" class="headerlink" title="ZIP 压缩版"></a>ZIP 压缩版</h3><p><img src="/2019/03/15/数据库——MySQL/download.png" alt="download.png"></p>
<p><img src="/2019/03/15/数据库——MySQL/download2.png" alt="download2.png"></p>
<p>详细配置见菜鸟联盟：<a href="http://www.runoob.com/mysql/mysql-install.html" target="_blank" rel="noopener">http://www.runoob.com/mysql/mysql-install.html</a></p>
<h3 id="MSI-安装包安装"><a href="#MSI-安装包安装" class="headerlink" title="MSI 安装包安装"></a>MSI 安装包安装</h3><p>见收藏的百度云视频：</p>
<p>链接：<a href="https://pan.baidu.com/s/1dBn2UqrIvR-5ebJQZ_lOmg" target="_blank" rel="noopener">https://pan.baidu.com/s/1dBn2UqrIvR-5ebJQZ_lOmg</a><br>提取码：d041<br>复制这段内容后打开百度网盘手机App，操作更方便哦</p>
<h3 id="第三方可视化工具-PatchNavicat"><a href="#第三方可视化工具-PatchNavicat" class="headerlink" title="第三方可视化工具 PatchNavicat"></a>第三方可视化工具 PatchNavicat</h3><p>见收藏的百度云视频：</p>
<p>链接：<a href="https://pan.baidu.com/s/1dBn2UqrIvR-5ebJQZ_lOmg" target="_blank" rel="noopener">https://pan.baidu.com/s/1dBn2UqrIvR-5ebJQZ_lOmg</a><br>提取码：d041<br>复制这段内容后打开百度网盘手机App，操作更方便哦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/15/数据库——MySQL/" data-id="cjtg2fv6z0019o4utp1jm7qdm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-数据库——MongoDB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/15/数据库——MongoDB/" class="article-date">
  <time datetime="2019-03-15T09:29:23.000Z" itemprop="datePublished">2019-03-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/15/数据库——MongoDB/">数据库——MongoDB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#mongodb-介绍">MongoDB 介绍</a><ul>
<li><a href="#关系型数据库和非关系型数据库">关系型数据库和非关系型数据库</a><ul>
<li><a href="#关系型数据库特点">关系型数据库特点</a></li>
<li><a href="#非关系型数据库">非关系型数据库</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mongodb-下载及安装">MongoDB 下载及安装</a><ul>
<li><a href="#下载">下载</a></li>
<li><a href="#安装">安装</a></li>
<li><a href="#配置环境变量">配置环境变量</a></li>
<li><a href="#新建数据目录">新建数据目录</a><ul>
<li><a href="#修改默认数据目录">修改默认数据目录</a></li>
</ul>
</li>
<li><a href="#连接数据库">连接数据库</a></li>
</ul>
</li>
<li><a href="#mongodb-查">MongoDB 查</a><ul>
<li><a href="#查看所有数据库">查看所有数据库</a></li>
<li><a href="#查看当前所在的数据库">查看当前所在的数据库</a></li>
<li><a href="#查询文档">查询文档</a><ul>
<li><a href="#查询所有">查询所有</a></li>
<li><a href="#单文档查询">单文档查询</a></li>
<li><a href="#格式化显示">格式化显示</a></li>
<li><a href="#条件查询语句">条件查询语句</a></li>
<li><a href="#and-条件">AND 条件</a></li>
<li><a href="#or-条件">OR 条件</a></li>
<li><a href="#type-操作符"><code>$type</code> 操作符</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mongodb-增">MongoDB 增</a><ul>
<li><a href="#创建切换数据库">创建/切换数据库</a></li>
<li><a href="#创建集合">创建集合</a><ul>
<li><a href="#主动创建集合">主动创建集合</a></li>
<li><a href="#创建集合并插入数据">创建集合并插入数据</a></li>
</ul>
</li>
<li><a href="#插入数据文档">插入数据文档</a></li>
</ul>
</li>
<li><a href="#mongodb-删">MongoDB 删</a><ul>
<li><a href="#删除数据库">删除数据库</a></li>
<li><a href="#删除集合">删除集合</a></li>
<li><a href="#删除文档">删除文档</a></li>
</ul>
</li>
<li><a href="#mongodb-改">MongoDB 改</a><ul>
<li><a href="#update">update()</a></li>
<li><a href="#save-方法">save() 方法</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="MongoDB-介绍"><a href="#MongoDB-介绍" class="headerlink" title="MongoDB 介绍"></a>MongoDB 介绍</h2><p>菜鸟联盟：<a href="http://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/mongodb/mongodb-tutorial.html</a></p>
<h3 id="关系型数据库和非关系型数据库"><a href="#关系型数据库和非关系型数据库" class="headerlink" title="关系型数据库和非关系型数据库"></a>关系型数据库和非关系型数据库</h3><p>所谓的关系型，表就是关系，就是表与表之间存在关系。</p>
<h4 id="关系型数据库特点"><a href="#关系型数据库特点" class="headerlink" title="关系型数据库特点"></a>关系型数据库特点</h4><p>关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织。</p>
<p>优点：</p>
<ul>
<li>易于维护：都是使用表结构，格式一致；</li>
<li>使用方便：SQL语言通用，可用于复杂查询；</li>
<li>复杂操作：支持SQL，可用于一个表以及多个表之间非常复杂的查询。</li>
</ul>
<p>缺点：</p>
<ul>
<li><p>读写性能比较差，尤其是海量数据的高效率读写；</p>
</li>
<li><p>固定的表结构，灵活度稍欠；</p>
</li>
<li><p>高并发读写需求，传统关系型数据库来说，硬盘I/O是一个很大的瓶颈。</p>
</li>
</ul>
<p>常用数据库：</p>
<p>MariaDB/SQL Server/MySQL/SQLite/ORACLE/PostgreSQL</p>
<h4 id="非关系型数据库"><a href="#非关系型数据库" class="headerlink" title="非关系型数据库"></a>非关系型数据库</h4><p>非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合，可以是文档或者键值对等。</p>
<p>优点：</p>
<ul>
<li>格式灵活：存储数据的格式可以是key,value形式、文档形式、图片形式等等，文档形式、图片形式等等，使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。</li>
<li>速度快：nosql可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘；</li>
<li>高扩展性；</li>
<li>成本低：nosql数据库部署简单，基本都是开源软件。</li>
</ul>
<p>缺点：</p>
<ul>
<li>不提供sql支持，学习和使用成本较高；</li>
<li>无事务处理；</li>
<li>数据结构相对复杂，复杂查询方面稍欠。</li>
</ul>
<p>非关系型数据库的分类和比较：</p>
<ul>
<li>文档型</li>
<li>key-value型</li>
<li>列式数据库</li>
<li>图形数据库</li>
</ul>
<p>常用数据库：</p>
<p>mongoDB/HBASE/redis/Cassandra/CouchDB/Neo4j</p>
<hr>
<h2 id="MongoDB-下载及安装"><a href="#MongoDB-下载及安装" class="headerlink" title="MongoDB 下载及安装"></a>MongoDB 下载及安装</h2><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网：<a href="https://www.mongodb.com/" target="_blank" rel="noopener">https://www.mongodb.com/</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>下载安装即可，直到最后一步需要下载安装 <code>MongoDB Compass</code> 可视化界面，哪里将左下角的√取消掉就好。这个下载太慢！！！可视化界面我们自己装。</p>
<p><img src="/2019/03/15/数据库——MongoDB/注意点.jpg" alt="注意点.jpg"></p>
<h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><p>配置环境变量：将安装目录下的 <code>bin</code> 目录添加到用户变量。</p>
<p>然后使用<font color="red">管理员身份</font>进入命令行输入 <code>mongod -v</code> 查看版本，有用即可。</p>
<p><img src="/2019/03/15/数据库——MongoDB/cmd.jpg" alt="cmd.jpg"></p>
<h3 id="新建数据目录"><a href="#新建数据目录" class="headerlink" title="新建数据目录"></a>新建数据目录</h3><p>由于第一次执行需要一个数据库文件目录，默认是 <code>C:/data/db</code> 如果没有这个目录，会执行失败，如下图所示：</p>
<p><img src="/2019/03/15/数据库——MongoDB/第一次执行.jpg" alt="第一次执行.jpg"></p>
<p>新建完目录之后，再次执行，如下，数据库服务启动完成，窗口不能关闭，<code>CTRL + C</code> 退出：</p>
<p><img src="/2019/03/15/数据库——MongoDB/第二次执行.jpg" alt="第二次执行.jpg"></p>
<h4 id="修改默认数据目录"><a href="#修改默认数据目录" class="headerlink" title="修改默认数据目录"></a>修改默认数据目录</h4><p>如果不想放在 C 盘，可以通过命令修改：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath xxx:\data\db</span><br></pre></td></tr></table></figure>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>首先使用<font color="red">管理员身份</font>进入命令行输入 <code>mongod</code> 打开服务。</p>
<p>通过如下网址：<a href="http://127.0.0.1:27017/" target="_blank" rel="noopener">http://127.0.0.1:27017/</a> 访问。如果网页内容显示 <code>‘It looks like you are trying to access MongoDB over HTTP on the native driver port.’</code>，表示数据库服务已打开。</p>
<p>然后再使用<font color="red">管理员身份</font>进入命令行输入 <code>mongo</code> 连接数据库，注意原先打开服务的命令窗口不能关闭。</p>
<p>如下，即可：</p>
<p><img src="/2019/03/15/数据库——MongoDB/连接数据库.jpg" alt="连接数据库.jpg"></p>
<hr>
<h2 id="MongoDB-查"><a href="#MongoDB-查" class="headerlink" title="MongoDB 查"></a>MongoDB 查</h2><h3 id="查看所有数据库"><a href="#查看所有数据库" class="headerlink" title="查看所有数据库"></a>查看所有数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br></pre></td></tr></table></figure>
<p>这些是系统自带的数据库，最好不要动。</p>
<p>MongoDB 中默认的数据库为 test，如果你没有创建新的数据库，集合将存放在 test 数据库中，但是由于初始没数据，不显示。</p>
<h3 id="查看当前所在的数据库"><a href="#查看当前所在的数据库" class="headerlink" title="查看当前所在的数据库"></a>查看当前所在的数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db</span></span><br><span class="line">mydbs</span><br></pre></td></tr></table></figure>
<h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h3><h4 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h4><p><code>find()</code> 方法查询所有匹配文档。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查询文档</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.collection.find(query, projection)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>query ：可选，使用查询操作符指定查询条件。为空表示查询所有。</p>
</li>
<li><p>projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。</p>
</li>
</ul>
<h4 id="单文档查询"><a href="#单文档查询" class="headerlink" title="单文档查询"></a>单文档查询</h4><p><code>findOne()</code> 方法查询收个匹配文档。可用参数与 <code>find()</code> 方法相同。</p>
<h4 id="格式化显示"><a href="#格式化显示" class="headerlink" title="格式化显示"></a>格式化显示</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查询文档并以格式化数据</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find().pretty()</span></span><br></pre></td></tr></table></figure>
<h4 id="条件查询语句"><a href="#条件查询语句" class="headerlink" title="条件查询语句"></a>条件查询语句</h4><table>
<thead>
<tr>
<th>操作</th>
<th>格式</th>
<th>范例</th>
<th>关系型数据库语句</th>
</tr>
</thead>
<tbody>
<tr>
<td>等于</td>
<td>{&lt;key>:&lt;value>}</td>
<td>db.col.find({“by”:”菜鸟教程”}).pretty()</td>
<td>where by = ‘菜鸟教程’</td>
</tr>
<tr>
<td>小于</td>
<td>{&lt;key>:{$lt:&lt;value>}}</td>
<td>db.col.find({“likes”:{$lt:50}}).pretty()</td>
<td>where likes &lt; 50</td>
</tr>
<tr>
<td>小于或等于</td>
<td>{&lt;key>:{$lte:&lt;value>}}</td>
<td>db.col.find({“likes”:{$lte:50}}).pretty()</td>
<td>where likes &lt;= 50</td>
</tr>
<tr>
<td>大于</td>
<td>{&lt;key>:{$gt:&lt;value>}}</td>
<td>db.col.find({“likes”:{$gt:50}}).pretty()</td>
<td>where likes &gt; 50</td>
</tr>
<tr>
<td>大于或等于</td>
<td>{&lt;key>:{$gte:&lt;value>}}</td>
<td>db.col.find({“likes”:{$gte:50}}).pretty()</td>
<td>where likes &gt;= 50</td>
</tr>
<tr>
<td>不等于</td>
<td>{&lt;key>:{$ne:&lt;value>}}</td>
<td>db.col.find({“likes”:{$ne:50}}).pretty()</td>
<td>where likes != 50</td>
</tr>
</tbody>
</table>
<h4 id="AND-条件"><a href="#AND-条件" class="headerlink" title="AND 条件"></a>AND 条件</h4><p><code>find()</code> 方法可以传入多个键(key)，每个键(key)以逗号隔开，即常规 <code>SQL</code> 的 <code>AND</code> 条件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find(&#123;key1:value1, key2:value2&#125;).pretty()</span></span><br></pre></td></tr></table></figure>
<h4 id="OR-条件"><a href="#OR-条件" class="headerlink" title="OR 条件"></a>OR 条件</h4><p>OR 条件语句使用了关键字 <code>$or</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find(</span></span><br><span class="line">   &#123;</span><br><span class="line">        $or: [</span><br><span class="line">            &#123;key1: value1&#125;, &#123;key2:value2&#125;</span><br><span class="line">        ]</span><br><span class="line">   &#125;</span><br><span class="line">).pretty()</span><br></pre></td></tr></table></figure>
<h4 id="type-操作符"><a href="#type-操作符" class="headerlink" title="$type 操作符"></a><code>$type</code> 操作符</h4><p>检索集合中匹配的数据类型，并返回结果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find(&#123;<span class="string">"键名"</span> : &#123;<span class="variable">$type</span> : 类型字符串/对应的数字标签 &#125;&#125;)</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>类型</th>
<th>数字</th>
<th>类型</th>
<th>数字</th>
</tr>
</thead>
<tbody>
<tr>
<td>Double</td>
<td>1</td>
<td>Regular Expression</td>
<td>11</td>
</tr>
<tr>
<td>String</td>
<td>2</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>Object</td>
<td>3</td>
<td>JavaScript</td>
<td>13</td>
</tr>
<tr>
<td>Array</td>
<td>4</td>
<td>Symbol</td>
<td>14</td>
</tr>
<tr>
<td>Binary data</td>
<td>5</td>
<td>JavaScript (with scope)</td>
<td>15</td>
</tr>
<tr>
<td>Undefined(已废弃)</td>
<td>6</td>
<td>32-bit integer</td>
<td>16</td>
</tr>
<tr>
<td>Object id</td>
<td>7</td>
<td>Timestamp</td>
<td>17</td>
</tr>
<tr>
<td>Boolean</td>
<td>8</td>
<td>64-bit integer</td>
<td>18</td>
</tr>
<tr>
<td>Date</td>
<td>9</td>
<td>Min key</td>
<td>255</td>
</tr>
<tr>
<td>Null</td>
<td>10</td>
<td>Max key</td>
<td>127</td>
</tr>
</tbody>
</table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find()</span></span><br><span class="line">&#123; "_id" : ObjectId("5c8cb31eca4aff6ebfd76983"), "title" : "MongoDB" &#125;</span><br><span class="line">&#123; "_id" : ObjectId("5c8cd26fca4aff6ebfd76984"), "title" : "123", "by" : "asdf" &#125;</span><br><span class="line">&#123; "_id" : ObjectId("5c8cd37cca4aff6ebfd76985"), "title" : 123 &#125;</span><br><span class="line"></span><br><span class="line">// 查询 "title" 数据类型为 'string' 的数据。</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find(&#123;<span class="string">"title"</span>: &#123;<span class="variable">$type</span>: <span class="string">'string'</span>&#125;&#125;)</span></span><br><span class="line">&#123; "_id" : ObjectId("5c8cb31eca4aff6ebfd76983"), "title" : "MongoDB" &#125;</span><br><span class="line">&#123; "_id" : ObjectId("5c8cd26fca4aff6ebfd76984"), "title" : "123", "by" : "asdf" &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="MongoDB-增"><a href="#MongoDB-增" class="headerlink" title="MongoDB 增"></a>MongoDB 增</h2><h3 id="创建-切换数据库"><a href="#创建-切换数据库" class="headerlink" title="创建/切换数据库"></a>创建/切换数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> use mydbs</span></span><br><span class="line">switched to db mydbs</span><br></pre></td></tr></table></figure>
<p>使用 <code>use</code> 创建名为 <code>mydbs</code> 的数据库，如果数据库不存在，则创建数据库，否则切换到指定数据库。</p>
<p>如图，创建 <code>mydbs</code> 数据库，然后查看所有数据库，会发现并没有显示我们刚创建的数据库！！！由于我们创建的数据库里面没有数据，所以不会显示。然后通过 <code>db</code> 命令查看我们所在的数据库，可以发现，我们当前的确创建并切换到了 <code>mydbs</code> 数据库中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> use mydbs</span></span><br><span class="line">switched to db mydbs</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db</span></span><br><span class="line">mydbs</span><br></pre></td></tr></table></figure>
<h3 id="创建集合"><a href="#创建集合" class="headerlink" title="创建集合"></a>创建集合</h3><h4 id="主动创建集合"><a href="#主动创建集合" class="headerlink" title="主动创建集合"></a>主动创建集合</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 主动创建集合语法</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.createCollection(name, options)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 实例</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.createCollection(<span class="string">"test"</span>)</span></span><br><span class="line">&#123; "ok" : 1 &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.createCollection(<span class="string">"mycol"</span>, &#123; capped : <span class="literal">true</span>, autoIndexId : <span class="literal">true</span>, size : </span></span><br><span class="line">   6142800, max : 10000 &#125; )</span><br><span class="line">   </span><br><span class="line">// 查看集合</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show collections</span></span><br><span class="line">test</span><br><span class="line">mycol</span><br></pre></td></tr></table></figure>
<ul>
<li><p>name: 要创建的集合名称</p>
</li>
<li><p>options: 可选参数, 指定有关内存大小及索引的选项</p>
<ul>
<li><p>capped: 布尔值。</p>
<p>  如果为 <code>true</code>，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。当该值为 <code>true</code> 时，必须指定 <code>size</code> 参数。</p>
</li>
<li><p>autoIndexId: 布尔值。</p>
<p>  如为 <code>true</code>，自动在 <code>_id</code> 字段创建索引。默认为 <code>false</code> 。</p>
</li>
<li><p>size: 数值。</p>
<p>  为固定集合指定一个最大值（以字节计）。如果 <code>capped</code> 为 <code>true</code>，也需要指定该字段。</p>
</li>
<li><p>max: 数值。指定固定集合中包含文档的最大数量。</p>
</li>
</ul>
</li>
</ul>
<h4 id="创建集合并插入数据"><a href="#创建集合并插入数据" class="headerlink" title="创建集合并插入数据"></a>创建集合并插入数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 创建集合并插入数据</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.myCol.insert(&#123;<span class="string">"name"</span>: <span class="string">"test"</span>&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="插入数据文档"><a href="#插入数据文档" class="headerlink" title="插入数据文档"></a>插入数据文档</h3><p>MongoDB 使用 insert() 或 save() 方法向集合中插入文档。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 语法</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.COLLECTION_NAME.insert(document)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 插入数据</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.mydbs.insert(&#123;title: <span class="string">'MongoDB'</span>&#125;)</span></span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"></span><br><span class="line">// 查询</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find()</span></span><br><span class="line">&#123; "_id" : ObjectId("5c8cb31eca4aff6ebfd76983"), "title" : "MongoDB" &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="MongoDB-删"><a href="#MongoDB-删" class="headerlink" title="MongoDB 删"></a>MongoDB 删</h2><h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>MongoDB 中删除数据库需要先用 <code>use</code> 切换到需要删除的数据库，然后使用 <code>dropDatabase()</code> 方法删除当前数据库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 切换进需要删除的数据库</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use DatabaseName</span></span><br><span class="line">switched to db DatabaseName</span><br><span class="line"></span><br><span class="line">// 删除当前数据库</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.dropDatabase()</span></span><br><span class="line">&#123; "dropped" : "DatabaseName", "ok" : 1 &#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除集合"><a href="#删除集合" class="headerlink" title="删除集合"></a>删除集合</h3><p>MongoDB 中使用 <code>drop()</code> 方法来删除当前数据库中的集合。如果成功删除选定集合，返回 true，否则返回 false。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 语法</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.collectionName.drop()</span></span><br><span class="line">true        // 成功</span><br><span class="line">false       // 失败</span><br></pre></td></tr></table></figure>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p>MongoDB 中使用 <code>remove()</code> 函数是用来移除集合中的数据。在执行 <code>remove()</code> 函数前先执行 <code>find()</code> 命令来判断执行的条件是否正确，这是一个比较好的习惯。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 语法</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.collection.remove(</span></span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     justOne: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 删除所有文档</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.remove(&#123;&#125;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>query :（可选）删除的文档的条件。</p>
</li>
<li><p>justOne : （可选）如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。</p>
</li>
<li><p>writeConcern :（可选）抛出异常的级别。</p>
</li>
</ul>
<hr>
<h2 id="MongoDB-改"><a href="#MongoDB-改" class="headerlink" title="MongoDB 改"></a>MongoDB 改</h2><p>MongoDB 使用 update() 和 save() 方法来更新集合中的文档。</p>
<h3 id="update"><a href="#update" class="headerlink" title="update()"></a>update()</h3><p>update() 方法用于更新已存在的文档。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 语法</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.collection.update(</span></span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">        upsert: &lt;boolean&gt;,</span><br><span class="line">        multi: &lt;boolean&gt;,</span><br><span class="line">        writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>query : update的查询条件，类似sql update查询内where后面的。</p>
</li>
<li><p>update : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的</p>
</li>
<li><p>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</p>
</li>
<li><p>multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</p>
</li>
<li><p>writeConcern :可选，抛出异常的级别。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 插入数据</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.insert(&#123;title: 123, by:<span class="string">'ai'</span>&#125;)</span></span><br><span class="line">WriteResult(&#123; "nInserted" : 1 &#125;)</span><br><span class="line"></span><br><span class="line">// 查询数据，在内存中存储时，键名都是字符串类型的</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.find()</span></span><br><span class="line">&#123; "_id" : ObjectId("5c8cd26fca4aff6ebfd76984"), "title" : 123, "by" : "ai" &#125;</span><br><span class="line"></span><br><span class="line">// 更新</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.update(&#123; <span class="string">'title'</span>: 123&#125;, &#123;<span class="variable">$set</span>: &#123;<span class="string">'by'</span>: <span class="string">'asdf'</span>&#125;&#125;)</span></span><br><span class="line">WriteResult(&#123; "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="save-方法"><a href="#save-方法" class="headerlink" title="save() 方法"></a>save() 方法</h3><font color="red">save方法有更新和插入两种功能，到底是插入还是更新文档取决于 <code>_id</code> 参数。如果能根据 <code>_id</code> 找到一个已经存在的文档，那么就更新。如果没有传入_id参数或者找不到存在的文档，那么就插入一个新文档。</font>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.collection.save(</span></span><br><span class="line">   &lt;document&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>document : 文档数据。</li>
<li>writeConcern :可选，抛出异常的级别。</li>
</ul>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/15/数据库——MongoDB/" data-id="cjtg2fvmk0035o4utjmqyijm3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MongoDB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/15/MongoDB/" class="article-date">
  <time datetime="2019-03-15T09:27:29.000Z" itemprop="datePublished">2019-03-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/15/MongoDB/">MongoDB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/15/MongoDB/" data-id="cjtg2fv67000bo4utmxqmrldd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-后端基础——GET和POST" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/13/后端基础——GET和POST/" class="article-date">
  <time datetime="2019-03-13T07:58:46.000Z" itemprop="datePublished">2019-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/13/后端基础——GET和POST/">后端基础——GET和POST</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#前言">前言</a></li>
<li><a href="#网络通信">网络通信</a></li>
<li><a href="#get-和-post-本质">GET 和 POST 本质</a></li>
<li><a href="#get-和-post-表象区别">GET 和 POST 表象区别</a></li>
<li><a href="#get">GET</a></li>
<li><a href="#post">POST</a></li>
</ul>
<!-- /TOC -->
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>关于这一部分，面试考点。</p>
<p>参考内容：</p>
<p><a href="http://www.cnblogs.com/logsharing/p/8448446.html" target="_blank" rel="noopener">http://www.cnblogs.com/logsharing/p/8448446.html</a></p>
<p><a href="https://baijiahao.baidu.com/s?id=1620934682611653374&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">https://baijiahao.baidu.com/s?id=1620934682611653374&amp;wfr=spider&amp;for=pc</a></p>
<hr>
<h2 id="网络通信"><a href="#网络通信" class="headerlink" title="网络通信"></a>网络通信</h2><hr>
<h2 id="GET-和-POST-本质"><a href="#GET-和-POST-本质" class="headerlink" title="GET 和 POST 本质"></a>GET 和 POST 本质</h2><p>GET和POST是什么？HTTP协议中的两种发送请求的方法。</p>
<p>HTTP是什么？HTTP是基于TCP/IP的关于数据如何在万维网中如何通信的协议。</p>
<p>HTTP的底层是TCP/IP。所以GET和POST的底层也是TCP/IP，也就是说，GET/POST都是TCP链接。GET和POST能做的事情是一样一样的。你要给GET加上request body，给POST带上url参数，技术上是完全行的通的。</p>
<hr>
<h2 id="GET-和-POST-表象区别"><a href="#GET-和-POST-表象区别" class="headerlink" title="GET 和 POST 表象区别"></a>GET 和 POST 表象区别</h2><ul>
<li><p>GET在浏览器回退时是无害的，而POST会再次提交请求。</p>
</li>
<li><p>GET产生的URL地址可以被Bookmark，而POST不可以。</p>
</li>
<li><p>GET请求会被浏览器主动cache，而POST不会，除非手动设置。</p>
</li>
<li><p>GET请求只能进行url编码，而POST支持多种编码方式。</p>
</li>
<li><p>GET请求参数会被完整保留在浏览器历史记录里，而POST中的参数不会被保留。</p>
</li>
<li><p>GET请求在URL中传送的参数是有长度限制的，而POST么有。</p>
</li>
<li><p>对参数的数据类型，GET只接受ASCII字符，而POST没有限制。</p>
</li>
<li><p>GET比POST更不安全，因为参数直接暴露在URL上，所以不能用来传递敏感信息。</p>
</li>
<li><p>GET参数通过URL传递，POST放在Request body中。</p>
</li>
</ul>
<hr>
<h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><hr>
<h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/13/后端基础——GET和POST/" data-id="cjtg2fv6w0014o4utdwla76q2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后端/">后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-框架——Express" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/11/框架——Express/" class="article-date">
  <time datetime="2019-03-11T13:54:34.000Z" itemprop="datePublished">2019-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/11/框架——Express/">框架——Express</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#express-简介">Express 简介</a></li>
<li><a href="#express-安装及入门">Express 安装及入门</a></li>
<li><a href="#静态服务">静态服务</a></li>
<li><a href="#使用-art-template-模板引擎">使用 art-template 模板引擎</a><ul>
<li><a href="#安装">安装</a></li>
<li><a href="#在-express-中加载-express-art-template-模板">在 Express 中加载 express-art-template 模板</a></li>
<li><a href="#在-express-中使用模板引擎">在 Express 中使用模板引擎</a></li>
</ul>
</li>
<li><a href="#基本路由">基本路由</a><ul>
<li><a href="#get">GET</a></li>
<li><a href="#post">POST</a><ul>
<li><a href="#body-parser-安装">body-parser 安装</a></li>
<li><a href="#body-parser-配置">body-parser 配置</a></li>
<li><a href="#获取-post-数据">获取 POST 数据</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#重定向">重定向</a></li>
<li><a href="#项目分析">项目分析</a><ul>
<li><a href="#清晰的文档">清晰的文档</a></li>
<li><a href="#路由设计">路由设计</a></li>
<li><a href="#项目结构分离">项目结构分离</a></li>
<li><a href="#代码规范">代码规范</a><ul>
<li><a href="#统一的代码风格">统一的代码风格</a></li>
<li><a href="#代码分离模块职责单一">代码分离，模块职责单一</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="Express-简介"><a href="#Express-简介" class="headerlink" title="Express 简介"></a>Express 简介</h2><p>原生的 http 在某些方面不足以应对我们的开发需求，框架的目的就是提高效率，让我们的代码更高度统一。</p>
<p>Express 是一个保持最小规模的灵活的 Node.js Web 应用程序开发框架，为 Web 和移动应用程序提供一组强大的功能。</p>
<p>官网：<a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener">http://www.expressjs.com.cn/</a></p>
<h2 id="Express-安装及入门"><a href="#Express-安装及入门" class="headerlink" title="Express 安装及入门"></a>Express 安装及入门</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 新建项目文件夹并进入</span><br><span class="line">&gt; <span class="built_in">mkdir</span> express_demo</span><br><span class="line">&gt; <span class="built_in">cd</span> express_demo</span><br><span class="line"></span><br><span class="line">// 创建 package.json 文件</span><br><span class="line">&gt; npm init</span><br><span class="line"></span><br><span class="line">// 安装 Express，最好用cnpm</span><br><span class="line">&gt; npm install express --save</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建服务器应用程序，相当于原生 Node 的 var server =  http.createServer()</span></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当服务器收到 get 请求 / 的时候，执行回调函数，相当于原生 Node 中解析 get 请求的 request.url === '/'</span></span><br><span class="line">app.get(<span class="string">'/'</span>, (request, response) =&gt; &#123;</span><br><span class="line">  response.send(<span class="string">'hello express'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于 server.listen</span></span><br><span class="line">app.listen(port, hostname, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`服务器已启动，通过 http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/ 访问`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>通过这个案例我们大概可以看出来，Express 和原生的 Node 大致相同，但是可以将项目更清晰。</p>
<hr>
<h2 id="静态服务"><a href="#静态服务" class="headerlink" title="静态服务"></a>静态服务</h2><p>为了提供诸如图像、CSS 文件和 JavaScript 文件之类的静态文件，请使用 Express 中的 express.static 内置中间件函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 当前 js 文件与公共目录同级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 公开 public 目录，如通过127.0.0.1:8888/img/1.jpg 路径 public/img 目录下的 1.jpg 图片资源</span></span><br><span class="line">app.use(express.static(<span class="string">'public'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 公开 public 目录，并通过虚拟路径 '/public' 前缀访问，127.0.0.1:8888/public/img/1.jpg 路径 public/img 目录下的 1.jpg 图片资源</span></span><br><span class="line">app.use(<span class="string">'/public'</span>, express.static(<span class="string">'public'</span>))</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="使用-art-template-模板引擎"><a href="#使用-art-template-模板引擎" class="headerlink" title="使用 art-template 模板引擎"></a>使用 art-template 模板引擎</h2><p>中文文档：<a href="https://aui.github.io/art-template/express/" target="_blank" rel="noopener">https://aui.github.io/art-template/express/</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><code>express-art-template</code> 模板引擎是依赖 <code>art-template</code> 的，所以在安装时需要安装<code>art-template</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template</span><br><span class="line">npm install --save express-art-template</span><br></pre></td></tr></table></figure>
<h3 id="在-Express-中加载-express-art-template-模板"><a href="#在-Express-中加载-express-art-template-模板" class="headerlink" title="在 Express 中加载 express-art-template 模板"></a>在 Express 中加载 express-art-template 模板</h3><p>加载 <code>express-art-template</code> 模板方法与加载其他的模块略有不同，在 <code>require</code> 之后还需要配置需要渲染的文件，在官方案例中是使用 <code>art</code> 后缀的文件，但是这种文件编辑时没有语法高亮，我们可以使用 <code>.html</code> 后缀的前端文件来进行渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置使用 art-template 模板引擎，</span></span><br><span class="line"><span class="comment">// 第一个参数：当渲染以该后缀的文件时，使用 art-template 模板引擎</span></span><br><span class="line">app.engine(<span class="string">'html'</span>, <span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="在-Express-中使用模板引擎"><a href="#在-Express-中使用模板引擎" class="headerlink" title="在 Express 中使用模板引擎"></a>在 Express 中使用模板引擎</h3><p><code>express</code> 默认所有的视图渲染存储目录(html文件之类)的路径为 <code>views</code>，需要注意。但是可以使用 <code>app.set()</code> 方法来修改默认的路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建服务器应用程序，相当于原生 Node 的 http.createServer</span></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置使用 art-template 模板引擎，</span></span><br><span class="line"><span class="comment">// 第一个参数：当渲染以该后缀的文件时，使用 art-template 模板引擎</span></span><br><span class="line">app.engine(<span class="string">'html'</span>, <span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果要修改 views 默认路径</span></span><br><span class="line">app.set(<span class="string">'views'</span>, <span class="string">'模板所在路径'</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 将模板源代码编译成函数并立刻执行，默认是放在 views 目录下</span></span><br><span class="line">  res.render(<span class="string">'index.html'</span>, &#123;</span><br><span class="line">    title: <span class="string">'express模板测试'</span>,</span><br><span class="line">    content: <span class="string">'主页'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于 server.listen</span></span><br><span class="line">app.listen(port, hostname, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`服务器已启动，通过 http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/ 访问`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html 渲染模板文件 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="基本路由"><a href="#基本路由" class="headerlink" title="基本路由"></a>基本路由</h2><h3 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h3><p>在 <code>express</code> 中，<code>GET</code> 方法已经非常方便了，不需要像原生的一样从服务器获取 <code>request</code> 然后获取 <code>request.url</code> 路径标识，之后再进行路由选择。在 <code>express</code> 中 <code>GET</code> 直接进行路由选择，效率大大提高。</p>
<p>同时，原生中使用 <code>response.end()</code> 或者 <code>response.write()</code> 响应页面，在 <code>express</code> 中使用 <code>response.send()</code> 响应页面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/'</span>, (request, response) =&gt; &#123;</span><br><span class="line">    response.send()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><p>在 <code>express</code> 中没有内置获取表单 <code>POST</code> 请求体的API，这里我们需要一个 <code>express</code> 的第三方包 <code>body-parser</code>。</p>
<p><a href="http://www.expressjs.com.cn/en/resources/middleware/body-parser.html" target="_blank" rel="noopener">http://www.expressjs.com.cn/en/resources/middleware/body-parser.html</a></p>
<h4 id="body-parser-安装"><a href="#body-parser-安装" class="headerlink" title="body-parser 安装"></a>body-parser 安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install body-parser</span><br></pre></td></tr></table></figure>
<h4 id="body-parser-配置"><a href="#body-parser-配置" class="headerlink" title="body-parser 配置"></a>body-parser 配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置 body-parser 中间件（用来配置 POST 的插件）</span></span><br><span class="line"><span class="comment">// parse application/x-www-form-urlencoded</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// parse application/json</span></span><br><span class="line">app.use(bodyParser.json())</span><br></pre></td></tr></table></figure>
<h4 id="获取-POST-数据"><a href="#获取-POST-数据" class="headerlink" title="获取 POST 数据"></a>获取 POST 数据</h4><p>配置完这个中间件之后，<code>request</code> 中会多出一个 <code>body</code> 属性，通过 <code>body</code> 属性就能获取 <code>post</code> 请求数据了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单使用，打印出这个 post 数据</span></span><br><span class="line">app.use(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  response.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>)</span><br><span class="line">  response.write(<span class="string">'you posted;\n'</span>)</span><br><span class="line">  <span class="comment">// post 数据在 request.body 中，将其转为 JSON 数据并打印出来。</span></span><br><span class="line">  response.end(<span class="built_in">JSON</span>.stringify(request.body, <span class="literal">null</span>, <span class="number">2</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/'</span>, (request, response) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 重定向，不需要再管 statusCode 和 Location 值类的了，只需要使用这个方法传入目的地址即可。</span></span><br><span class="line">  res.redirect(<span class="string">'/'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="项目分析"><a href="#项目分析" class="headerlink" title="项目分析"></a>项目分析</h2><p>在项目中，不会使用原生的 <code>Node</code> 进行开发。</p>
<h3 id="清晰的文档"><a href="#清晰的文档" class="headerlink" title="清晰的文档"></a>清晰的文档</h3><p>无论如何，开发项目必须写详细的项目文档。</p>
<h3 id="路由设计"><a href="#路由设计" class="headerlink" title="路由设计"></a>路由设计</h3><p>在 WEB 开发中，很关键的一步就是路由设计，清楚的路由设计是大型项目的保证。</p>
<p>如下，为一个只涉及学生信息增删改查的小项目的路由设计，需要写明请求方法、路径、参数和页面功能备注等：</p>
<table>
<thead>
<tr>
<th>请求方法</th>
<th>请求路径</th>
<th>get参数</th>
<th>post 参数</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/students</td>
<td>—</td>
<td>—</td>
<td>渲染首页</td>
</tr>
<tr>
<td>GET</td>
<td>/students/new</td>
<td>—</td>
<td>—</td>
<td>渲染添加学生页面</td>
</tr>
<tr>
<td>POST</td>
<td>/students</td>
<td>—</td>
<td>nameage/gender/hobbies</td>
<td>处理添加学生请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/edit</td>
<td>id</td>
<td>—</td>
<td>渲染编辑页面</td>
</tr>
<tr>
<td>POST</td>
<td>/students/edit</td>
<td>—</td>
<td>id/name/age/gender/hobbies</td>
<td>处理编辑请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/delete</td>
<td>id</td>
<td>name/age/gender/hobbies</td>
<td>处理删除请求</td>
</tr>
</tbody>
</table>
<h3 id="项目结构分离"><a href="#项目结构分离" class="headerlink" title="项目结构分离"></a>项目结构分离</h3><p>静态页面和公共资源目录分离</p>
<h3 id="代码规范"><a href="#代码规范" class="headerlink" title="代码规范"></a>代码规范</h3><h4 id="统一的代码风格"><a href="#统一的代码风格" class="headerlink" title="统一的代码风格"></a>统一的代码风格</h4><p>代码风格不统一会让维护和团队开发比较困难。</p>
<h4 id="代码分离，模块职责单一"><a href="#代码分离，模块职责单一" class="headerlink" title="代码分离，模块职责单一"></a>代码分离，模块职责单一</h4><p>在开发中，会将代码细化，使其功能分离。代码分离会让项目结构更加清晰，便于开发和维护。</p>
<p>在 <code>node</code> 开发中，入口模块 <code>index.js</code> 中只负责创建服务、做服务相关配置、挂载路由、监听端口等功能。至于具体的每个部分的代码将其细化到各个专门的文件中，这样方便大型项目后期开发，让项目更加清晰。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * index.js 入门模块</span></span><br><span class="line"><span class="comment"> * 职责：</span></span><br><span class="line"><span class="comment"> *  创建服务</span></span><br><span class="line"><span class="comment"> *  做服务相关配置</span></span><br><span class="line"><span class="comment"> *      模板引擎</span></span><br><span class="line"><span class="comment"> *      body-parser 解析表单 post 请求体</span></span><br><span class="line"><span class="comment"> *      提供静态资源服务</span></span><br><span class="line"><span class="comment"> *  挂载路由</span></span><br><span class="line"><span class="comment"> *  监听端口启动服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入模块</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">'./router'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 端口号及服务器地址</span></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载模板引擎</span></span><br><span class="line">app.engine(<span class="string">'html'</span>, <span class="built_in">require</span>(<span class="string">'express-art-template'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开放公共空间</span></span><br><span class="line">app.use(<span class="string">'/node_modules/'</span>, express.static(<span class="string">'./node_modules/'</span>))</span><br><span class="line">app.use(<span class="string">'/public/'</span>, express.static(<span class="string">'./public/'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把路由容器挂载到 app 服务中</span></span><br><span class="line">app.use(router)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 端口监听</span></span><br><span class="line">app.listen(port, hostname, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`服务器已启动，通过 http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/ 访问`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * router.js 路由模块</span></span><br><span class="line"><span class="comment"> * 职责：</span></span><br><span class="line"><span class="comment"> *  处理路由</span></span><br><span class="line"><span class="comment"> *  根据不同的请求方法和请求路径设置具体的请求处理函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 引入数据操作模块</span></span><br><span class="line"><span class="keyword">var</span> db = <span class="built_in">require</span>(<span class="string">'./db'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 引入 express ，专门用来包装路由的</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建一个路由容器</span></span><br><span class="line"><span class="keyword">var</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把路由挂载到 router 路由容器中</span></span><br><span class="line">router.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.rander(<span class="string">'index.html'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载异步数据渲染模板</span></span><br><span class="line">router.get(<span class="string">'/xxx'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  db.find(<span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'Server error.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从文件中读取到的数据一定是字符串，所以需要手动转成对象</span></span><br><span class="line">    <span class="keyword">var</span> labels = data.labels</span><br><span class="line">    <span class="keyword">var</span> students = data.students</span><br><span class="line"></span><br><span class="line">    res.render(<span class="string">'index.html'</span>, &#123;</span><br><span class="line">      labels: labels,</span><br><span class="line">      students: students</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 把 router 导出</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装异步 API</span></span><br><span class="line"><span class="comment"> * 在获取异步操作中的内容时，需要通过回调函数来获取其中的内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * db.js 数据操作文件模块</span></span><br><span class="line"><span class="comment"> * 职责：</span></span><br><span class="line"><span class="comment"> *  操作文件中的数据，只处理数据，不关心业务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dbPath = <span class="string">'./db.json'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用回调函数返回异步操作结果</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询数据</span></span><br><span class="line"><span class="comment"> * callback 中的参数</span></span><br><span class="line"><span class="comment"> *      第一个参数是 err</span></span><br><span class="line"><span class="comment"> *          成功是 null</span></span><br><span class="line"><span class="comment"> *          错误是 err对象</span></span><br><span class="line"><span class="comment"> *      第二个参数是 数据解析结果</span></span><br><span class="line"><span class="comment"> *          成功是 数组</span></span><br><span class="line"><span class="comment"> *          错误是 underfinded</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.find = <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  fs.readFile(dbPath, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> callback(err)</span><br><span class="line">    &#125;</span><br><span class="line">    callback(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(data))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 增添数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.insert = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.delete = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/11/框架——Express/" data-id="cjtg2fvm10030o4ut9ld8q6hw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node/">Node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后端/">后端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/框架/">框架</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-软件配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/10/软件配置/" class="article-date">
  <time datetime="2019-03-10T06:38:45.000Z" itemprop="datePublished">2019-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/10/软件配置/">软件配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- TOC -->
<ul>
<li><a href="#visual-sudio-code">Visual Sudio Code</a><ul>
<li><a href="#markdown-文件">MarkDown 文件</a><ul>
<li><a href="#markdown-toc-文件目录插件">Markdown TOC 文件目录插件</a></li>
<li><a href="#paste-image-贴图插件">Paste Image 贴图插件</a></li>
<li><a href="#markdown-preview-enhanced-多功能插件">Markdown Preview Enhanced 多功能插件</a></li>
<li><a href="#实时预览">实时预览</a></li>
</ul>
</li>
<li><a href="#javascript-文件">JavaScript 文件</a><ul>
<li><a href="#standardjs---javascript-standard-style-代码标准化插件">StandardJS - JavaScript Standard Style 代码标准化插件</a></li>
</ul>
</li>
<li><a href="#json-文件">JSON 文件</a><ul>
<li><a href="#json-tools-格式化插件">JSON Tools 格式化插件</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="Visual-Sudio-Code"><a href="#Visual-Sudio-Code" class="headerlink" title="Visual Sudio Code"></a>Visual Sudio Code</h1><h2 id="MarkDown-文件"><a href="#MarkDown-文件" class="headerlink" title="MarkDown 文件"></a>MarkDown 文件</h2><h3 id="Markdown-TOC-文件目录插件"><a href="#Markdown-TOC-文件目录插件" class="headerlink" title="Markdown TOC 文件目录插件"></a>Markdown TOC 文件目录插件</h3><p><img src="/2019/03/10/软件配置/MarkdownTOC.jpg" alt="MarkdownTOC.jpg"></p>
<p>此插件用于自动生成章节目录，使用了之后，会自动生成目录，并动态更新，且有超链接效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- TOC --&gt;</span><br><span class="line">    目录结构</span><br><span class="line">&lt;!-- /TOC --&gt;</span><br></pre></td></tr></table></figure>
<p>在 markdown 文件中，右键，弹出如下内容：</p>
<p><img src="/2019/03/10/软件配置/MarkdownTOCShow.jpg" alt="MarkdownTOCShow.jpg"></p>
<ul>
<li>Markdown Sections: 在章节头部中添加深度</li>
<li>Markdown TOC：生成章节目录</li>
</ul>
<hr>
<h3 id="Paste-Image-贴图插件"><a href="#Paste-Image-贴图插件" class="headerlink" title="Paste Image 贴图插件"></a>Paste Image 贴图插件</h3><p>自动保存截图面板中的图片到当前目录。</p>
<hr>
<h3 id="Markdown-Preview-Enhanced-多功能插件"><a href="#Markdown-Preview-Enhanced-多功能插件" class="headerlink" title="Markdown Preview Enhanced 多功能插件"></a>Markdown Preview Enhanced 多功能插件</h3><p>超级强大的 Markdown 插件。可惜贴图功能不适用于vsCode。</p>
<p>详细功能见文档：<a href="https://shd101wyy.github.io/markdown-preview-enhanced/#/zh-cn/" target="_blank" rel="noopener">https://shd101wyy.github.io/markdown-preview-enhanced/#/zh-cn/</a></p>
<hr>
<h3 id="实时预览"><a href="#实时预览" class="headerlink" title="实时预览"></a>实时预览</h3><p><code>vsCode</code> 自带插件。</p>
<p>快捷键：<code>CTRL + SHIFT + M</code> 打开侧边预览功能。</p>
<hr>
<h2 id="JavaScript-文件"><a href="#JavaScript-文件" class="headerlink" title="JavaScript 文件"></a>JavaScript 文件</h2><h3 id="StandardJS-JavaScript-Standard-Style-代码标准化插件"><a href="#StandardJS-JavaScript-Standard-Style-代码标准化插件" class="headerlink" title="StandardJS - JavaScript Standard Style 代码标准化插件"></a>StandardJS - JavaScript Standard Style 代码标准化插件</h3><p>将 <code>JavaScript</code> 标准样式集成到 <code>VS</code> 代码中。编写 <code>JS</code> 代码时，会自动校验代码，并提示不符合 <code>JS</code> 代码规范的地方，当保存时，会自动修改为规范代码。</p>
<hr>
<h2 id="JSON-文件"><a href="#JSON-文件" class="headerlink" title="JSON 文件"></a>JSON 文件</h2><h3 id="JSON-Tools-格式化插件"><a href="#JSON-Tools-格式化插件" class="headerlink" title="JSON Tools 格式化插件"></a>JSON Tools 格式化插件</h3><p>次插件用于帮助 <code>vsCode</code> 格式化 <code>JSON</code> 文件。</p>
<p>安装之后 <code>CTRL + SHIFT + P</code> 搜索 <code>json</code> ，会看到 <code>JSON Tools</code> 的两个功能。</p>
<p><img src="/2019/03/10/软件配置/JSONTools.jpg" alt="JSONTools.jpg"></p>
<ul>
<li><p>JSON Tools: Pretty JSON       // 格式化 JSON ，展开 JSON 字符串</p>
</li>
<li><p>JSON Tools: Minify JSON       // 格式化 JSON ，收缩 JSON 字符串</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/10/软件配置/" data-id="cjtg2fv72001eo4utbqha58yj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/软件配置/">软件配置</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-移动应用开发——Cordova" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/04/移动应用开发——Cordova/" class="article-date">
  <time datetime="2019-03-04T10:52:30.000Z" itemprop="datePublished">2019-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/04/移动应用开发——Cordova/">移动应用开发——Cordova</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/2019/03/04/移动应用开发——Cordova/cordova_bot.png" alt="cordova_bot.png"></p>
<p>目录：</p>
<!-- TOC -->
<ul>
<li><a href="#cordova-简介">Cordova 简介</a></li>
<li><a href="#前置基础介绍">前置基础介绍</a></li>
<li><a href="#环境配置">环境配置</a></li>
<li><a href="#项目介绍">项目介绍</a><ul>
<li><a href="#configxml">config.xml</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<hr>
<h2 id="Cordova-简介"><a href="#Cordova-简介" class="headerlink" title="Cordova 简介"></a>Cordova 简介</h2><p>Cordova 全称 Apache Cordova，是一款开放源代码的移动开发框架，原名PhoneGap。</p>
<p>API 文档：<a href="https://cordova.apache.org/docs/en/3.0.0/index.html" target="_blank" rel="noopener">https://cordova.apache.org/docs/en/3.0.0/index.html</a></p>
<p>API 中文文档：<a href="http://www.dba.cn/book/cordova/" target="_blank" rel="noopener">http://www.dba.cn/book/cordova/</a></p>
<hr>
<h2 id="前置基础介绍"><a href="#前置基础介绍" class="headerlink" title="前置基础介绍"></a>前置基础介绍</h2><p>Cordova 是移动端混合开发（综合原生和web的优点）。所以，要学 Cordova 需要原生开发的只是，android 或者 ios 根据需求；web 开发，HTML+CSS+JS。</p>
<hr>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>Cordova 是移动端混合开发，所以在配置环境的时候需要分别配置原生开发环境和web开发环境。</p>
<p>这里我们只使用 android 原生配置。</p>
<ol>
<li><p>jdk</p>
<p> java 开发环境，因为 android 是以 java 为基础的。</p>
</li>
<li><p>android studio</p>
<p> 有些教材会使用 eclipse ，但是 eclipse 已经淘汰了，android studio 是开发 android 的主流软件。</p>
<p> 需要配置 sdk 和 avd (手机模拟器)。</p>
<p> 因为需要开发 android ，需要在 android 编辑器中调试啥的。</p>
</li>
<li><p>Node.js</p>
<p> Cordova 是使用Node.js 进行管理。需要 npm 包管理器进行下载。</p>
</li>
<li><p>Cordova 安装及配置</p>
<ul>
<li><p>安装完 Node.js 之后，使用管理员身份运行 Node.js command prompt.exe。</p>
</li>
<li><p>npm 下载安装 cordova：在命令行中输入 “npm install -g cordova”。</p>
</li>
<li><p>创建 cordova 项目：在命令行中输入 “cordova create 项目名”。</p>
</li>
<li><p>给项目添加 android 或者 ios 平台：先 “cd 项目名” 进入项目，输入命令 “cordova platform add android” 添加 android 平台，ios平台同上。“cordova platform remove android” 删除平台。此时项目的platform中就会添加对应的平台项目。然后使用 android studio 打开即可。</p>
</li>
<li><p>编译可运行的文件：“cordova build android”。</p>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>基础 android 部分忽略。只讲特殊部分。</p>
<h3 id="config-xml"><a href="#config-xml" class="headerlink" title="config.xml"></a>config.xml</h3><p><img src="/2019/03/04/移动应用开发——Cordova/config介绍.jpg" alt="config介绍.jpg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/04/移动应用开发——Cordova/" data-id="cjtg2fv70001bo4utcfra8s43" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/框架/">框架</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/移动端/">移动端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-后端基础——Nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/02/后端基础——Nodejs/" class="article-date">
  <time datetime="2019-03-02T07:08:39.000Z" itemprop="datePublished">2019-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/02/后端基础——Nodejs/">后端基础——Node.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/2019/03/02/后端基础——Nodejs/node.png" alt="node.png"></p>
<p>目录：</p>
<!-- TOC -->
<ul>
<li><a href="#nodejs是什么">Node.js是什么</a></li>
<li><a href="#浏览器与nodejs中的js">浏览器与Node.js中的JS</a></li>
<li><a href="#npm-基础">npm 基础</a><ul>
<li><a href="#项目初始化">项目初始化</a></li>
<li><a href="#下载模块包">下载模块包</a></li>
<li><a href="#其他常用命令">其他常用命令</a></li>
<li><a href="#npm-被墙问题">npm 被墙问题</a></li>
</ul>
</li>
<li><a href="#nodejs能做什么">Node.js能做什么</a></li>
<li><a href="#代码规范及分号原则">代码规范及分号原则</a></li>
<li><a href="#下载安装">下载安装</a></li>
<li><a href="#nodemon-第三方命令行工具">nodemon 第三方命令行工具</a></li>
<li><a href="#第一个案例-helloworld">第一个案例 HelloWorld</a></li>
<li><a href="#文件操作">文件操作</a></li>
<li><a href="#服务器请求">服务器请求</a></li>
<li><a href="#node-中的模块系统">Node 中的模块系统</a><ul>
<li><a href="#文件作用域">文件作用域</a></li>
<li><a href="#通信规则">通信规则</a><ul>
<li><a href="#加载-require">加载 require</a><ul>
<li><a href="#require-的作用"><code>require</code> 的作用</a></li>
<li><a href="#加载规则">加载规则</a></li>
<li><a href="#语法">语法</a></li>
</ul>
</li>
<li><a href="#导出exports">导出：exports</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#文本类型及中文乱码">文本类型及中文乱码</a></li>
<li><a href="#nodejs-实现-apache-功能">Node.js 实现 Apache 功能</a></li>
<li><a href="#art-template-模板引擎">art-template 模板引擎</a><ul>
<li><a href="#安装">安装</a></li>
<li><a href="#加载-art-template-模板引擎">加载 art-template 模板引擎</a><ul>
<li><a href="#前端">前端</a></li>
<li><a href="#node-后端">node 后端</a></li>
</ul>
</li>
<li><a href="#使用-art-template-模板引擎">使用 art-template 模板引擎</a><ul>
<li><a href="#前端-1">前端</a></li>
<li><a href="#后端">后端</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#nodejs-后端项目结构基础">Node.js 后端项目结构基础</a></li>
<li><a href="#基本路由">基本路由</a><ul>
<li><a href="#路由的基本概念">路由的基本概念</a></li>
<li><a href="#get">GET</a></li>
<li><a href="#post">POST</a></li>
</ul>
</li>
<li><a href="#重定向">重定向</a><ul>
<li><a href="#301-永久重定向推荐">301 永久重定向（推荐）</a></li>
<li><a href="#302-临时重定向">302 临时重定向</a></li>
</ul>
</li>
<li><a href="#回调函数-callback">回调函数 callback</a></li>
<li><a href="#事件循环">事件循环</a></li>
<li><a href="#异步编程">异步编程</a><ul>
<li><a href="#回调地域">回调地域</a></li>
<li><a href="#es6-promise-解决回调地域">ES6 Promise 解决回调地域</a></li>
</ul>
</li>
<li><a href="#express-框架">Express 框架</a></li>
<li><a href="#小型项目">小型项目</a></li>
<li><a href="#nodejs-连接-mongodb-数据库">Node.js 连接 MongoDB 数据库</a><ul>
<li><a href="#mongoose-第三方框架">mongoose 第三方框架</a><ul>
<li><a href="#起步">起步</a><ul>
<li><a href="#第一步mongoose-引入及连接数据库">第一步：mongoose 引入及连接数据库</a></li>
<li><a href="#第二步schema-文档结构设计">第二步：Schema 文档结构设计</a></li>
<li><a href="#第三步schema-文档结构发布为-model-模型">第三步：Schema 文档结构发布为 Model 模型</a></li>
<li><a href="#第四步使用-model-对象生成本地数据文档">第四步：使用 Model 对象生成本地数据文档</a></li>
</ul>
</li>
<li><a href="#crud-操作">CRUD 操作</a><ul>
<li><a href="#增加create">增加(Create)</a></li>
<li><a href="#查询retrieve">查询(Retrieve)</a></li>
<li><a href="#更新update">更新(Update)</a></li>
<li><a href="#删除delete">删除(Delete)</a></li>
</ul>
</li>
<li><a href="#nodejs-中使用-mongoose-框架">Node.js 中使用 Mongoose 框架</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#nodejs-连接-mysql-数据库">Node.js 连接 MySQL 数据库</a><ul>
<li><a href="#安装-1">安装</a></li>
<li><a href="#起步-1">起步</a></li>
<li><a href="#query-方法简介">query() 方法简介</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<p>Node.js 是前端工程师进阶高级工程师必备内容。</p>
<hr>
<h2 id="Node-js是什么"><a href="#Node-js是什么" class="headerlink" title="Node.js是什么"></a>Node.js是什么</h2><p>Node.js 不是一门语言，不是库，不是框架。Node.js 是一个 JavaScript 运行时环境。简单来讲就是 Node.js 可以解析和执行 JS 代码。</p>
<p>以前只有浏览器可以解析JS代码。但是现在JS可以完全脱离浏览器来运行，就是因为有Node.js。</p>
<p>Node.js 基于 Google 的V8引擎，V8引擎执行 Javascript 的速度非常快，性能非常好。</p>
<p>官网：<a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></p>
<p>文档：<a href="https://nodejs.org/zh-cn/docs/" target="_blank" rel="noopener">https://nodejs.org/zh-cn/docs/</a></p>
<hr>
<h2 id="浏览器与Node-js中的JS"><a href="#浏览器与Node-js中的JS" class="headerlink" title="浏览器与Node.js中的JS"></a>浏览器与Node.js中的JS</h2><p>浏览器中的JS：</p>
<ul>
<li>EcmaScript: (基本语法，if，var，function，Object，Array)</li>
<li>BOM</li>
<li>DOM</li>
</ul>
<p>Node.js中的JS：</p>
<ul>
<li>ECMAScript</li>
<li><font color="red">没有BOM/DOM，服务端不操作页面。</font></li>
<li>为JS提供了一些服务器级别的API(文件读写，网络服务的构架，网络通信，http服务器等处理)</li>
</ul>
<hr>
<h2 id="npm-基础"><a href="#npm-基础" class="headerlink" title="npm 基础"></a>npm 基础</h2><p>NPM（node package manager），是基于Node.js开发的包管理器。是世界上最大的开源库生态系统。</p>
<p>中文文档： <a href="https://www.npmjs.cn/" target="_blank" rel="noopener">https://www.npmjs.cn/</a><br>官网： <a href="https://www.npmjs.com/" target="_blank" rel="noopener">https://www.npmjs.com/</a></p>
<p>一些常用的包都可以在官网查找。</p>
<p>更多查看博客《后端基础——npm常见包》</p>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><p><code>package.json</code> 包描述文件，这个文件会记录我们的项目信息，比如需要的项目依赖、版本号之类，非常重要，访问项目文件被误删导致无法挽回的后果。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 命令，有向导</span><br><span class="line">npm init</span><br><span class="line"></span><br><span class="line">// 跳过向导，快速创建，所有选项默认</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<p>执行这个命令之后，如果没有 <code>package.json</code> 包描述文件，就会新建；如果已经有了，当 <code>node_modules</code> 依赖丢失时，会根据 <code>package.json</code> 中的 <code>dependencies</code> 字段重新下载依赖。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">/** </span><br><span class="line"> * 如下为新建包描述文件（初始化项目）全过程</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">// 输入命令，通过命令向导创建</span><br><span class="line"><span class="function">F:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;<span class="title">npm</span> <span class="title">init</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 自动输出内容</span></span><br><span class="line"><span class="function"><span class="title">This</span> <span class="title">utility</span> <span class="title">will</span> <span class="title">walk</span> <span class="title">you</span> <span class="title">through</span> <span class="title">creating</span> <span class="title">a</span> <span class="title">package.json</span> <span class="title">file</span>.</span></span><br><span class="line"><span class="function"><span class="title">It</span> <span class="title">only</span> <span class="title">covers</span> <span class="title">the</span> <span class="title">most</span> <span class="title">common</span> <span class="title">items</span>, <span class="title">and</span> <span class="title">tries</span> <span class="title">to</span> <span class="title">guess</span> <span class="title">sensible</span> <span class="title">defaults</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">See</span> `<span class="title">npm</span> <span class="title">help</span> <span class="title">json</span>` <span class="title">for</span> <span class="title">definitive</span> <span class="title">documentation</span> <span class="title">on</span> <span class="title">these</span> <span class="title">fields</span></span></span><br><span class="line"><span class="function"><span class="title">and</span> <span class="title">exactly</span> <span class="title">what</span> <span class="title">they</span> <span class="title">do</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Use</span> `<span class="title">npm</span> <span class="title">install</span> &lt;<span class="title">pkg</span>&gt;` <span class="title">afterwards</span> <span class="title">to</span> <span class="title">install</span> <span class="title">a</span> <span class="title">package</span> <span class="title">and</span></span></span><br><span class="line"><span class="function"><span class="title">save</span> <span class="title">it</span> <span class="title">as</span> <span class="title">a</span> <span class="title">dependency</span> <span class="title">in</span> <span class="title">the</span> <span class="title">package.json</span> <span class="title">file</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Press</span> ^<span class="title">C</span> <span class="title">at</span> <span class="title">any</span> <span class="title">time</span> <span class="title">to</span> <span class="title">quit</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">/**</span></span><br><span class="line"><span class="function"> * 问答式填写项目内容，可以不填，回车直接跳过</span></span><br><span class="line"><span class="function"> */</span></span><br><span class="line"><span class="function">// 包名，默认是我们已经通过 <span class="title">cd</span> 命令进入的文件夹</span></span><br><span class="line"><span class="function"><span class="title">package</span> <span class="title">name</span>: (<span class="title">nodejs</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 版本号，默认为(1.0.0)，我们填写一个较低的版本(0.0.1)</span></span><br><span class="line"><span class="function"><span class="title">version</span>: (1.0.0) 0.0.1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 项目描述，手动输入</span></span><br><span class="line"><span class="function"><span class="title">description</span>: 这是一个学习项目</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 入口文件，默认是 <span class="title">index.js</span>，我们可以自定义</span></span><br><span class="line"><span class="function"><span class="title">entry</span> <span class="title">point</span>: (<span class="title">index.js</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 测试命令</span></span><br><span class="line"><span class="function"><span class="title">test</span> <span class="title">command</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="title">git</span> 仓库地址</span></span><br><span class="line"><span class="function"><span class="title">git</span> <span class="title">repository</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 关键字，如果想自己的项目通过 <span class="title">npm</span> 被别人下载，就可以填写关键字，供别人下载</span></span><br><span class="line"><span class="function"><span class="title">keywords</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 作者</span></span><br><span class="line"><span class="function"><span class="title">author</span>: <span class="title">AiJunhao</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 软件开源许可证</span></span><br><span class="line"><span class="function"><span class="title">license</span>: (<span class="title">ISC</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 生成的包描述文件内容</span></span><br><span class="line"><span class="function"><span class="title">About</span> <span class="title">to</span> <span class="title">write</span> <span class="title">to</span> <span class="title">F</span>:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>\<span class="title">package.json</span>:</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#123;</span></span><br><span class="line"><span class="function">  "<span class="title">name</span>": "<span class="title">nodejs</span>",</span></span><br><span class="line"><span class="function">  "<span class="title">version</span>": "0.0.1",</span></span><br><span class="line"><span class="function">  "<span class="title">description</span>": "这是一个学习项目",</span></span><br><span class="line"><span class="function">  "<span class="title">main</span>": "<span class="title">index.js</span>",</span></span><br><span class="line"><span class="function">  "<span class="title">scripts</span>": &#123;</span></span><br><span class="line"><span class="function">    "<span class="title">test</span>": "<span class="title">echo</span> \"<span class="title">Error</span>: <span class="title">no</span> <span class="title">test</span> <span class="title">specified</span>\" &amp;&amp; <span class="title">exit</span> 1"</span></span><br><span class="line"><span class="function">  &#125;,</span></span><br><span class="line"><span class="function">  "<span class="title">author</span>": "<span class="title">AiJunhao</span>",</span></span><br><span class="line"><span class="function">  "<span class="title">license</span>": "<span class="title">ISC</span>"</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 是否同意，输入 <span class="title">yes</span> </span></span><br><span class="line"><span class="function"><span class="title">Is</span> <span class="title">this</span> <span class="title">OK</span>? (<span class="title">yes</span>) <span class="title">yes</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">F</span>:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时在项目根目录就创建了 <code>package.json</code> 文件。</p>
<h3 id="下载模块包"><a href="#下载模块包" class="headerlink" title="下载模块包"></a>下载模块包</h3><p>使用 npm 下载的包，放在同级目录下的 “node_modules” 文件夹下。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 语法</span><br><span class="line">npm install 模块关键字 --save</span><br><span class="line"></span><br><span class="line">或者简写：npm i 模块关键字 --save</span><br><span class="line">或者简写：npm i 模块关键字 -S</span><br><span class="line"></span><br><span class="line">// --save：表示将这个下载记录到 package.js 的 dependencies 中。如果不写，则不保存。</span><br></pre></td></tr></table></figure>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 输入mingl</span><br><span class="line"><span class="function">F:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;<span class="title">npm</span> <span class="title">install</span> <span class="title">art</span>-<span class="title">template</span> --<span class="title">save</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 会有一些 <span class="title">WARN</span> ，不用管它</span></span><br><span class="line"><span class="function"><span class="title">npm</span> <span class="title">notice</span> <span class="title">created</span> <span class="title">a</span> <span class="title">lockfile</span> <span class="title">as</span> <span class="title">package</span>-<span class="title">lock.json</span>. <span class="title">You</span> <span class="title">should</span> <span class="title">commit</span> <span class="title">this</span> <span class="title">file</span>.</span></span><br><span class="line"><span class="function"><span class="title">npm</span> <span class="title">WARN</span> <span class="title">nodejs</span>@0.0.1 <span class="title">No</span> <span class="title">repository</span> <span class="title">field</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 表示包已经添加</span></span><br><span class="line"><span class="function">+ <span class="title">art</span>-<span class="title">template</span>@4.13.2</span></span><br><span class="line"><span class="function"><span class="title">added</span> 32 <span class="title">packages</span> <span class="title">from</span> 133 <span class="title">contributors</span> <span class="title">and</span> <span class="title">audited</span> 40 <span class="title">packages</span> <span class="title">in</span> 6.025<span class="title">s</span></span></span><br><span class="line"><span class="function"><span class="title">found</span> 0 <span class="title">vulnerabilities</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">F</span>:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时看项目文件夹，就会有 node_modules 文件夹被新建，里面放了所有一级、二级……依赖文件；<code>package.json</code> 文件中会添加 <code>dependencies</code> 字段，记录这次添加的依赖包。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"nodejs"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"这是一个学习项目"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"AiJunhao"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"art-template"</span>: <span class="string">"^4.13.2"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h3><ul>
<li><p>删除包</p>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm unistall 包名       // 只删除，不会删除依赖项中的内容</span><br><span class="line"></span><br><span class="line">简写: npm un 包名</span><br></pre></td></tr></table></figure>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm unistall 包名 --save       // 删除包并删除依赖项中的内容</span><br><span class="line"></span><br><span class="line">简写: npm un 包名 -S</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看使用帮助</p>
  <figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm --<span class="built_in">help</span>      // 查看所有使用帮助</span><br><span class="line"></span><br><span class="line">npm 命令 --<span class="built_in">help</span>     // 查看该命令的具体使用方法</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="npm-被墙问题"><a href="#npm-被墙问题" class="headerlink" title="npm 被墙问题"></a>npm 被墙问题</h3><p>npm 存储包文件的服务器在国外，有时候会被墙，这时候可以使用淘宝镜像 cnpm。</p>
<p><a href="http://npm.taobao.org/" target="_blank" rel="noopener">http://npm.taobao.org/</a> 淘宝的开发团队把 npm 在国内做了一个备份。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 安装淘宝的 cnpm</span><br><span class="line">npm install --global cnpm</span><br><span class="line"></span><br><span class="line">// 然后将正常的 npm 命令中 npm 改成 cnpm 即可</span><br><span class="line">npm install jquery</span><br><span class="line">变成：cpm install jquery</span><br></pre></td></tr></table></figure>
<p>如果不想安装 cnpm 又想使用淘宝镜像下载：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery --registry=https://registry.npm.taoba.org</span><br></pre></td></tr></table></figure>
<p>但是这样比较麻烦，可以将这个选项加入配置文件中：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 配置</span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">// 查看配置</span><br><span class="line">npm config list</span><br></pre></td></tr></table></figure>
<p>配置之后，之后所有的下载都是从淘宝镜像下载的。</p>
<hr>
<h2 id="Node-js能做什么"><a href="#Node-js能做什么" class="headerlink" title="Node.js能做什么"></a>Node.js能做什么</h2><ul>
<li>web 服务器后台</li>
<li>命令行工具<ul>
<li>npm(node.js)</li>
<li>git(c语言)</li>
<li>hexo(node.js)</li>
</ul>
</li>
</ul>
<hr>
<h2 id="代码规范及分号原则"><a href="#代码规范及分号原则" class="headerlink" title="代码规范及分号原则"></a>代码规范及分号原则</h2><p>常用的JS代码规范有两种：</p>
<ul>
<li><p>JavaScript Standard Style: 较为松散</p>
<p>  <a href="https://standardjs.com/readme-zhcn.html#usage" target="_blank" rel="noopener">https://standardjs.com/readme-zhcn.html#usage</a></p>
</li>
<li><p>Airbnb JavaScript Style: 较严谨</p>
<p>  <a href="http://airbnb.io/javascript/" target="_blank" rel="noopener">http://airbnb.io/javascript/</a></p>
</li>
</ul>
<p>一般都有格式化插件，在编辑器中安装即可。</p>
<p>JS 中 tab 建议为2个空格。引号使用单引号。可以不使用分号。</p>
<p>如果采用无分号代码格式，当一行代码以小括号、大括号、斜引号开头时，在最前面加分号。</p>
<p>斜引号与单引号类似，都是字符串，单引号只能一行，斜引号中可以换行。</p>
<hr>
<h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p><img src="/2019/03/02/后端基础——Nodejs/download.JPG" alt="download.JPG"></p>
<p>一路next即可，重复安装会覆盖。</p>
<p>安装完node.js之后就是需要安装编辑器了，编辑器有很多，比如vsCode，subline等。</p>
<hr>
<h2 id="nodemon-第三方命令行工具"><a href="#nodemon-第三方命令行工具" class="headerlink" title="nodemon 第三方命令行工具"></a>nodemon 第三方命令行工具</h2><p><code>nodemon</code> 是一个基于 <code>Nodejs</code> 开发的一个第三方命令行工具，使用时需要独立安装。</p>
<p><code>nodemon</code> 工具只有一个作用：只要通过 <code>nodemon</code> 启动的服务，其文件就会被监视，当文件发生变化时(保存之后)，自动重启服务器。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 安装</span><br><span class="line">npm install --global nodemon</span><br></pre></td></tr></table></figure>
<p>安装完毕之后运行 js 文件即可：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 原先 node 启动服务器</span><br><span class="line">node index.js</span><br><span class="line"></span><br><span class="line">// 通过 nodemon 启动服务器</span><br><span class="line">nodemon index.js</span><br><span class="line"></span><br><span class="line">// nodemon 启动时的打印文件</span><br><span class="line"><span class="function">f:\<span class="title">WorkSpace</span>\<span class="title">nodejs</span>\<span class="title">express_demo</span>&gt;<span class="title">nodemon</span> <span class="title">index.js</span></span></span><br><span class="line"><span class="function">[<span class="title">nodemon</span>] 1.18.10</span></span><br><span class="line"><span class="function">[<span class="title">nodemon</span>] <span class="title">to</span> <span class="title">restart</span> <span class="title">at</span> <span class="title">any</span> <span class="title">time</span>, <span class="title">enter</span> `<span class="title">rs</span>`</span></span><br><span class="line"><span class="function">[<span class="title">nodemon</span>] <span class="title">watching</span>: *.*</span></span><br><span class="line"><span class="function">[<span class="title">nodemon</span>] <span class="title">starting</span> `<span class="title">node</span> <span class="title">index.js</span>`</span></span><br><span class="line"><span class="function">服务器已启动，通过 <span class="title">http</span>://127.0.0.1:8888/ 访问</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="第一个案例-HelloWorld"><a href="#第一个案例-HelloWorld" class="headerlink" title="第一个案例 HelloWorld"></a>第一个案例 HelloWorld</h2><p>这里我使用的是vsCode。</p>
<p>之前我们说了，node.js就是JS文件，所以我们只需要新建普通的js文件即可。</p>
<ol>
<li><p>创建编写JavaScript文件，注意文件名不能是“node.js”</p>
</li>
<li><p>打开终端，定位到JavaScript所属目录</p>
</li>
<li><p>输入“node 文件名”执行对应的文件</p>
</li>
</ol>
<p>vsCode自带终端，可以直接在vsCode中打开，或者使用win+R打开cmd执行终端。</p>
<p><img src="/2019/03/02/后端基础——Nodejs/helloworld.JPG" alt="helloworld.JPG"></p>
<hr>
<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><p>浏览器中的JavaScript是没有文件操作的能力的，是Node中的JavaScript有。</p>
<p>文件操作常用于基本数据的存储，可以是txt或者json类型的文本。</p>
<p>required 指令：我们可以使用 require 指令来载入 Node.js 模块。</p>
<font color="red">fs 模块:</font> 是 file-system 的简写，就是文件系统的意思。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取文件.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 require 方法加载 fs 核心模块</span></span><br><span class="line"><span class="comment">// fs 是 file-system 的简写，就是文件系统的意思</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 读取文件</span></span><br><span class="line"><span class="comment"> *      第一个参数是文件路径</span></span><br><span class="line"><span class="comment"> *      第二个参数是编码格式('utf-8')，可选，或者使用 data.toString()</span></span><br><span class="line"><span class="comment"> *      第三个参数是一个回调函数</span></span><br><span class="line"><span class="comment"> *          error</span></span><br><span class="line"><span class="comment"> *              如果读取失败，error 就是错误对象</span></span><br><span class="line"><span class="comment"> *              如果读取成功，error 就是 null</span></span><br><span class="line"><span class="comment"> *          data</span></span><br><span class="line"><span class="comment"> *              如果读取失败，error 就是错误对象</span></span><br><span class="line"><span class="comment"> *              如果读取成功，data 就是错误对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">fs.readFile(<span class="string">'hello.txt'</span>, <span class="string">'utf-8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 如果读取错误，error是一个对象，对应true，停止即可</span></span><br><span class="line">    <span class="comment">// 读取成功，error是null，对应false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'读取错误'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 因为里面都是二进制存储，如果没有第二个参数，就需要转换</span></span><br><span class="line">  <span class="built_in">console</span>.log(data.toString())    <span class="comment">// 打印读取到的文件</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写入文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 require 方法加载 fs 核心模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>) <span class="comment">// fs 是 file-system 的简写，就是文件系统的意思</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 写入文件</span></span><br><span class="line"><span class="comment"> *      第一个参数是文件路径</span></span><br><span class="line"><span class="comment"> *      第二个参数是需要写入的文本内容</span></span><br><span class="line"><span class="comment"> *      第三个参数是一个回调函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">fs.writeFile(<span class="string">'hello2.txt'</span>, <span class="string">'这是一个Node.js写入文件操作'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'文件写入成功'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><br>此外，这里读取文件时用的是非阻塞代码，也就是说我们不需要等待文件读取完，这样就可以在读取文件时同时执行接下来的代码，大大提高了程序的性能。还有一种阻塞代码，是顺序执行的，需要在文件读取完成之后再执行接下来的代码。<br><br>非阻塞代码：fs.readFileSync(‘hello.txt’);<br><br>————————————————————–<br><br>## 服务器请求<br><br><font color="red">http 模块:</font> 主要用于创建http server服务。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 加载 http 核心模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器地址和端口号</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建一个 web 服务器，返回一个 server 实例</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 服务器功能</span></span><br><span class="line"><span class="comment">// 发请求</span></span><br><span class="line"><span class="comment">// 接收请求</span></span><br><span class="line"><span class="comment">// 处理请求</span></span><br><span class="line"><span class="comment">// 发送响应</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收和响应数据</span></span><br><span class="line">server.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>)</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * request 接收请求</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'收到客户端请求！请求路径为：'</span> + request.url);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * response 响应数据</span></span><br><span class="line"><span class="comment">     *      write 用来给客户端发送响应数据，可以写多次，但是要使用 end 来结束响应，否则客户端会一直等待</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    response.write(<span class="string">'hello'</span>);</span><br><span class="line">    response.write(<span class="string">' nodejs'</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 绑定端口号，启动服务器，可以设置回调函数</span></span><br><span class="line">server.listen(port, hostname, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 如果使用如下形式，引号是斜引号不是单引号</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`服务器启动成功，可以通过 http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/ 来进行访问`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br>如上代码，创建服务器，然后获取返回值“hello world”，这里绑定了端口，运行了js文件之后，在浏览器中输入“<a href="http://127.0.0.1:8888/”即可访问我们当前的服务器，此时浏览器中显示的就是返回值。" target="_blank" rel="noopener">http://127.0.0.1:8888/”即可访问我们当前的服务器，此时浏览器中显示的就是返回值。</a><br><br>在cmd中输入“ctrl + c”关闭服务器。<br><br><img src="/2019/03/02/后端基础——Nodejs/服务器路径.JPG" alt="服务器路径.JPG"><br><br>然后看一下我们的上图，是我们在访问服务器时候打印的log，其中默认的是“<a href="http://127.0.0.1:8888/”，我们这里只是显示“/”，还有一个显示“/favicon.ico”，这是浏览器的默认访问小图标。此外还有很多其他的html中使用的静态资源，对于每一个资源浏览器都会发起单独的请求。" target="_blank" rel="noopener">http://127.0.0.1:8888/”，我们这里只是显示“/”，还有一个显示“/favicon.ico”，这是浏览器的默认访问小图标。此外还有很多其他的html中使用的静态资源，对于每一个资源浏览器都会发起单独的请求。</a><br><br>当然此时我们无论访问的是“<a href="http://127.0.0.1:8888/xxx”，这里都返回的是“hello" target="_blank" rel="noopener">http://127.0.0.1:8888/xxx”，这里都返回的是“hello</a> world”，所以我们可以根据“request.url”的不同来设置不同的返回值，实际上现实中也是这样进行的。<br><br>——————————————————————-<br><br>## Node 中的模块系统<br><br>在 Node 中，模块有三种：<br><br>- 具名的核心模块，如fs、http<br>- 用户自己编写的本地文件模块(js文件)，相对路径前加‘./’，文件后缀名.js推荐不写<br>- 通过npm安装的第三方模块<br><br>### 文件作用域<br><br>Node 中没有全局作用域，只有模块作用域(文件作用域)，也就是说，在模块系统中，不同的js文件中的变量不能相互使用。使用 <code>exports</code> 导出之后才可使用。<br><br>### 通信规则<br><br>#### 加载 require<br><br>##### <code>require</code> 的作用<br><br>1. 加载文件模块并执行里面的代码<br><br>2. 拿到被加载文件模块导出的接口对象(exports出来的对象)<br><br>##### 加载规则<br><br>使用 <code>require</code> 加载 <code>js</code> 模块，优先从缓存加载，如果缓存中有，为了提高代码效率，该模块就从缓存中直接拿到模块的接口对象，不再重新加载；如果没有，则加载该模块，并放入缓存。<br><br>##### 语法<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 自定义变量名称 = <span class="built_in">require</span>(<span class="string">'模块标识符'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用核心模块， require('核心模块名')</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用本地 js 模块， require('路径/文件名.js'); ./ 当前目录; ../ 上一级目录;</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="built_in">require</span>(<span class="string">'./test.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用第三方模块，通过 npm 下载到同级目录，require('包名')，node_modules/包名/package.json文件中的 main 属性中记录了该模块的入口模块</span></span><br><span class="line"><span class="keyword">var</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>)</span><br></pre></td></tr></table></figure><br><br>本地模块调用：在 a.js 文件中调用 b.js 。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'a start'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./b'</span>);      <span class="comment">// 同样也可以有返回对象，然后通过返回对象来调用成员方法。exports出来的对象。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'a end'</span>);</span><br></pre></td></tr></table></figure><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'b start'</span>);</span><br></pre></td></tr></table></figure><br><br><img src="/2019/03/02/后端基础——Nodejs/模块系统.JPG" alt="模块系统.JPG"><br><br><br><br>#### 导出：exports<br><br>模块公开的方法。<br><br>1. 模块作用域，默认文件中所有的对象只在当前文件模块有效<br><br>2. 对于希望被其他模块访问的成员，将这些公开成员都加载到<code>exports</code>接口对象中就可以<br><br><br>- 导出多个成员（保存在对象中）<br><br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出文件</span></span><br><span class="line">exports.a = <span class="number">123</span></span><br><span class="line">exports.b = <span class="string">'hello'</span></span><br><span class="line">exports.c = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ccc'</span>)</span><br><span class="line">&#125;</span><br><span class="line">exports.d = &#123;</span><br><span class="line">    foo: <span class="string">'bar'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文件</span></span><br><span class="line"><span class="keyword">var</span> ret = <span class="built_in">require</span>(<span class="string">'./xxx.js'</span>)       <span class="comment">// ret是一个对象</span></span><br><span class="line"><span class="keyword">var</span> a = ret.a</span><br><span class="line"><span class="keyword">var</span> b = ret.b</span><br></pre></td></tr></table></figure><br><br>- 导出单个成员（返回值就是函数、字符串）<br><br>    <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出文件</span></span><br><span class="line"><span class="comment">// 这种方式多导出会后者覆盖前者</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="string">'hello'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文件</span></span><br><span class="line"><span class="keyword">var</span> ret = <span class="built_in">require</span>(<span class="string">'./xxx.js'</span>)       <span class="comment">// ret === 'hello'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出文件</span></span><br><span class="line"><span class="comment">// 导出单个成员JSON字符串，但是这个成员包涵多个数据</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    &#125;,</span><br><span class="line">    str: <span class="string">'hello'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br><code>exports</code> 是 <code>module.exports</code> 的引用，只要不给 <code>exports</code> 或 <code>module.exports</code> 重新赋值，就不会断开这之间的引用，所以如果给引用对象的内部添加内容，这两个是相同的。变量和数值之间的关系。<br><br>官网有一句话：如果你实在分不清 <code>exports</code> 和 <code>module.exports</code> ,就忘了 <code>exports</code> ，只使用 <code>module.exports</code>。<br><br><br>———————————————————–<br><br>## 文本类型及中文乱码<br><br>服务器默认发送的数据是 utf-8 编码的内容，但是浏览器默认使用当前系统的默认编码去解析，中文操作系统默认是 gbk。所以需要传给浏览器我们使用的编码，这样它就不会调用默认编码了。<br><br>在 response 中的 setHeader 方法 Content-Type 属性设置 文本类型 和 编码类型 。<br><br>更多 Content-Type 属性：<a href="http://tool.oschina.net/commons/" target="_blank" rel="noopener">http://tool.oschina.net/commons/</a><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span>;</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url = request.url;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'收到客户端请求！请求路径为：'</span> + url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">'/plain'</span>) &#123;</span><br><span class="line">        <span class="comment">// 内容类型：普通文本，utf-8编码</span></span><br><span class="line">        response.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/plain; charset=utf-8'</span>);</span><br><span class="line">        response.end(<span class="string">'Hello World!你好世界！\n'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">'/html'</span>) &#123;</span><br><span class="line">        <span class="comment">// 内容类型：html文本，utf-8编码</span></span><br><span class="line">        response.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/html; charset=utf-8'</span>);</span><br><span class="line">        response.end(<span class="string">'&lt;p&gt;Hello World! &lt;a href=""&gt; 你好世界！&lt;/a&gt; &lt;/p&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(port, hostname, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Server running at http://'</span> + hostname + <span class="string">':'</span> + port + <span class="string">'/'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br>其实我们访问页面时候，发送请求，返回的不是页面，而是整个页面的字符串，然后在本地进行渲染！！！例如下图就是百度页面，访问时，response回来的是整个页面的代码字符串。<br><br><img src="/2019/03/02/后端基础——Nodejs/response.JPG" alt="response.JPG"><br><br>—————————————————————–<br><br>## Node.js 实现 Apache 功能<br><br>在 Apache 服务器中，我们可根据路径来获取资源，Node.js 模拟这种操作也非常简单。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 端口号</span></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span></span><br><span class="line"><span class="comment">// 主机ip</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"><span class="comment">// 项目路径</span></span><br><span class="line"><span class="keyword">const</span> homeDir = <span class="string">'F:/WorkSpace/nodejs/nodejsDay02/Apache/www'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 访问的网址路径，从'/'开始，不包括 hostname 和 port</span></span><br><span class="line">  <span class="keyword">var</span> url = request.url</span><br><span class="line">  <span class="comment">// 默认的首页文件路径</span></span><br><span class="line">  <span class="keyword">var</span> filePath = <span class="string">'/index.html'</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非首页网址，修改路径</span></span><br><span class="line">  <span class="keyword">if</span> (url !== <span class="string">'/'</span>) &#123;</span><br><span class="line">    filePath = url</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取文件</span></span><br><span class="line">  fs.readFile(homeDir + filePath, (error, data) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 文件读取失败，直接返回，不再运行</span></span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> response.end(<span class="string">'404 Not Found.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回文件，data是二进制</span></span><br><span class="line">    response.end(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 端口监听</span></span><br><span class="line">server.listen(port, hostname, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'服务器启动成功，可以通过http://'</span> + hostname + <span class="string">':'</span> + port + <span class="string">'/访问'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><br>—————————————————-<br><br>## art-template 模板引擎<br><br>模板引擎最早诞生于服务器领域，后来发展到了前端。<br><br>文档：<a href="https://aui.github.io/art-template/zh-cn/index.html" target="_blank" rel="noopener">https://aui.github.io/art-template/zh-cn/index.html</a><br><br>### 安装<br><br>在需要的文件中下载。在node_modules文件夹下。<br><br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install art-template --save</span><br></pre></td></tr></table></figure><br><br>### 加载 art-template 模板引擎<br><br>#### 前端<br><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/art-template/lib/template-web.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br>#### node 后端<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 有以下三种方式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 基于模板名渲染模板</span></span><br><span class="line">template(filename, data);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将模板源代码编译成函数</span></span><br><span class="line">template.compile(source, options);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将模板源代码编译成函数并立刻执行</span></span><br><span class="line">template.render(source, data, options);</span><br></pre></td></tr></table></figure><br><br>### 使用 art-template 模板引擎<br><br>#### 前端<br><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在 html 中的模板引擎 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/art-template/lib/template-web.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/template"</span> <span class="attr">id</span>=<span class="string">"tpl"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 模板引擎不关心内容，只关心 &#123;&#123;&#125;&#125; 标签 --&gt;</span></span></span><br><span class="line"><span class="undefined">        大家好，我是：&#123;&#123; name &#125;&#125;</span></span><br><span class="line"><span class="undefined">        我今年 &#123;&#123; age &#125;&#125; 岁了</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 其实可以允许是 html代码字符串 --&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ret = template(<span class="string">'tpl'</span>, &#123;</span></span><br><span class="line"><span class="javascript">            name: <span class="string">'Jack'</span>,</span></span><br><span class="line"><span class="undefined">            age: 18</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(ret)</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br>#### 后端<br><br>在 Node 中使用模板引擎，本地打印测试，我们调用http模块就可以response回模板数据也是一样的：<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./template02.html'</span>, (error, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'文件读取失败'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> html = template.render(data.toString(), &#123;</span><br><span class="line">    name: <span class="string">'Jack'</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 本地打印</span></span><br><span class="line">  <span class="built_in">console</span>.log(html)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    大家好，我是：&#123;&#123; name &#125;&#125;</span><br><span class="line">    我今年 &#123;&#123; age &#125;&#125; 岁了</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br><img src="/2019/03/02/后端基础——Nodejs/模板1.JPG" alt="模板1.JPG"><br><br>—————————————————————-<br><br>## Node.js 后端项目结构基础<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">项目</span><br><span class="line">    - config                       # 项目配置目录</span><br><span class="line">        - index.js                 # 配置项目中的配置信息</span><br><span class="line">    - models                       # 数据库 model</span><br><span class="line">    - node_modules                 # node.js 的依赖目录（模板文件）</span><br><span class="line">    - plugins                      # 插件目录</span><br><span class="line">    - routes                       # 路由目录</span><br><span class="line">        - hello-world.js           # 测试接口 hello-world</span><br><span class="line">    - utils                        # 工具类相关目录</span><br><span class="line">    - public                       # 公共静态资源目录（css、img、js、lib）</span><br><span class="line">    - views                        # html 视图文件目录</span><br><span class="line">    - app.js                       # 项目入口文件</span><br><span class="line">    - package.json                 # JS 项目工程依赖库</span><br><span class="line">    - readme.md                    # 项目工程如何被使用的说明手册...</span><br></pre></td></tr></table></figure><br><br>这样之后，我们就统一处理这些静态资源，所有可访问资源都在public中，哪些资源能被用户访问，哪些资源不能被用户访问，我们都可以通过代码来实现。然后我们在代码中可以集中处理这些资源的访问，使用 indexOf() 方法查找‘/public/’开头的地址，这些是可以访问静态资源的地址请求。但是注意之前要加一个点，表示的是服务器路径，不然就是在本地查找了。<br><br>app.js:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> url = request.url</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (url === <span class="string">'/'</span>) &#123;</span><br><span class="line">    <span class="comment">// 默认访问地址，这种隐藏后缀名的方式可以学习</span></span><br><span class="line">    fs.readFile(<span class="string">'./views/index.html'</span>, (error, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> response.end(<span class="string">'404 Not Found.'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      response.end(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.indexOf(<span class="string">'/public/'</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 静态资源访问地址，这些地址都是以‘/public/’开头的</span></span><br><span class="line">    fs.readFile(<span class="string">'.'</span> + url, (error, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> response.end(<span class="string">'404 Not Found.'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      response.end(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 其他网址都是不可访问的，我们处理成404错误，也能返回一个自定义的404页面</span></span><br><span class="line">    fs.readFile(<span class="string">'./views/404.html'</span>, (error, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> response.end(<span class="string">'404 Not Found.'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      response.end(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(port, hostname, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'服务器启动成功，可以通过http://'</span> + hostname + <span class="string">':'</span> + port + <span class="string">'/访问'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br><br>注意，使用这种方式之后，我们访问css、js之类的静态资源就不能再使用相对地址表示了！！！要使用服务器url地址访问。<br><br>index.html：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>焦点轮播图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 所有静态资源都使用url地址访问，‘../’返回上级目录是相对地址访问 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/public/css/css.css"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/public/js/jquery-3.3.1.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/public/js/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 图片div --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/public/img/5.jpg"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/public/img/1.jpg"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/public/img/2.jpg"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/public/img/3.jpg"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/public/img/4.jpg"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/public/img/5.jpg"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/public/img/1.jpg"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 导航div --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"pointsDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"prev"</span> <span class="attr">class</span>=<span class="string">"arrow"</span> <span class="attr">src</span>=<span class="string">"/public/img/left.png"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"next"</span> <span class="attr">class</span>=<span class="string">"arrow"</span> <span class="attr">src</span>=<span class="string">"/public/img/right.png"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br><img src="/2019/03/02/后端基础——Nodejs/url地址访问.JPG" alt="url地址访问.JPG"><br><br>然后看一下我们的浏览器编辑器，每一个静态资源都会发送一个请求，这里的请求地址就是 服务器地址 + 端口号 + 服务器url地址。<br><br><img src="/2019/03/02/后端基础——Nodejs/url地址.JPG" alt="url地址.JPG"><br><br><br>—————————————————-<br><br>## 基本路由<br><br>### 路由的基本概念<br><br>简单的说，路由的概念就是通过 url 请求，根据 GET 或者 POST 中的数据执行不同的代码。就是一个映射关系。<br><br>### GET<br><br>文档：<a href="http://nodejs.cn/api/url.html" target="_blank" rel="noopener">http://nodejs.cn/api/url.html</a><br><br><code>GET</code> 的数据在 <code>url</code> 上，如请求 <code>url</code> 为 “<a href="http://localhost:8888/user?name=菜鸟联盟&amp;url=www.runoob.com”" target="_blank" rel="noopener">http://localhost:8888/user?name=菜鸟联盟&amp;url=www.runoob.com”</a> 问号之后的就是 <code>GET</code> 的数据。<br><br>也因为 <code>GET</code> 请求参数都直接暴露在 <code>url</code>，所以相对 <code>POST</code> 来说更不安全，不能用来传递敏感信息。<br><br>使用 <code>url.parse</code> 将数据由字符串解析为 <code>url对象</code>，其中表单提交的数据存放在 <code>url对象</code> 中的 <code>query</code> 对象中。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nodejs</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8888</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line">server.on(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 解析 URL 字符串，第二参数为 true，则获得对象</span></span><br><span class="line">  <span class="keyword">var</span> urlObject = url.parse(request.url, <span class="literal">true</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(urlObject)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(port, hostname, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`服务器运行成功，通过 http://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/ 进行访问`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * url</span></span><br><span class="line"><span class="comment"> * http://localhost:8888/user?name=菜鸟联盟&amp;url=www.runoob.com</span></span><br><span class="line"><span class="comment"> * /</span></span><br></pre></td></tr></table></figure><br><br><img src="/2019/03/02/后端基础——Nodejs/url对象.JPG" alt="url对象.JPG"><br><br>### POST<br><br><code>POST</code> 的参数通过 <code>request body</code> 传递。<br><br>比较麻烦，不常用原生 <code>node</code> 发送 <code>POST</code>。见 <code>Express</code> 框架即可。<br><br>——————————-<br><br>## 重定向<br><br>URL 重定向，也称为 URL 转发，是一种当实际资源，如单个页面、表单或者整个 Web 应用被迁移到新的 URL 下的时候，保持（原有）链接可用的技术。HTTP 协议提供了一种特殊形式的响应—— HTTP 重定向（HTTP redirects）来执行此类操作。<br><br>Location<br><br>- Location 首部指定的是需要将页面重新定向至的地址。一般在响应码为3xx的响应中才会有意义<br><br>### 301 永久重定向（推荐）<br><br>301代表永久性转移(Permanently Moved)，301重定向是网页更改地址后对搜索引擎友好的最好方法，只要不是暂时搬移的情况,都建议使用301来做转址。<br><br>浏览器会记住这个重定向，比如，a.com 重定向到 b.com，当浏览器再次访问 a.com 时，将不再向服务器发送请求 a.com 的请求，而是从缓存中获取重定向地址直接跳转到 b.com。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重对象</span></span><br><span class="line"><span class="comment">//    1. 状态码设置为 301 永久重定向；302 临时重定向</span></span><br><span class="line">response.statusCode = <span class="number">301</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    2. 在响应头通过 Location 告诉客户端重定向地址</span></span><br><span class="line">response.setHeader(<span class="string">'Location'</span>, <span class="string">'http://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line">response.end()</span><br></pre></td></tr></table></figure><br><br>### 302 临时重定向<br><br>302代表暂时性转移(Temporarily Moved )，在前些年，不少Black Hat SEO曾广泛应用这项技术作弊，目前，各大主要搜索引擎均加强了打击力度，象Google前些年对Business.com以及近来对BMW德国网站的惩罚。即使网站客观上不是spam，也很容易被搜寻引擎容易误判为spam而遭到惩罚。<br><br>浏览器不会记住这个重定向，比如，a.com 重定向到 b.com，当浏览器再次访问 a.com 时，将依然向服务器发送请求 a.com 的请求，然后再跳转到 b.com。<br><br>—<br><br><br>## 回调函数 callback<br><br>回调函数在完成任务后就会被调用，Node 使用了大量的回调函数，Node 所有 API 都支持回调函数。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数 foo1 中的 callback 参数就是回调函数，通常是最后一个参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo1</span>(<span class="params">name, age, callback</span>) </span>&#123;</span><br><span class="line">  xxx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>—<br><br>## 事件循环<br><br>—<br><br>## 异步编程<br><br>异步操作<br><br>- setTimeout<br>- readFile<br>- writeFile<br>- ajax<br>- ……<br><br>这种异步操作中的内容无法直接被外层函数获得<br><br><font color="red">异步编程依托的就是回调函数。</font>

<p>如下为未使用回调函数的方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未使用回调函数的异步 js 代码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">var</span> sum</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">var</span> sum = x + y</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">  retrun sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(add(<span class="number">10</span>, <span class="number">20</span>))</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 执行结果</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">undefined     // sum 的结果</span><br><span class="line">...      // 等待 1 秒</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>在这个 <code>setTimeout</code> 定时器的异步操作中，定时器中的方法中的所有内容不会被 <code>add()</code> 方法使用，定时器中的 <code>return sum</code> 在这里无意义，不会被 <code>add()</code> 方法得到，而且定时器后的代码也不会等待定时器执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用了回调函数的异步 js 代码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">x, y, callback</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">var</span> sum</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">var</span> sum = x + y</span><br><span class="line">    <span class="comment">// 将 sum 通过 callback 回调函数传入</span></span><br><span class="line">    callback(sum)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过回到函数获取异步操作中的变量</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'add() 中的 sum: '</span>, add(<span class="number">10</span>, <span class="number">20</span>, <span class="function"><span class="keyword">function</span> (<span class="params">sum</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'定时器中的 sum: '</span>, sum)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 执行结果</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">add() 中的 sum:  undefined</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">定时器中的 sum:  30</span><br></pre></td></tr></table></figure>
<h3 id="回调地域"><a href="#回调地域" class="headerlink" title="回调地域"></a>回调地域</h3><p>在 JS 程序中，程序执行不会等待异步操作执行，而异步操作的时间长短与操作的内容有关，并不一定会按顺序。</p>
<p>如下代码，有三个读取文件的异步操作，其执行结束的顺序与文件大小及其他因素有关，所以控制台输出的结果顺序会不同。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./a.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./b.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./c.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果需要将这个程序按先后顺序执行，可以如下修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">'./a.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line"></span><br><span class="line">  fs.readFile(<span class="string">'./b.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line"></span><br><span class="line">    fs.readFile(<span class="string">'./c.txt'</span>, <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果有更多的异步操作，就需要在回调函数中不断地嵌套函数，代码深度将非常恐怖，也非常不利于维护，这就是<font color="red">回调地域</font>。</p>
<h3 id="ES6-Promise-解决回调地域"><a href="#ES6-Promise-解决回调地域" class="headerlink" title="ES6 Promise 解决回调地域"></a>ES6 Promise 解决回调地域</h3><hr>
<h2 id="Express-框架"><a href="#Express-框架" class="headerlink" title="Express 框架"></a>Express 框架</h2><p>Express 是一个简洁而灵活的 node.js Web应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。</p>
<p>详见博客《框架——Express》。</p>
<hr>
<h2 id="小型项目"><a href="#小型项目" class="headerlink" title="小型项目"></a>小型项目</h2><p>因为一般不使用原生开发，详见博客《框架——Express》。</p>
<hr>
<h2 id="Node-js-连接-MongoDB-数据库"><a href="#Node-js-连接-MongoDB-数据库" class="headerlink" title="Node.js 连接 MongoDB 数据库"></a>Node.js 连接 MongoDB 数据库</h2><p>MongoDB 基础语法见博客《数据库——MongoDB》</p>
<p>npm 中连接 MongoDB 文档: <a href="https://www.npmjs.com/package/mongodb" target="_blank" rel="noopener">https://www.npmjs.com/package/mongodb</a></p>
<h3 id="mongoose-第三方框架"><a href="#mongoose-第三方框架" class="headerlink" title="mongoose 第三方框架"></a>mongoose 第三方框架</h3><p>mongoose 第三方包：<a href="https://mongoosejs.com/" target="_blank" rel="noopener">https://mongoosejs.com/</a></p>
<p>mongoose 5.0 中文文档：<a href="https://cn.mongoosedoc.top/docs/index.html" target="_blank" rel="noopener">https://cn.mongoosedoc.top/docs/index.html</a></p>
<p>mongoose 5.4.19 英文文档：<a href="https://mongoosejs.com/docs/index.html" target="_blank" rel="noopener">https://mongoosejs.com/docs/index.html</a></p>
<h4 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 安装</span><br><span class="line">// mongodb 原生，可以不主动装</span><br><span class="line">npm install mongodb --save</span><br><span class="line"></span><br><span class="line">// mongoose 第三方 mongodb 框架</span><br><span class="line">npm install mongoose --save</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js 简单案例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">27017</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"><span class="keyword">const</span> dbName = <span class="string">'test'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接本机数据库</span></span><br><span class="line">mongoose.connect(<span class="string">`mongodb://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/<span class="subst">$&#123;dbName&#125;</span>`</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个模型，就是在设计数据库</span></span><br><span class="line"><span class="comment">// mongoose 在代码中设计数据库，第一个参数是集合名称，第二个是数据结构</span></span><br><span class="line"><span class="keyword">const</span> Cat = mongoose.model(<span class="string">'Cat'</span>, &#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化一个数据库集合对象</span></span><br><span class="line"><span class="keyword">const</span> kitty = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">'Zildjian'</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 持久化实例</span></span><br><span class="line">kitty.save().then(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'err'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'meow'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="第一步：mongoose-引入及连接数据库"><a href="#第一步：mongoose-引入及连接数据库" class="headerlink" title="第一步：mongoose 引入及连接数据库"></a>第一步：mongoose 引入及连接数据库</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">27017</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"><span class="keyword">const</span> dbName = <span class="string">'test'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line">mongoose.connect(<span class="string">`mongodb://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/<span class="subst">$&#123;dbName&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数据库连接状态</span></span><br><span class="line"><span class="keyword">var</span> db = mongoose.connection</span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'数据库连接失败！'</span>))</span><br><span class="line">db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// we're connected!</span></span><br><span class="line">  <span class="comment">// 之后数据库的操作都放在这个方法中</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'数据库连接成功！'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="第二步：Schema-文档结构设计"><a href="#第二步：Schema-文档结构设计" class="headerlink" title="第二步：Schema 文档结构设计"></a>第二步：Schema 文档结构设计</h5><p><code>Schema</code> 就是模板的意思，就是数据库中存储数据的字段及其类型，就是关系型数据库中的表结构。</p>
<p>如下，<code>blogSchema</code> 就是博客的文档模板，定义了各种字段及其数据类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line"><span class="keyword">var</span> Schema名称 = mongoose.Schema(</span><br><span class="line">	&#123;<span class="built_in">document</span>&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Schema 文档结构设计（表结构）</span></span><br><span class="line"><span class="keyword">var</span> blogSchema = mongoose.Schema(&#123;</span><br><span class="line">  title: <span class="built_in">String</span>,</span><br><span class="line">  author: <span class="built_in">String</span>,</span><br><span class="line">  body: <span class="built_in">String</span>,</span><br><span class="line">  comments: [&#123; <span class="attr">body</span>: <span class="built_in">String</span>, <span class="attr">date</span>: <span class="built_in">Date</span> &#125;],</span><br><span class="line">  date: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now &#125;,</span><br><span class="line">  hidden: <span class="built_in">Boolean</span>,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    votes: <span class="built_in">Number</span>,</span><br><span class="line">    favs: <span class="built_in">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果有必要，可以给 Schema 添加一个自定义的方法，如 success 方法</span></span><br><span class="line">blogSchema.method.success = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'这是一个 Schema 的方法'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="第三步：Schema-文档结构发布为-Model-模型"><a href="#第三步：Schema-文档结构发布为-Model-模型" class="headerlink" title="第三步：Schema 文档结构发布为 Model 模型"></a>第三步：Schema 文档结构发布为 Model 模型</h5><p><code>Model()</code> 方法是 <code>mongoose</code> 中用来将一个 <code>Schema</code> 架构发布为 <code>model</code> 。</p>
<p><code>Models</code> 是从 <code>Schema</code> 编译来的构造函数。它们的实例就代表着可以从数据库保存和读取的 <code>documents</code> 文档。从数据库创建和读取 <code>document</code> 文档的所有操作都是通过 <code>model</code> 进行的。</p>
<p><code>Model()</code> 方法有两个参数：</p>
<ul>
<li><p>第一个参数:</p>
<pre><code>首字母大写的 `单数` 形式集合名。 `mongoose` 会自动找到名称是数据库中名字小写 `复数` 形式的集合。
</code></pre></li>
<li><p>第二个参数：</p>
<p>  Schema 对象。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Schema 文档结构设计（表结构）</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把 schema 编译成一个 Model，并返回 Model 对象</span></span><br><span class="line"><span class="keyword">var</span> Blog = mongoose.model(<span class="string">'Blog'</span>, blogSchema)</span><br></pre></td></tr></table></figure>
<font color="red">前三步都是最关键的工作，之后的所有操作，全靠 Model 对象</font>

<h5 id="第四步：使用-Model-对象生成本地数据文档"><a href="#第四步：使用-Model-对象生成本地数据文档" class="headerlink" title="第四步：使用 Model 对象生成本地数据文档"></a>第四步：使用 Model 对象生成本地数据文档</h5><p>使用 <code>Model</code> 对象生成的数据文档保存在内存中，并没有直接保存到数据库中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Schema 文档结构设计（表结构）</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把 schema 编译成一个 Model，并返回 Model 对象</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 使用 Model 对象生成本地数据文档</span></span><br><span class="line"><span class="keyword">var</span> blog = <span class="keyword">new</span> Blog(&#123;</span><br><span class="line">  title: <span class="string">'测试'</span>,</span><br><span class="line">  author: <span class="string">'Ai'</span>,</span><br><span class="line">  body: <span class="string">'nothing'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 数据持久化保存</span></span><br><span class="line">blog.save(<span class="function">(<span class="params">err, blog</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'数据保存失败'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'数据保存成功：'</span> + blog)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// console</span><br><span class="line"></span><br><span class="line">f:\WorkSpace\nodejs\mongoose_demo&gt;node index2.js</span><br><span class="line">(node:2208) DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option &#123; useNewUrlParser: true &#125; to MongoClient.connect.</span><br><span class="line">数据库连接成功！</span><br><span class="line">数据保存成功：&#123; _id: 5c8e0a7a70ba2e08a08ef9a5,</span><br><span class="line">  title: '测试',</span><br><span class="line">  author: 'Ai',</span><br><span class="line">  body: 'nothing',</span><br><span class="line">  comments: [],</span><br><span class="line">  date: 2019-03-17T08:51:06.731Z,</span><br><span class="line">  __v: 0 &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// mongo cmd</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span> show dbs</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line">test    0.000GB</span><br><span class="line"><span class="meta">&gt;</span> use test</span><br><span class="line">switched to db test</span><br><span class="line"><span class="meta">&gt;</span> show collections</span><br><span class="line">blogs</span><br><span class="line">cats</span><br><span class="line"><span class="meta">&gt;</span> db.blogs.find()</span><br><span class="line">&#123; "_id" : ObjectId("5c8df4c571b581361c6caf69"), "title" : "测试", "author" : "Ai", "body" : "nothing", "comments" : [ ], "date" : ISODate("2019-03-17T07:18:29.447Z"), "__v" : 0 &#125;</span><br><span class="line"><span class="meta">&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="CRUD-操作"><a href="#CRUD-操作" class="headerlink" title="CRUD 操作"></a>CRUD 操作</h4><h5 id="增加-Create"><a href="#增加-Create" class="headerlink" title="增加(Create)"></a>增加(Create)</h5><p>见起步案例第四步。增加操作只需要先使用 <code>Model</code> 对象生成本地数据文档，然后使用 <code>save()</code> 方法保存到数据库中持久化保存即可。</p>
<h5 id="查询-Retrieve"><a href="#查询-Retrieve" class="headerlink" title="查询(Retrieve)"></a>查询(Retrieve)</h5><p>API: <a href="https://mongoosejs.com/docs/queries.html" target="_blank" rel="noopener">https://mongoosejs.com/docs/queries.html</a></p>
<p>查询的方法非常多，简单讲几个，其他的看 API 。</p>
<ul>
<li><p><code>find()</code>：查询所有，返回的是一个文档列表。</p>
</li>
<li><p><code>findOne()</code>：查询第一个，查询结果可能是一个空的单个文档。</p>
</li>
<li><p><code>findById()</code>：根据 <code>id</code> 查询。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 更多查询方法，删改方法大多与查询挂钩……</span><br><span class="line">Model.deleteMany()</span><br><span class="line">Model.deleteOne()</span><br><span class="line">Model.find()</span><br><span class="line">Model.findById()</span><br><span class="line">Model.findByIdAndDelete()</span><br><span class="line">Model.findByIdAndRemove()</span><br><span class="line">Model.findByIdAndUpdate()</span><br><span class="line">Model.findOne()</span><br><span class="line">Model.findOneAndDelete()</span><br><span class="line">Model.findOneAndRemove()</span><br><span class="line">Model.findOneAndUpdate()</span><br><span class="line">Model.replaceOne()</span><br><span class="line">Model.updateMany()</span><br><span class="line">Model.updateOne()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line">Model.find(&#123; conditions &#125;, projection, options, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找 name 字段值为 'name'的数据，返回 name 和 friends 字段。</span></span><br><span class="line">MyModel.find(&#123; <span class="attr">name</span>: <span class="string">'name'</span>&#125;, <span class="string">'name friends'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, docs</span>) </span>&#123; </span><br><span class="line">	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>conditions：查询条件。不填默认查询所有。</p>
</li>
<li><p>projection: 要返回的可选字段，使用空格区分。不填默认返回所有字段。</p>
</li>
<li><p>options：选项。排序方式之类的。</p>
</li>
<li><p>err：错误对象。</p>
</li>
<li><p>data：结果文档对象。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Schema 文档结构设计（表结构）</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把 schema 编译成一个 Model，并返回 Model 对象</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Blog.find(<span class="function">(<span class="params">err, blogs</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'查询失败'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'blogs 集合内容如下:\n'</span> + blogs)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// console</span><br><span class="line">f:\WorkSpace\nodejs\mongoose_demo&gt;node index.js</span><br><span class="line">(node:2904) DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option &#123; useNewUrlParser: true &#125; to MongoClient.connect.</span><br><span class="line">数据库连接成功！</span><br><span class="line">blogs 集合内容如下:</span><br><span class="line">&#123; _id: 5c8df4c571b581361c6caf69,</span><br><span class="line">  title: '测试',</span><br><span class="line">  author: 'Ai',</span><br><span class="line">  body: 'nothing',</span><br><span class="line">  comments: [],</span><br><span class="line">  date: 2019-03-17T07:18:29.447Z,</span><br><span class="line">  __v: 0 &#125;</span><br></pre></td></tr></table></figure>
<h5 id="更新-Update"><a href="#更新-Update" class="headerlink" title="更新(Update)"></a>更新(Update)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 更多更新方法</span><br><span class="line">Model.findByIdAndUpdate()</span><br><span class="line">Model.findOneAndDelete()</span><br><span class="line">Model.replaceOne()</span><br><span class="line">Model.updateMany()</span><br><span class="line">Model.updateOne()</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法</span></span><br><span class="line">Model.updateOne(&#123; conditions &#125;, doc, options, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找 name 字段值为 'name'的数据，修改 friends 字段值为 'aaa' 。</span></span><br><span class="line">MyModel.updateOne(&#123; <span class="attr">name</span>: <span class="string">'name'</span>&#125;, &#123; <span class="attr">friend</span>: <span class="string">'aaa'</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err, docs</span>) </span>&#123; </span><br><span class="line">	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Schema 文档结构设计（表结构）</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把 schema 编译成一个 Model，并返回 Model 对象</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Blog.updateOne(&#123; <span class="attr">title</span>: <span class="string">'测试'</span> &#125;, &#123; <span class="attr">author</span>: <span class="string">'B'</span> &#125;, (err, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'更新失败'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'更新成功'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="删除-Delete"><a href="#删除-Delete" class="headerlink" title="删除(Delete)"></a>删除(Delete)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 更多删除方法</span><br><span class="line">Model.deleteMany()</span><br><span class="line">Model.deleteOne()</span><br><span class="line">Model.findByIdAndDelete()</span><br><span class="line">Model.findByIdAndRemove()</span><br><span class="line">Model.findOne()</span><br><span class="line">Model.findOneAndDelete()</span><br><span class="line">Model.findOneAndRemove()</span><br></pre></td></tr></table></figure>
<p>原先有个 <code>remove()</code> 方法，但是已经被删除了，现在使用 <code>deleteMany()</code> 和 <code>deleteOne()</code> 删除多个或者一个数据。</p>
<p>删除方法的回调方法参数只有 <code>err</code> 错误对象来表示是否删除错误，其他的信息对我们没有意义。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Schema 文档结构设计（表结构）</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把 schema 编译成一个 Model，并返回 Model 对象</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Blog.deleteMany(&#123; <span class="attr">title</span>: <span class="string">'测试'</span> &#125;, (err) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">'删除失败'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'删除成功'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Node-js-中使用-Mongoose-框架"><a href="#Node-js-中使用-Mongoose-框架" class="headerlink" title="Node.js 中使用 Mongoose 框架"></a>Node.js 中使用 Mongoose 框架</h4><p>如果要在 <code>Node.js</code> 中使用 <code>Mongoose</code> 框架，非常简单，只需要三步走得到 <code>Model</code> 对象，然后其他事情全是查找 <code>API</code> 就行了。</p>
<p><code>Mongoose</code> 框架，最重要的就是 <code>Model</code> 对象，所有的增删改查操作都是依靠 <code>Model</code> 来实现，如果需要将功能打包，将数据库所有操作放在单独的文件中的话，该文件只需要将最终得到的 <code>Model</code> 对象通过 <code>moudle.exports</code> 导出即可，然后在别的文件中通过 <code>require</code> 引入得到的对象就是 <code>Model</code> 对象，只要有了它，就能调用 <code>API</code> 执行数据库操作了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">27017</span></span><br><span class="line"><span class="keyword">const</span> hostname = <span class="string">'127.0.0.1'</span></span><br><span class="line"><span class="keyword">const</span> dbName = <span class="string">'test'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 连接数据库</span></span><br><span class="line">mongoose.connect(<span class="string">`mongodb://<span class="subst">$&#123;hostname&#125;</span>:<span class="subst">$&#123;port&#125;</span>/<span class="subst">$&#123;dbName&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数据库连接状态</span></span><br><span class="line"><span class="keyword">var</span> db = mongoose.connection</span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'数据库连接失败！'</span>))</span><br><span class="line">db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// we're connected!</span></span><br><span class="line">  <span class="comment">// 之后数据库的操作都放在这个方法中</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'数据库连接成功！'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Schema 文档结构设计（表结构）</span></span><br><span class="line"><span class="keyword">var</span> blogSchema = mongoose.Schema(&#123;</span><br><span class="line">  title: <span class="built_in">String</span>,</span><br><span class="line">  author: <span class="built_in">String</span>,</span><br><span class="line">  body: <span class="built_in">String</span>,</span><br><span class="line">  comments: [&#123; <span class="attr">body</span>: <span class="built_in">String</span>, <span class="attr">date</span>: <span class="built_in">Date</span> &#125;],</span><br><span class="line">  date: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, <span class="attr">default</span>: <span class="built_in">Date</span>.now &#125;,</span><br><span class="line">  hidden: <span class="built_in">Boolean</span>,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    votes: <span class="built_in">Number</span>,</span><br><span class="line">    favs: <span class="built_in">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 把 schema 编译成一个 Model，并导出 Model 对象即可</span></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'Blog'</span>, blogSchema)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Node-js-连接-MySQL-数据库"><a href="#Node-js-连接-MySQL-数据库" class="headerlink" title="Node.js 连接 MySQL 数据库"></a>Node.js 连接 MySQL 数据库</h2><p><a href="https://github.com/mysqljs/mysql" target="_blank" rel="noopener">https://github.com/mysqljs/mysql</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm i mysql -S</span><br><span class="line"></span><br><span class="line">// 或者</span><br><span class="line">npm i mysqljs -S</span><br></pre></td></tr></table></figure>
<h3 id="起步-1"><a href="#起步-1" class="headerlink" title="起步"></a>起步</h3><p><code>Node.js</code> 中的 <code>MySQL</code> 操作非常简单，所有的数据库操作全在第四步 <code>query()</code> 中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建连接</span></span><br><span class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  host: <span class="string">'localhost'</span>,</span><br><span class="line">  user: <span class="string">'root'</span>,</span><br><span class="line">  password: <span class="string">'root'</span>,</span><br><span class="line">  database: <span class="string">'test'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 连接数据库</span></span><br><span class="line">connection.connect()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 执行数据库操作</span></span><br><span class="line">connection.query(<span class="string">'SELECT 1 + 1 AS solution'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'The solution is: '</span>, results[<span class="number">0</span>].solution)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 关闭数据库连接</span></span><br><span class="line">connection.end()</span><br></pre></td></tr></table></figure>
<h3 id="query-方法简介"><a href="#query-方法简介" class="headerlink" title="query() 方法简介"></a>query() 方法简介</h3><p><code>query()</code> 方法是连接对象中用来执行 <code>SQL</code> 语句的方法。</p>
<p><code>query()</code> 方法参数。</p>
<ul>
<li><p>SQL 命令字符串：这个没话讲，就是针对连接到的数据库进行 <code>SQL</code> 语句操作，可以使用一个参数执行 <code>SQL</code> 语句，也可以模板和内容分离，变成两个参数。</p>
</li>
<li><p>callback 回调函数：用来返回错误对象和执行结果。</p>
</li>
</ul>
<p>所有的数据库操作全靠 <code>SQL</code> 语句，所以，<code>Node.js</code> 操作 <code>MySQL</code> 的所有操作全在 <code>query()</code> 方法中进行，只是 <code>SQL</code> 语句变动。</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/02/后端基础——Nodejs/" data-id="cjtg2fw0n004yo4ut5u3ji6l4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node/">Node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后端/">后端</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BOM/">BOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EcamScript6/">EcamScript6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Html-Css/">Html/Css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/">Node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后端/">后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小程序/">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/框架/">框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器兼容/">浏览器兼容</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移动端/">移动端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件配置/">软件配置</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 18.57px;">Android</a> <a href="/tags/BOM/" style="font-size: 10px;">BOM</a> <a href="/tags/DOM/" style="font-size: 10px;">DOM</a> <a href="/tags/EcamScript6/" style="font-size: 10px;">EcamScript6</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Html-Css/" style="font-size: 11.43px;">Html/Css</a> <a href="/tags/JavaScript/" style="font-size: 15.71px;">JavaScript</a> <a href="/tags/Node/" style="font-size: 12.86px;">Node</a> <a href="/tags/Python/" style="font-size: 17.14px;">Python</a> <a href="/tags/blog/" style="font-size: 11.43px;">blog</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/tool/" style="font-size: 10px;">tool</a> <a href="/tags/前端/" style="font-size: 17.14px;">前端</a> <a href="/tags/后端/" style="font-size: 14.29px;">后端</a> <a href="/tags/小程序/" style="font-size: 10px;">小程序</a> <a href="/tags/数据库/" style="font-size: 11.43px;">数据库</a> <a href="/tags/框架/" style="font-size: 11.43px;">框架</a> <a href="/tags/浏览器兼容/" style="font-size: 10px;">浏览器兼容</a> <a href="/tags/移动端/" style="font-size: 20px;">移动端</a> <a href="/tags/软件配置/" style="font-size: 10px;">软件配置</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/19/后端基础——npm常见包/">后端基础——npm常见包</a>
          </li>
        
          <li>
            <a href="/2019/03/18/前端-JavaScript基础-EcamScript6/">前端-JavaScript基础-EcamScript6</a>
          </li>
        
          <li>
            <a href="/2019/03/15/数据库——MySQL/">数据库——MySQL</a>
          </li>
        
          <li>
            <a href="/2019/03/15/数据库——MongoDB/">数据库——MongoDB</a>
          </li>
        
          <li>
            <a href="/2019/03/15/MongoDB/">MongoDB</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Ai Junhao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>